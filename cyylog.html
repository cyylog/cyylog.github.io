<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyyå¥èº«è¥å…»æ™ºèƒ½å·¥å…·</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e0f7ff, #ffffff);
            min-height: 100vh;
            color: #334155;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* é¦–é¡µæ ·å¼ */
        .home-container {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 40px;
            text-align: center;
        }
        
        .home-container h1 {
            color: #0ea5e9;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .home-subtitle {
            color: #64748b;
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2px;
            margin-bottom: 5px;
        }
        
        .tool-card {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 15px;
    padding: 20px 20px 20px 20px; /* ç¡®ä¿å››è¾¹éƒ½æœ‰è¶³å¤Ÿå†…è¾¹è· */
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    margin: 4px;
    padding-top: 32px; /* æ·»åŠ é¡¶éƒ¨é¢å¤–å†…è¾¹è·ï¼Œç»™å¾½ç« ç•™ç©ºé—´ */
        }
        
        .tool-card:hover {
            transform: translateY(-5px);
            border-color: #0ea5e9;
            box-shadow: 0 5px 20px rgba(14, 165, 233, 0.2);
        }
        
        .tool-card h2 {
            color: #0ea5e9;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .tool-card p {
            color: #475569;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        .tool-features {
            list-style: none;
            text-align: left;
            color: #64748b;
            font-size: 0.8rem;
            text-align: center;
        }
        
        .tool-features li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
                display: inline-block;
    text-align: left;
    margin: 0 10px;
        }
        
        .tool-features li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
            
        }
        
        .btn-enter {
            background: #0ea5e9;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        .btn-enter:hover {
            background: #0284c7;
            transform: scale(1.05);
        }
        
        .badge {
      position: absolute;
    top: 8px;           /* ä»2pxæ”¹ä¸º8pxï¼Œå‘ä¸‹ç§»åŠ¨ */
    right: 8px;         /* ä»2pxæ”¹ä¸º8pxï¼Œå‘å·¦ç§»åŠ¨ */
    background: #f59e0b;
    color: white;
    padding: 4px 10px;  /* ä»5px 15pxæ”¹ä¸º4px 10pxï¼Œå‡å°å¤§å° */
    border-radius: 12px; /* ä»20pxæ”¹ä¸º12pxï¼Œæ›´åœ†æ¶¦ */
    font-size: 0.7rem;  /* ä»0.8remæ”¹ä¸º0.7remï¼Œå‡å°å­—ä½“ */
    font-weight: bold;
    z-index: 2;         /* æ·»åŠ å±‚çº§ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */
    line-height: 1.2;   /* æ·»åŠ è¡Œé«˜ï¼Œé¿å…æ–‡å­—æº¢å‡º */
    max-width: 70%;     /* é™åˆ¶æœ€å¤§å®½åº¦ */
    white-space: nowrap; /* é˜²æ­¢æ¢è¡Œ */
    overflow: hidden;
    text-overflow: ellipsis;
        }
        
        .badge.dev {
            background: #94a3b8;
        }
        
        .comparison-table {
            background: #f8fafc;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            text-align: left;
        }
        
        .comparison-table h3 {
            color: #0ea5e9;
            margin-bottom: 20px;
            text-align: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #e0f2fe;
            color: #0c4a6e;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f0f9ff;
        }
        
        /* å·¥å…·é¡µé¢æ ·å¼ */
        .tool-page {
            display: none;
        }
        
        /* å‡¯åœ£ç‹ç¢³å¾ªç¯æ ·å¼ */
        :root{
          --primary:#0ea5e9;
          --primary-light:#38bdf8;
          --success:#10b981;
          --warning:#f59e0b;
          --danger:#f43f5e;
          --dark:#1e293b;
          --light:#f8fafc;
          --high:#bae6fd;
          --med:#e0f2fe;
          --low:#fef3c7;
        }
        
        header{color:#0ea5e9;text-align:center;margin-bottom:24px;position:relative;}
        header h1{font-size:1.8rem;margin-bottom:4px;font-weight:700}
        header .subtitle{font-size:.9rem;color:#64748b}
        
        .back-home-btn {
            position: absolute;
            top: 0;
            left: 0;
            background: #94a3b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .back-home-btn:hover {
            background: #64748b;
        }
        
        .tabs{display:flex;justify-content:center;margin-bottom:20px;border-bottom:1px solid #cbd5e1}
        .tab-btn{
          padding:10px 20px;
          background:none;
          border:none;
          cursor:pointer;
          font-size:1rem;
          font-weight:600;
          color:#64748b;
          border-bottom:3px solid transparent;
          transition:.3s;
        }
        .tab-btn.active{
          color:#0ea5e9;
          border-bottom-color:#0ea5e9;
        }
        .tab-content{display:none}
        .tab-content.active{display:block}
        
        .top-row{display:flex;gap:16px;flex-wrap:wrap}
        .top-row>section{
          background:#fff;
          border-radius:12px;
          padding:16px;
          box-shadow:0 1px 3px rgba(0,0,0,.08);
          flex:1 1 260px;
          min-width:260px;
        }
        .top-row h3{
          font-size:1rem;
          margin-bottom:10px;
          color:#0ea5e9;
          font-weight:600;
        }
        .basic-row,.macro-row{display:flex;gap:8px;flex-wrap:wrap}
        .basic-row .input-group,.macro-row .input-group{flex:1 1 100px;display:flex;flex-direction:column}
        .top-row label{font-size:.8rem;font-weight:600;margin-bottom:4px}
        .top-row input,.top-row select{
          padding:6px 8px;
          font-size:.8rem;
          border:1px solid #cbd5e1;
          border-radius:6px;
        }
        
        .target-weight-input-group {
          flex: 0 1 auto !important;
          min-width: unset !important;
        }
        
        .target-weight-controls {
          display: flex;
          align-items: center;
          gap: 4px;
          justify-content: center;
        }
        
        .target-weight-controls input {
          width: 50px !important;
          text-align: center;
          margin: 0 2px;
        }
        
        .target-weight-controls button {
          flex: 0 0 20px;
          height:20px;
          border:1px solid var(--primary-light);
          background:#fff;
          color:var(--primary-light);
          border-radius:50%;
          font-size:14px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
        }
        
        .body-type-cards,.plan-cards{display:flex;gap:6px;flex-wrap:wrap}
        .body-type-card,.plan-card{
          flex:1 1 80px;
          border:1px solid #cbd5e1;
          border-radius:8px;
          padding:8px 4px;
          font-size:.7rem;
          text-align:center;
          cursor:pointer;
          transition:.2s;
          background:#fff;
        }
        .body-type-card:hover,.plan-card:hover{transform:translateY(-1px)}
        .body-type-card.selected,.plan-card.selected{
          border-color:var(--primary);
          background:#e0f2fe;
        }
        .body-type-card h4,.plan-card h4{font-size:.75rem;margin-bottom:2px;color:#0ea5e9}
        .body-type-card p,.plan-card p{font-size:.6rem;margin:0;line-height:1.2;color:#64748b}
        
        .summary-cards{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
        .summary-card{
          flex:1 1 70px;
          background:#f0f9ff;
          border-radius:8px;
          padding:8px;
          text-align:center;
          font-size:.75rem;
        }
        .summary-card .val{font-size:1rem;font-weight:700;color:var(--primary)}
        .summary-card .lab{font-size:.6rem;color:#475569}
        
        .btn-row{display:flex;gap:8px;flex-wrap:wrap;margin:16px 0}
        .btn-row button{
          flex:1 1 100px;
          padding:10px 0;
          border:none;
          border-radius:6px;
          font-size:.85rem;
          font-weight:600;
          cursor:pointer;
          color:#fff;
          transition:.2s;
        }
        .btn-calc{background:var(--primary)}
        .btn-down{background:var(--success)}
        .btn-reset{background:var(--warning)}
        .btn-back{background:var(--dark)}
        .btn-row button:hover{opacity:.9}
        
  .table-wrap{overflow-x:auto;margin-top:16px}
#planTable{min-width:1400px}   /* 28 åˆ—æ’‘å¼€ */
        table{width:100%;border-collapse:collapse;font-size:.75rem}
        th,td{border:1px solid #e2e8f0;padding:6px 4px;text-align:center}
        th{background:#f1f5f9;color:#0ea5e9;font-weight:600}
        tbody tr:nth-child(odd){background:#fff}
        tbody tr:nth-child(even){background:#f8fafc}
        thead tr:nth-child(2) .high{background:var(--high);color:#0c4a6e}
        thead tr:nth-child(2) .med{background:var(--med);color:#0c4a6e}
        thead tr:nth-child(2) .low{background:var(--low);color:#78350f}
        .editable{background:#fffbeb}
        
        .notes{
          background:#fff;
          border-radius:12px;
          box-shadow:0 1px 3px rgba(0,0,0,.08);
          padding:16px 20px;
          margin-top:20px;
          font-size:.8rem;
          line-height:1.6;
          color:#475569;
        }
        .notes h3{margin-bottom:10px;color:#0ea5e9;font-size:1rem}
        .notes ul{margin:0;padding-left:20px}
        .notes li{margin-bottom:6px}
        .notes .tag{display:inline-block;padding:2px 6px;border-radius:4px;color:#fff;font-weight:bold;margin-right:4px;font-size:.7rem}
        .notes .tag.high{background:var(--high);color:#0c4a6e}
        .notes .tag.med{background:var(--med);color:#0c4a6e}
        .notes .tag.low{background:var(--low);color:#78350f}
        footer{color:#94a3b8;text-align:center;font-size:.6rem;margin-top:20px}
        
        .custom-plan{display:none;gap:4px;flex-wrap:wrap;margin-top:8px}
        .custom-plan input{
          flex:1 1 60px;
          font-size:.7rem;
          padding:4px 2px;
          text-align:center;
          border:1px solid #cbd5e1;
          border-radius:4px;
        }
        .target-info{
          background:#fff;
          border-radius:12px;
          padding:16px;
          margin-top:16px;
          box-shadow:0 1px 3px rgba(0,0,0,.08);
        }
        .target-info h3{
          font-size:1rem;
          margin-bottom:8px;
          color:#0ea5e9;
          font-weight:600;
        }
        .target-stats{
          display:flex;
          gap:8px;
          flex-wrap:wrap;
        }
        .target-stat{
          flex:1 1 100px;
          background:#f0f9ff;
          border-radius:8px;
          padding:8px;
          text-align:center;
        }
        .target-stat .value{
          font-size:1.1rem;
          font-weight:700;
          color:var(--primary);
        }
        .target-stat .label{
          font-size:.7rem;
          color:#64748b;
        }
        
        /* æ©™å­ç¢³æ°´æ¸é™ç‰¹å®šæ ·å¼ */
        .orange-section {
          display: none;
        }
        .orange-macro-row {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          margin-bottom: 12px;
        }
        .orange-input-group {
          flex: 1 1 100px;
          display: flex;
          flex-direction: column;
        }
        .orange-ratio-cards {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          margin-bottom: 12px;
        }
        .orange-ratio-card {
          flex: 1 1 120px;
          border: 1px solid #cbd5e1;
          border-radius: 8px;
          padding: 8px;
          text-align: center;
          cursor: pointer;
          transition: .2s;
          background: #fff;
        }
        .orange-ratio-card.selected {
          border-color: var(--primary);
          background: #e0f2fe;
        }
        .orange-results {
          background: #fff;
          border-radius: 12px;
          padding: 16px;
          margin-top: 16px;
          box-shadow: 0 1px 3px rgba(0,0,0,.08);
        }
        .orange-results h3 {
          font-size: 1rem;
          margin-bottom: 12px;
          color: #0ea5e9;
          font-weight: 600;
        }
        .orange-stats {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          margin-bottom: 16px;
        }
        .orange-stat {
          flex: 1 1 120px;
          background: #f0f9ff;
          border-radius: 8px;
          padding: 10px;
          text-align: center;
        }
        .orange-stat .value {
          font-size: 1.1rem;
          font-weight: 700;
          color: var(--primary);
        }
        .orange-stat .label {
          font-size: .7rem;
          color: #64748b;
        }
        .orange-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 12px;
        }
        .orange-table th, .orange-table td {
          border: 1px solid #e2e8f0;
          padding: 8px;
          text-align: center;
        }
        .orange-table th {
          background: #f1f5f9;
          color: #0ea5e9;
          font-weight: 600;
        }
        
        /* æ–°å¢æ ·å¼ */
        .weight-loss-slider {
          margin: 10px 0;
        }
        
        .weight-loss-slider label {
          display: block;
          margin-bottom: 5px;
          font-weight: 600;
          font-size: 0.8rem;
        }
        
        .slider-container {
          display: flex;
          align-items: center;
          gap: 10px;
        }
        
        .slider-container input[type="range"] {
          flex: 1;
        }
        
        .slider-value {
          min-width: 40px;
          text-align: center;
          font-weight: 600;
          color: var(--primary);
        }
        
        .custom-ratio-inputs {
          display: flex;
          gap: 8px;
          margin-top: 8px;
          flex-wrap: wrap;
        }
        
        .custom-ratio-input {
          flex: 1;
          min-width: 80px;
        }
        
        .custom-ratio-input label {
          font-size: 0.7rem;
          font-weight: 600;
          display: block;
          margin-bottom: 4px;
        }
        
        .custom-ratio-input input {
          width: 100%;
          padding: 4px;
          border: 1px solid #cbd5e1;
          border-radius: 4px;
          text-align: center;
        }
        
        .ratio-sum {
          margin-top: 8px;
          font-size: 0.8rem;
          color: #64748b;
        }
        
        .ratio-sum.error {
          color: var(--danger);
          font-weight: 600;
        }
        
        /* åª’ä½“æŸ¥è¯¢ï¼šé’ˆå¯¹å°å±å¹•è®¾å¤‡çš„ä¼˜åŒ– */
        @media (max-width: 480px) {
         .badge {
        top: 6px;            /* è¿›ä¸€æ­¥å‡å°é¡¶éƒ¨è·ç¦» */
        right: 6px;          /* è¿›ä¸€æ­¥å‡å°å³è¾¹è·ç¦» */
        padding: 3px 8px;    /* è¿›ä¸€æ­¥å‡å°å†…è¾¹è· */
        font-size: 0.65rem;  /* è¿›ä¸€æ­¥å‡å°å­—ä½“ */
        border-radius: 10px; /* å‡å°åœ†è§’ */
        max-width: 65%;      /* è¿›ä¸€æ­¥é™åˆ¶å®½åº¦ */
    }
          .basic-row .input-group {
            flex: 1 1 100px !important;
          }
          
          .target-weight-input-group {
            flex: 0 1 120px !important;
          }
          
          .target-weight-controls {
            justify-content: flex-start;
          }
          
          .tab-btn {
            padding: 8px 12px;
            font-size: 0.9rem;
          }
          
          .tools-grid {
            grid-template-columns: 1fr 1fr;  /* ç¡®ä¿å°å±ä¿æŒ2åˆ— */
            gap: 3px; 
          }
          
          .home-container {
            padding: 20px;
          }
          
          .home-container h1 {
            font-size: 1.5rem;
          }
          
          .back-home-btn {
            position: relative;
            margin-bottom: 15px;
          }
            
    .tool-card {
        padding-top: 28px;   /* åœ¨å°å±å¹•ä¸Šå‡å°é¡¶éƒ¨å†…è¾¹è· */
    }
    
    .tool-card h2 {
        font-size: 1.1rem;               /* å‡å°æ ‡é¢˜å¤§å° */
    }
    
    .tool-card p {
        font-size: 0.8rem;               /* å‡å°æè¿°å­—ä½“ */
        line-height: 1.4;
    }
    
    .tool-features li {
        padding: 4px 0;                  /* å‡å°åˆ—è¡¨é¡¹é—´è· */
        padding-left: 15px;              /* å‡å°å·¦è¾¹è· */
        font-size: 0.75rem;              /* å‡å°å­—ä½“ */
    }
    
    .btn-enter {
        padding: 8px 20px;               /* å‡å°æŒ‰é’®å†…è¾¹è· */
        font-size: 0.9rem;               /* å‡å°å­—ä½“ */
        margin-top: 10px;                /* å‡å°ä¸Šè¾¹è· */
    }
        }
        /* ===== ç«–å‘å‘¨è¡¨ ===== */
.week-tables{margin-top:16px;font-size:.75rem;}
.week-table{background:#fff;border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);}
.week-title{color:#0ea5e9;font-weight:600;margin-bottom:8px;font-size:.9rem;}
.week-table table{width:100%;border-collapse:collapse;}
.week-table th,.week-table td{border:1px solid #e2e8f0;padding:6px 4px;text-align:center;}
.week-table th{background:#f1f5f9;color:#0ea5e9;font-weight:600;font-size:.7rem;}
.week-table .high{background:var(--high);color:#0c4a6e}
.week-table .med{background:var(--med);color:#0c4a6e}
.week-table .low{background:var(--low);color:#78350f}
    </style>
    <style>
/* ä»…éšè—æ¨ªå‘ 28 åˆ—è¡¨æ ¼ï¼Œå…¶ä½™ä¸€åˆ‡ä¿æŒåŸæ · */
#planTable {
    display: none !important;
}
</style>
<base target="_blank">
</head>
<body>
    <!-- é¦–é¡µ -->
    <div id="home-page" class="container home-container">
        <h1>Cyyå¥èº«è¥å…»æ™ºèƒ½å·¥å…·</h1>
        <p class="home-subtitle">å¯¹åº”é£Ÿè°±+è®­ç»ƒè®¡åˆ’(æœ‰å¿)å¯åŠ QQï¼š504246035</p>
        <!-- ä½“è„‚ç‡å‚è€ƒåŒºåŸŸ -->
<div style="text-align:center; margin:0 auto 5px;">   <!-- ç»Ÿä¸€æ§åˆ¶é—´è· -->
    <a href="javascript:void(0)"
       onclick="toggleBodyFatImage()"
       style="color:#E53E3E;font-size:17px;text-decoration:underline;">
        ğŸ“Œ ç‚¹å‡»æŸ¥çœ‹ä½“è„‚ç‡å‚è€ƒå›¾
    </a>
    <div id="bodyfat-container" style="display:none;margin-top:12px;"> <!-- ä¸Šé—´è·åªç»™å®¹å™¨å†…éƒ¨ -->
        <img src="https://s21.ax1x.com/2025/11/18/pZi0KXT.md.jpg"
             alt="ä½“è„‚ç‡å‚è€ƒ" style="max-width:100%;height:auto;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.15)">
        <p style="margin-top:8px;font-size:.85rem;color:#64748b">å¸¸è§ä½“è„‚ç‡å¤–è§‚å¯¹ç…§ï¼Œä»…ä¾›å‚è€ƒ</p>
    </div>
</div>

        <div class="tools-grid">
            <div class="tool-card" onclick="selectTool('kings-cycle')">
                <span class="badge">æ²¡æ‹›äº†å°±é€‰è¿™ä¸ª</span>
                <h2>å‡¯åœ£ç‹ç¢³å¾ªç¯</h2>
                <ul class="tool-features">
                    <li>é€‚åˆå¥èº«çˆ±å¥½è€…</li>
                    <li>å¹³å°æœŸå¤§æ€å™¨</li>
                    <li>å‡è„‚é€Ÿåº¦å¿«</li>
                    <li>éœ€è¦è®°å½•é¥®é£Ÿ</li>
                </ul>
                <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
            </div>
            <div class="tool-card" onclick="selectTool('orange-carb')">
                <span class="badge">æ–°æ‰‹é€‰è¿™ä¸ª</span>
                <h2>æ©™å­ç¢³æ°´æ¸é™</h2>
                <ul class="tool-features">
                    <li>é€‚åˆè®­ç»ƒå°‘çš„æ–°æ‰‹</li>
                    <li>é€‚åˆå¤§åŸºæ•°é«˜ä½“è„‚</li>
                    <li>æ¸é™å¼è°ƒæ•´ç¢³æ°´</li>
                    <li>å‡è„‚é€Ÿåº¦å¹³ç¼“</li>
                </ul>
                <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
            </div>
            <!-- 16+8è½»æ–­é£Ÿæ¨¡å— -->
<div class="tool-card" onclick="selectTool('sixteen-eight')">
    <span class="badge">æ˜“åšæŒ</span>
    <h2>16+8è½»æ–­é£Ÿ</h2>
    <ul class="tool-features">
        <li>ä¸å¥èº«ä¹Ÿå¯ç”¨</li>
        <li>æ”¹å–„èƒ°å²›ç´ æ•æ„Ÿæ€§</li>
        <li>æ˜“åšæŒä¸åå¼¹</li>
    </ul>
    <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
</div>
<div class="tool-card">
    <span class="badge">åŠ›å‹å…¼å¤‡</span>
    <h2>æ©™å­è–„è‚Œæ³•</h2>
    <ul class="tool-features">
        <li>ä¸‰å¤§é¡¹æå‡</li>
        <li>3é˜¶æ®µå®Œæ•´è®¡åˆ’</li>
        <li>æˆªå›¾ã€å¯¼å‡ºåŠŸèƒ½</li>
    </ul>
    <a href="/muscle.html" style="text-decoration: none;">
        <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
    </a>
</div>
<!-- å¢è‚Œè®¡åˆ’ -->
<div class="tool-card" onclick="selectTool('bulk-plan')">
    <span class="badge">è‚Œè‚‰æ‹¼å›¾</span>
    <h2>å¢è‚Œè®¡åˆ’</h2>
    <ul class="tool-features">
        <li>è‡ªåŠ¨è®¡ç®— BMR / TDEE</li>
        <li>ä¸‰æ¡£çƒ­é‡ç›ˆä½™å¯é€‰</li>
        <li>è®­ç»ƒæ—¥ / ä¼‘æ¯æ—¥åŠ¨æ€ç¢³æ°´</li>
        <li>æ”¯æŒå¯¼å‡º Excel</li>
    </ul>
    <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
</div>
        </div>

    </div>

    <!-- å‡¯åœ£ç‹ç¢³å¾ªç¯å·¥å…· -->
    <div id="kings-cycle-tool" class="tool-page">
        <div class="container">
            <header style="display:flex; align-items:center; gap:12px;">
    <button class="back-home-btn" onclick="backToHome()"style="position:static;margin:0;font-size:0.8rem;padding:5px 6px;"> è¿”å›</button>
    <div>
        <h1 style="margin:0;">Cyyå¥èº«è¥å…»æ™ºèƒ½å·¥å…·</h1>
        <p class="subtitle" style="margin:0;">æ©±çª—æœ‰å„ç§å‡è„‚å¿…å¤‡å¥½ç‰©,æ„Ÿè°¢å„ä½ä¹‰çˆ¶</p>
    </div>
</header>

            <div class="tabs">
             <button class="tab-btn active" data-tab="kings-cycle">å‡¯åœ£ç‹ç¢³å¾ªç¯</button>
    <button class="tab-btn" data-tab="orange-carb">æ©™å­ç¢³æ°´æ¸é™</button>
    <button class="tab-btn" data-tab="sixteen-eight">16+8è½»æ–­é£Ÿ</button>
    <button class="tab-btn" data-tab="bulk-plan">å¢è‚Œè®¡åˆ’</button>
            </div>

            <!-- å‡¯åœ£ç‹ç¢³å¾ªç¯éƒ¨åˆ† -->
            <div id="kings-cycle" class="tab-content active">
                <!-- å‡¯åœ£ç‹ç¢³å¾ªç¯å†…å®¹ä¿æŒä¸å˜ -->
                <div class="top-row">
                    <!-- åŸºç¡€ä¿¡æ¯ -->
                    <section>
                        <h3>ç¬¬ä¸€æ­¥ï¼šè¾“å…¥åŸºç¡€ä¿¡æ¯</h3>
                        <div class="basic-row">
                            <div class="input-group"><label>å½“å‰ä½“é‡(kg)</label><input type="number" id="weight" value="75" min="40" max="200"></div>
                            <div class="input-group target-weight-input-group">
                                <label>ç›®æ ‡ä½“é‡(Â±5kg)</label>
                                <div class="target-weight-controls">
                                    <button type="button" onclick="adjustTarget(-1)">âˆ’</button>
                                    <input type="tel" id="targetWeight" value="70" min="40" max="200" step="1" pattern="\d*" oninput="clipTargetWeight()">
                                    <button type="button" onclick="adjustTarget(1)">+</button>
                                </div>
                            </div>
                            <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="height" value="178" min="140" max="220"></div>
                            <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="age" value="30" min="18" max="80"></div>
                            <div class="input-group"><label>æ€§åˆ«</label>
                                <select id="gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
                            </div>
                        </div>
                    </section>

                    <!-- èƒšå‹ -->
                    <section>
                        <h3>ç¬¬äºŒæ­¥ï¼šé€‰æ‹©èƒšå‹</h3>
                        <div class="body-type-cards">
                            <div class="body-type-card selected" data-type="ectomorph"><h4>å¤–èƒšå‹</h4><p>æ˜“ç˜¦</p></div>
                            <div class="body-type-card" data-type="mesomorph"><h4>ä¸­èƒšå‹</h4><p>è‚Œè‚‰å‹</p></div>
                            <div class="body-type-card" data-type="endomorph"><h4>å†…èƒšå‹</h4><p>æ˜“èƒ–</p></div>
                        </div>
                        <!-- èƒšå‹å‚è€ƒå›¾ -->
<div style="text-align:center;margin-top:10px;">
  <a href="javascript:void(0)"
     onclick="toggleBodyTypeRef()"
     style="color:#E53E3E;font-size:.85rem;text-decoration:underline;">
    ğŸ“Œ ç‚¹å‡»æŸ¥çœ‹èƒšå‹å‚è€ƒå›¾
  </a>
  <div id="bodytype-ref" style="display:none;margin-top:12px;">
    <img src="https://s21.ax1x.com/2025/11/18/pZiceVf.md.jpg"  
         alt="èƒšå‹å‚è€ƒ" style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.15)">
    <p style="margin-top:6px;font-size:.75rem;color:#64748b">å¤–èƒš / ä¸­èƒš / å†…èƒš ä½“å‹å¯¹ç…§ï¼Œä»…ä¾›å‚è€ƒ</p>
  </div>
</div>
                    </section>

                    <!-- è®­ç»ƒè®¡åˆ’ -->
                    <section>
                        <h3>ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©è®­ç»ƒè®¡åˆ’</h3>
                        <div class="plan-cards">
                            <div class="plan-card selected" data-plan="1"><h4>ç»ƒ1ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="2"><h4>ç»ƒ2ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="3"><h4>ç»ƒ3ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="4"><h4>ç»ƒ4ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="custom"><h4>è‡ªå®šä¹‰</h4><p>è‡ªç”±</p></div>
                        </div>
                        <div class="custom-plan" id="customPlan">
                            <input placeholder="å‘¨ä¸€" id="cus-mon">
                            <input placeholder="å‘¨äºŒ" id="cus-tue">
                            <input placeholder="å‘¨ä¸‰" id="cus-wed">
                            <input placeholder="å‘¨å››" id="cus-thu">
                            <input placeholder="å‘¨äº”" id="cus-fri">
                            <input placeholder="å‘¨å…­" id="cus-sat">
                            <input placeholder="å‘¨æ—¥" id="cus-sun">
                        </div>
                    </section>

                    <!-- å®é‡ -->
                    <section>
                        <h3>è¥å…»ç´ è®¾ç½®ï¼ˆå·²æ ¹æ®èƒšå‹è‡ªåŠ¨åŒ¹é…ï¼Œæ— éœ€è°ƒæ•´ï¼‰</h3>
                        <div class="macro-row">
                            <div class="input-group"><label>ç¢³æ°´(g/kg)</label><input type="number" id="carbsPerKg" value="3.0" step="0.1" min="1" max="10"></div>
                            <div class="input-group"><label>è›‹ç™½è´¨(g/kg)</label><input type="number" id="proteinPerKg" value="1.3" step="0.1" min="0.8" max="3"></div>
                            <div class="input-group"><label>è„‚è‚ª(g/kg)</label><input type="number" id="fatPerKg" value="1.1" step="0.1" min="0.5" max="2"></div>
                        </div>
                    </section>

                    <!-- æ±‡æ€» -->
                    <section>
                        <h3>æœ€åä¸€æ­¥ï¼šç‚¹å‡»ä¸‹æ–¹è®¡ç®—è®¡åˆ’</h3>
                        <div class="summary-cards">
                            <div class="summary-card"><span class="val" id="bmrValue">1852</span><div class="lab">åŸºç¡€ä»£è°¢</div></div>
                            <div class="summary-card"><span class="val" id="tdeeValue">2352</span><div class="lab">æ¯æ—¥æ€»æ¶ˆè€—</div></div>
                            <div class="summary-card"><span class="val" id="proteinValue">98</span><div class="lab">æ¯æ—¥è›‹ç™½(g)</div></div>
                            <div class="summary-card"><span class="val" id="carbsValue">1575</span><div class="lab">æ¯å‘¨ç¢³æ°´(g)</div></div>
                        </div>
                    </section>
                </div>

                <div class="btn-row">
                    <button class="btn-calc" id="calculateBtn">è®¡ç®—è®¡åˆ’</button>
                    <button class="btn-down" id="downloadBtn">ä¸‹è½½Excel(ç”µè„‘ç«¯)</button>
                    <button class="btn-reset" id="resetBtn">é‡ç½®</button>
                    <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
                </div>

                <div class="target-info">
                    <h3>ç›®æ ‡ä½“é‡åˆ†æ<br>ç¢³å¾ªç¯é£Ÿè°±+è®­ç»ƒè®¡åˆ’ (æœ‰å¿)å¯åŠ QQï¼š504246035</h3>
                    <div class="target-stats">
                        <div class="target-stat">
                            <div class="value" id="weightDiffValue">-5</div>
                            <div class="label">ä½“é‡å·®(kg)</div>
                        </div>
                        <div class="target-stat">
                            <div class="value" id="weeklyCalorieDiffValue">-1400</div>
                            <div class="label">å‘¨çƒ­é‡å·®(kcal)</div>
                        </div>
                        <div class="target-stat">
                            <div class="value" id="daysNeededValue">42</div>
                            <div class="label">é¢„è®¡å¤©æ•°</div>
                        </div>
                        <div class="target-stat">
                            <div class="value" id="targetDate">2023-12-24</div>
                            <div class="label">é¢„è®¡å®Œæˆæ—¥æœŸ</div>
                        </div>
                    </div>
                </div>
<!-- ç«–å‘å‘¨è¡¨å®¹å™¨ -->
<div id="weekTables" class="week-tables"></div>

<!-- åŸè¡¨ç»§ç»­ä¿ç•™ï¼Œä½†åªéšè— tableï¼Œä¸éšè—åé¢çš„è¯´æ˜ -->
<div class="table-wrap">
  <table id="planTable" style="display:none;">  </table>
</div>
                <div class="table-wrap">
                    <table id="planTable">
                        <thead>
  <tr id="dayRow"><th rowspan="2">é¡¹ç›®</th></tr>
  <tr id="carbLevelRow"></tr>
</thead>
                        <tbody>
                            <tr class="band"><td>è®­ç»ƒéƒ¨ä½<br>(å¯åŒå‡»è‡ªå®šä¹‰)</td><td class="editable">ä¼‘æ¯</td><td class="editable">èƒ¸+ä¸‰å¤´</td><td class="editable">ä¼‘æ¯</td><td class="editable">èƒŒ+äºŒå¤´</td><td class="editable">ä¼‘æ¯</td><td class="editable">è…¿+è‚©</td><td class="editable">ä¼‘æ¯</td></tr>
                            <tr class="band"><td>ç¢³æ°´(g)</td><td id="carb-mon">192</td><td id="carb-tue">412</td><td id="carb-wed">124</td><td id="carb-thu">192</td><td id="carb-fri">124</td><td id="carb-sat">412</td><td id="carb-sun">124</td></tr>
                            <tr class="band"><td>è›‹ç™½è´¨(g)</td><td id="protein-mon">118</td><td id="protein-tue">118</td><td id="protein-wed">118</td><td id="protein-thu">118</td><td id="protein-fri">118</td><td id="protein-sat">118</td><td id="protein-sun">118</td></tr>
                            <tr class="band"><td>è„‚è‚ª(g)</td><td id="fat-mon">64</td><td id="fat-tue">41</td><td id="fat-wed">137</td><td id="fat-thu">64</td><td id="fat-fri">137</td><td id="fat-sat">41</td><td id="fat-sun">137</td></tr>
                            <tr class="band"><td>çƒ­é‡(kcal)</td><td id="cal-mon">1817</td><td id="cal-tue">2490</td><td id="cal-wed">2202</td><td id="cal-thu">1817</td><td id="cal-fri">2202</td><td id="cal-sat">2490</td><td id="cal-sun">2202</td></tr>
                            <tr class="band"><td>ç¼ºå£/ç›ˆä½™</td><td id="diff-mon">-535</td><td id="diff-tue">138</td><td id="diff-wed">-150</td><td id="diff-thu">-535</td><td id="diff-fri">-150</td><td id="diff-sat">138</td><td id="diff-sun">-150</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="notes">
                    <h3>ğŸ“Œ ç¢³å¾ªç¯è®¡åˆ’è¯´æ˜</h3>
                    <ul>
                        <li>å¦‚æœä½ éª¨æ¶å°ã€è‚©çª„ã€åƒä¸èƒ–ã€å¢è‚Œæ…¢ï¼š<strong>â†’ åå¤–èƒšå‹</strong></li>
                        <li>å¦‚æœä½ è‚©å®½è…°çª„ã€è‚Œè‚‰å®¹æ˜“é•¿ï¼š<strong>â†’ åä¸­èƒšå‹</strong></li>
                        <li>å¦‚æœä½ éª¨æ¶å¤§ã€è…°è…¹æ˜“å›¤è‚‰ï¼š<strong>â†’ åå†…èƒšå‹</strong></li>
                        <li><span class="tag high">é«˜ç¢³æ—¥</span>ï¼šç¢³æ°´å å‘¨æ€»ç¢³æ°´çš„50%ï¼Œå»ºè®®æ‘„å…¥ç²¾åˆ¶ç¢³æ°´ï¼ˆå¦‚ç™½ç±³ã€ç™½é¢åŒ…ï¼‰</li>
                        <li><span class="tag med">ä¸­ç¢³æ—¥</span>ï¼šç¢³æ°´å å‘¨æ€»ç¢³æ°´çš„35%ï¼Œå»ºè®®æ··åˆç²¾ç¢³å’Œç²—ç¢³</li>
                        <li><span class="tag low">ä½ç¢³æ—¥</span>ï¼šç¢³æ°´å å‘¨æ€»ç¢³æ°´çš„15%ï¼Œå»ºè®®æ‘„å…¥ç²—ç¢³ï¼ˆå¦‚ç³™ç±³ã€ç‡•éº¦ï¼‰</li>
                        <li><strong>çƒ­é‡æ¢ç®—ï¼š</strong> ç¢³/è›‹ç™½ 4 kcal/gï¼Œè„‚è‚ª 9 kcal/gã€‚</li>
                        <li><strong>ä½“é‡å˜åŒ–ä¼°ç®—ï¼š</strong> æ¯å‡å°‘7700 kcalçƒ­é‡çº¦å‡å°‘1 kgä½“é‡ï¼Œæ¯å¢åŠ 7700 kcalçƒ­é‡çº¦å¢åŠ 1 kgä½“é‡ã€‚</li>
                    </ul>
                </div>
            </div>
            <!-- 16+8è½»æ–­é£Ÿéƒ¨åˆ† -->
<div id="sixteen-eight" class="tab-content">
    <div class="top-row">
        <!-- åŸºç¡€ä¿¡æ¯ -->
        <section>
            <h3>ç¬¬ä¸€æ­¥ï¼šè¾“å…¥åŸºç¡€ä¿¡æ¯</h3>
            <div class="basic-row">
                <div class="input-group"><label>å½“å‰ä½“é‡(kg)</label><input type="number" id="fast-weight" value="70" min="40" max="200"></div>
                <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="fast-height" value="175" min="140" max="220"></div>
                <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="fast-age" value="30" min="18" max="80"></div>
                <div class="input-group"><label>æ€§åˆ«</label>
                    <select id="fast-gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
                </div>
            </div>
        </section>

        <!-- è¿›é£Ÿçª—å£è®¾ç½® -->
        <section>
            <h3>ç¬¬äºŒæ­¥ï¼šé€‰æ‹©è¿›é£Ÿçª—å£</h3>
            <div class="plan-cards">
                <div class="plan-card selected" data-window="12-20"><h4>12:00-20:00</h4><p>æ¨èçª—å£</p></div>
                <div class="plan-card" data-window="10-18"><h4>10:00-18:00</h4><p>æ—©åˆé¤å‹</p></div>
                <div class="plan-card" data-window="13-21"><h4>13:00-21:00</h4><p>æ™šèµ·å‹</p></div>
                <div class="plan-card" data-window="custom"><h4>è‡ªå®šä¹‰</h4><p>è‡ªç”±è®¾ç½®</p></div>
            </div>
            <div class="custom-plan" id="fast-custom-window" style="display:none;">
                <input type="time" id="fast-start" value="12:00">
                <span style="align-self:center;">è‡³</span>
                <input type="time" id="fast-end" value="20:00">
            </div>
        </section>

        <!-- æ´»åŠ¨æ°´å¹³ -->
        <section>
            <h3>ç¬¬ä¸‰æ­¥ï¼šæ—¥å¸¸æ´»åŠ¨æ°´å¹³</h3>
            <div class="bulk-level-cards">
                <div class="bulk-level-card selected" data-activity="1.2"><h4>ä¹…å</h4><p>åŠå…¬å®¤/å‡ ä¹æ— è¿åŠ¨</p></div>
                <div class="bulk-level-card" data-activity="1.375"><h4>è½»åº¦æ´»è·ƒ</h4><p>æ¯å‘¨è½»åº¦1-3å¤©</p></div>
                <div class="bulk-level-card" data-activity="1.55"><h4>ä¸­åº¦æ´»è·ƒ</h4><p>æ¯å‘¨ä¸­åº¦3-5å¤©</p></div>
            </div>
        </section>

        <!-- è®¡ç®—ç»“æœ -->
        <section>
            <h3>æ‚¨çš„16+8è®¡åˆ’</h3>
            <div class="quick-stats">
                <div class="bulk-stat"><div class="value" id="fast-bmr">0</div><div class="label">åŸºç¡€ä»£è°¢</div></div>
                <div class="bulk-stat"><div class="value" id="fast-tdee">0</div><div class="label">æ¯æ—¥æ¶ˆè€—</div></div>
                <div class="bulk-stat"><div class="value" id="fast-calories">0</div><div class="label">å»ºè®®çƒ­é‡</div></div>
                <div class="bulk-stat"><div class="value" id="fast-protein">0</div><div class="label">è›‹ç™½è´¨(g)</div></div>
            </div>
        </section>
        <section style="margin-top: 20px;">
    <h3>ğŸ“Š è®¡ç®—é€»è¾‘è¯¦æƒ…</h3>
    <div id="fast-logic-box" style="padding: 12px; background: #f8fafc; border-radius: 8px; font-size: .75rem; color: #475569; line-height: 1.6; border: 1px solid #e2e8f0;">
        <!-- è®¡ç®—é€»è¾‘å†…å®¹å°†åŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
        ç‚¹å‡»"è®¡ç®—è®¡åˆ’"æŒ‰é’®åï¼Œæ­¤å¤„å°†æ˜¾ç¤ºè¯¦ç»†çš„è®¡ç®—é€»è¾‘
    </div>
</section>
    </div>
<!-- åœ¨btn-rowä¹‹åï¼Œnotesä¹‹å‰æ·»åŠ  -->
    <div class="btn-row">
        <button class="btn-calc" id="fast-calculateBtn">è®¡ç®—è®¡åˆ’</button>
        <button class="btn-down" id="fast-downloadBtn">ä¸‹è½½è®¡åˆ’</button>
        <button class="btn-reset" id="fast-resetBtn">é‡ç½®</button>
        <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
    </div>
<!-- ä¸€å‘¨è½»æ–­é£Ÿè®¡åˆ’è¡¨ -->
<div class="target-info">
    <h3>ä¸€å‘¨è½»æ–­é£Ÿè®¡åˆ’<br>16+8é£Ÿè°±+è®­ç»ƒè®¡åˆ’(æœ‰å¿)å¯åŠ QQï¼š504246035</h3>
    <div class="table-wrap">
        <table id="fast-week-table">
            <thead>
                <tr>
                    <th>æ˜ŸæœŸ</th>
                    <th>è¿›é£Ÿçª—å£</th>
                    <th>ç¢³æ°´(g)</th>
                    <th>è›‹ç™½è´¨(g)</th>
                    <th>è„‚è‚ª(g)</th>
                    <th>æ€»çƒ­é‡(kcal)</th>
                    <th>é¤æ¬¡å®‰æ’</th>
                </tr>
            </thead>
            
            <tbody>
                <tr>
                    <td>å‘¨ä¸€</td>
                    <td id="fast-mon-window">12:00-20:00</td>
                    <td id="fast-mon-carb">0</td>
                    <td id="fast-mon-protein">0</td>
                    <td id="fast-mon-fat">0</td>
                    <td id="fast-mon-calories">0</td>
                    <td class="editable">åˆé¤+æ™šé¤</td>
                </tr>
                <tr>
                    <td>å‘¨äºŒ</td>
                    <td id="fast-tue-window">12:00-20:00</td>
                    <td id="fast-tue-carb">0</td>
                    <td id="fast-tue-protein">0</td>
                    <td id="fast-tue-fat">0</td>
                    <td id="fast-tue-calories">0</td>
                    <td class="editable">åˆé¤+æ™šé¤</td>
                </tr>
                <tr>
                    <td>å‘¨ä¸‰</td>
                    <td id="fast-wed-window">12:00-20:00</td>
                    <td id="fast-wed-carb">0</td>
                    <td id="fast-wed-protein">0</td>
                    <td id="fast-wed-fat">0</td>
                    <td id="fast-wed-calories">0</td>
                    <td class="editable">åˆé¤+æ™šé¤</td>
                </tr>
                <tr>
                    <td>å‘¨å››</td>
                    <td id="fast-thu-window">12:00-20:00</td>
                    <td id="fast-thu-carb">0</td>
                    <td id="fast-thu-protein">0</td>
                    <td id="fast-thu-fat">0</td>
                    <td id="fast-thu-calories">0</td>
                    <td class="editable">åˆé¤+æ™šé¤</td>
                </tr>
                <tr>
                    <td>å‘¨äº”</td>
                    <td id="fast-fri-window">12:00-20:00</td>
                    <td id="fast-fri-carb">0</td>
                    <td id="fast-fri-protein">0</td>
                    <td id="fast-fri-fat">0</td>
                    <td id="fast-fri-calories">0</td>
                    <td class="editable">åˆé¤+æ™šé¤</td>
                </tr>
                <tr>
                    <td>å‘¨å…­</td>
                    <td id="fast-sat-window">12:00-20:00</td>
                    <td id="fast-sat-carb">0</td>
                    <td id="fast-sat-protein">0</td>
                    <td id="fast-sat-fat">0</td>
                    <td id="fast-sat-calories">0</td>
                    <td class="editable">åˆé¤+æ™šé¤</td>
                </tr>
                <tr>
                    <td>å‘¨æ—¥</td>
                    <td id="fast-sun-window">12:00-20:00</td>
                    <td id="fast-sun-carb">0</td>
                    <td id="fast-sun-protein">0</td>
                    <td id="fast-sun-fat">0</td>
                    <td id="fast-sun-calories">0</td>
                    <td class="editable">åˆé¤+æ™šé¤</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


    <div class="notes">
        <h3>ğŸ“Œ 16+8è½»æ–­é£Ÿè¯´æ˜</h3>
        <ul>
            <li><strong>è¿›é£Ÿçª—å£ï¼š</strong> åœ¨8å°æ—¶å†…å®Œæˆæ‰€æœ‰è¿›é£Ÿï¼Œå…¶ä½™16å°æ—¶åªå–æ°´/æ— ç³–é¥®å“</li>
            <li><strong>çƒ­é‡æ§åˆ¶ï¼š</strong> è¿›é£Ÿçª—å£å†…ä»éœ€æ§åˆ¶æ€»çƒ­é‡ï¼Œå»ºè®®åˆ¶é€ 300-500kcalçƒ­é‡ç¼ºå£</li>
            <li><strong>è›‹ç™½è´¨ä¼˜å…ˆï¼š</strong> ç¡®ä¿æ‘„å…¥è¶³å¤Ÿè›‹ç™½è´¨ï¼Œé˜²æ­¢è‚Œè‚‰æµå¤±</li>
            <li><strong>æ°´åˆ†è¡¥å……ï¼š</strong> ç¦é£ŸæœŸé—´å¤šå–æ°´ï¼Œæœ‰åŠ©äºæ§åˆ¶é¥¥é¥¿æ„Ÿ</li>
            <li><strong>é€‚åº”æœŸï¼š</strong> å‰3-7å¤©ä¸ºé€‚åº”æœŸï¼Œå¯èƒ½å‡ºç°è½»å¾®ä¸é€‚ï¼Œå±æ­£å¸¸ç°è±¡</li>
            <li><strong>ä¸é€‚åˆäººç¾¤ï¼š</strong> å­•å¦‡ã€å“ºä¹³æœŸã€æœ‰è¿›é£Ÿéšœç¢å²ã€ç³–å°¿ç—…æ‚£è€…æ…ç”¨</li>
        </ul>
    </div>
</div>
<!-- å¢è‚Œè®¡åˆ’éƒ¨åˆ† -->
<div id="bulk-plan" class="tab-content">
    <div class="top-row">
        <!-- åŸºç¡€ä¿¡æ¯ -->
        <section>
            <h3>ç¬¬ä¸€æ­¥ï¼šåŸºç¡€ä¿¡æ¯</h3>
            <div class="basic-row">
                <div class="input-group"><label>ä½“é‡(kg)</label><input type="number" id="bulk-weight" value="70" min="40" max="150"></div>
                <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="bulk-height" value="175" min="140" max="220"></div>
                <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="bulk-age" value="25" min="18" max="60"></div>
                <div class="input-group"><label>æ€§åˆ«</label>
                    <select id="bulk-gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
                </div>
            </div>
        </section>

        <!-- æ´»åŠ¨ç³»æ•° -->
        <section>
            <h3>ç¬¬äºŒæ­¥ï¼šæ—¥å¸¸æ´»åŠ¨å¼ºåº¦</h3>
            <div class="bulk-level-cards" id="pal-cards">
                <div class="bulk-level-card selected" data-pal="1.2"><h4>ä¹…å</h4><p>åŠå…¬å®¤/å‡ ä¹æ— è¿åŠ¨</p></div>
                <div class="bulk-level-card" data-pal="1.375"><h4>è½»åº¦æ´»è·ƒ</h4><p>æ¯å‘¨è½»åº¦1-3å¤©</p></div>
                <div class="bulk-level-card" data-pal="1.55"><h4>ä¸­åº¦æ´»è·ƒ</h4><p>æ¯å‘¨ä¸­åº¦3-5å¤©</p></div>
                <div class="bulk-level-card" data-pal="1.725"><h4>éå¸¸æ´»è·ƒ</h4><p>æ¯å‘¨é«˜å¼ºåº¦6-7å¤©</p></div>
                <div class="bulk-level-card" data-pal="1.9"><h4>èŒä¸šè¿åŠ¨å‘˜</h4><p>æ¯å¤©é«˜å¼ºåº¦</p></div>
            </div>
        </section>

        <!-- è®­ç»ƒç»éªŒ -->
        <section>
            <h3>ç¬¬ä¸‰æ­¥ï¼šè®­ç»ƒç»éªŒ</h3>
            <div class="bulk-level-cards" id="exp-cards">
                <div class="bulk-level-card selected" data-exp="novice"><h4>æ–°æ‰‹</h4><p>ç³»ç»Ÿè®­ç»ƒ &lt;1 å¹´</p></div>
                <div class="bulk-level-card" data-exp="intermediate"><h4>ä¸­çº§</h4><p>ç³»ç»Ÿè®­ç»ƒ 1-3 å¹´</p></div>
                <div class="bulk-level-card" data-exp="advanced"><h4>é«˜çº§</h4><p>ç³»ç»Ÿè®­ç»ƒ &gt;3 å¹´</p></div>
            </div>
            
        </section>

        <!-- çƒ­é‡ç›ˆä½™ -->
        <section>
            <h3>ç¬¬å››æ­¥ï¼šçƒ­é‡ç›ˆä½™</h3>
            <div class="bulk-level-cards" id="surplus-cards">
                <div class="bulk-level-card selected" data-surplus="200"><h4>å¹²å‡€å¢è‚Œ(æ¨è)</h4><p>+200 kcal/æ—¥</p></div>
                <div class="bulk-level-card" data-surplus="350"><h4>ä¸€èˆ¬å¢è‚Œ(ä¸¥æ ¼è®­ç»ƒ)</h4><p>+350 kcal/æ—¥</p></div>
                <div class="bulk-level-card" data-surplus="550"><h4>ç˜¦å­è„å¢è‚Œ(æ’éª¨ç²¾é¦–é€‰)</h4><p>+550 kcal/æ—¥</p></div>
                
            </div>
        </section>
<!-- æ–°å¢ï¼šè®­ç»ƒè®¡åˆ’é€‰æ‹© -->
    <section>
      <h3>ç¬¬äº”æ­¥ï¼šé€‰æ‹©è®­ç»ƒè®¡åˆ’ å¢è‚Œé£Ÿè°±+è®­ç»ƒè®¡åˆ’(æœ‰å¿)åŠ QQï¼š504246035</h3>
      <div class="plan-cards" id="bulk-plan-cards">
        <div class="plan-card selected" data-plan="1"><h4>ç»ƒ1ä¼‘1</h4><p>å¾ªç¯</p></div>
        <div class="plan-card" data-plan="2"><h4>ç»ƒ2ä¼‘1</h4><p>å¾ªç¯</p></div>
        <div class="plan-card" data-plan="3"><h4>ç»ƒ3ä¼‘1</h4><p>å¾ªç¯</p></div>
        <div class="plan-card" data-plan="4"><h4>ç»ƒ4ä¼‘1</h4><p>å¾ªç¯</p></div>
        <div class="plan-card" data-plan="custom"><h4>è‡ªå®šä¹‰</h4><p>è‡ªç”±</p></div>
      </div>
      <!-- è‡ªå®šä¹‰è¾“å…¥åŒº -->
      <div class="custom-plan" id="bulk-custom-plan" style="display:none;gap:4px;flex-wrap:wrap;margin-top:8px">
        <input placeholder="å‘¨ä¸€" id="bulk-cus-mon">
        <input placeholder="å‘¨äºŒ" id="bulk-cus-tue">
        <input placeholder="å‘¨ä¸‰" id="bulk-cus-wed">
        <input placeholder="å‘¨å››" id="bulk-cus-thu">
        <input placeholder="å‘¨äº”" id="bulk-cus-fri">
        <input placeholder="å‘¨å…­" id="bulk-cus-sat">
        <input placeholder="å‘¨æ—¥" id="bulk-cus-sun">
      </div>
    </section>
        <!-- ç»“æœæ±‡æ€» -->
        <section>
            <h3>è®¡ç®—ç»“æœ </h3>
            <div class="bulk-stats">
                <div class="bulk-stat"><div class="value" id="bulk-bmr">0</div><div class="label">åŸºç¡€ä»£è°¢(BMR)</div></div>
                <div class="bulk-stat"><div class="value" id="bulk-tdee">0</div><div class="label">æ¯æ—¥æ¶ˆè€—(TDEE)</div></div>
                <div class="bulk-stat"><div class="value" id="bulk-target">0</div><div class="label">è®­ç»ƒæ—¥æ‘„å…¥çƒ­é‡</div></div>
                <div class="bulk-stat"><div class="value" id="bulk-protein">0</div><div class="label">æ¯æ—¥æ‘„å…¥è›‹ç™½è´¨(g)</div></div>
                <div class="bulk-stat"><div class="value" id="bulk-carb-display">0</div><div class="label">è®­ç»ƒæ—¥ç¢³æ°´(g)</div></div>
                <div class="bulk-stat"><div class="value" id="bulk-rest-carb-display">0</div><div class="label">ä¼‘æ¯æ—¥ç¢³æ°´(g)</div></div>
		<div class="bulk-stat"><div class="value" id="bulk-fat-display">0</div><div class="label">æ¯æ—¥è„‚è‚ª(g)</div></div>
		<!-- é¢„è®¡æ¯å‘¨å¢é‡ -->
<div class="bulk-stat">
  <div class="value" id="bulk-weekly-gain">â€”</div>
  <div class="label">é¢„è®¡æ¯å‘¨å¢é‡(kg)</div>
</div>
            </div>
        </section>
    </div>

    <div class="btn-row">
        <button class="btn-calc" id="bulk-calc">è®¡ç®—è®¡åˆ’</button>
        <button class="btn-down" id="bulk-dl">ä¸‹è½½Excel(ç”µè„‘ç«¯)</button>
        <button class="btn-reset" id="bulk-reset">é‡ç½®</button>
        <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
    </div>

<!-- è¯¦ç»†å®é‡è¡¨æ ¼ -->
<div class="table-wrap">
  <table id="bulk-week-table">
<thead>
  <tr>
    <th>é¡¹ç›®</th>
    <th>ä¸€</th><th>äºŒ</th><th>ä¸‰</th><th>å››</th><th>äº”</th><th>å…­</th><th>æ—¥</th>
  </tr>
</thead>
    <tbody>
      <tr class="band"><td>è®­ç»ƒéƒ¨ä½<br>(å¯åŒå‡»è‡ªå®šä¹‰)</td>
        <td class="editable" data-day="0">èƒ¸+ä¸‰å¤´</td>
        <td class="editable" data-day="1">èƒŒ+äºŒå¤´</td>
        <td class="editable" data-day="2">ä¼‘æ¯</td>
        <td class="editable" data-day="3">è…¿+è‚©</td>
        <td class="editable" data-day="4">ä¼‘æ¯</td>
        <td class="editable" data-day="5">èƒ¸+ä¸‰å¤´</td>
        <td class="editable" data-day="6">ä¼‘æ¯</td>
      </tr>
      <tr class="band"><td>ç¢³æ°´(g)</td>
        <td id="bulk-carb-0">0</td><td id="bulk-carb-1">0</td><td id="bulk-carb-2">0</td>
        <td id="bulk-carb-3">0</td><td id="bulk-carb-4">0</td><td id="bulk-carb-5">0</td><td id="bulk-carb-6">0</td>
      </tr>
      <tr class="band"><td>è›‹ç™½è´¨(g)</td>
        <td id="bulk-pro-0">0</td><td id="bulk-pro-1">0</td><td id="bulk-pro-2">0</td>
        <td id="bulk-pro-3">0</td><td id="bulk-pro-4">0</td><td id="bulk-pro-5">0</td><td id="bulk-pro-6">0</td>
      </tr>
      <tr class="band"><td>è„‚è‚ª(g)</td>
        <td id="bulk-fat-0">0</td><td id="bulk-fat-1">0</td><td id="bulk-fat-2">0</td>
        <td id="bulk-fat-3">0</td><td id="bulk-fat-4">0</td><td id="bulk-fat-5">0</td><td id="bulk-fat-6">0</td>
      </tr>
      <tr class="band"><td>çƒ­é‡(kcal)</td>
        <td id="bulk-cal-0">0</td><td id="bulk-cal-1">0</td><td id="bulk-cal-2">0</td>
        <td id="bulk-cal-3">0</td><td id="bulk-cal-4">0</td><td id="bulk-cal-5">0</td><td id="bulk-cal-6">0</td>
      </tr>
      <tr class="band"><td>ç›ˆä½™/ç¼ºå£</td>
        <td id="bulk-diff-0">0</td><td id="bulk-diff-1">0</td><td id="bulk-diff-2">0</td>
        <td id="bulk-diff-3">0</td><td id="bulk-diff-4">0</td><td id="bulk-diff-5">0</td><td id="bulk-diff-6">0</td>
      </tr>
    </tbody>
  </table>
</div>

    <div class="notes">
        <h3>ğŸ“Œ å¢è‚Œè®¡åˆ’è¯´æ˜</h3>
        <ul>
            <li>è›‹ç™½è´¨æŒ‰è®­ç»ƒç»éªŒåˆ†çº§ï¼šæ–°æ‰‹ 1.6 g/kgã€ä¸­çº§ 1.8 g/kgã€é«˜çº§ 2 g/kgã€‚</li>
            <li>è„‚è‚ªæŒ‰è®­ç»ƒç»éªŒåˆ†çº§ï¼šæ–°æ‰‹ 0.9 g/kgã€ä¸­çº§ 1.0g/kgã€é«˜çº§ 1.2 g/kgã€‚</li>
            <li>ç¢³æ°´æŒ‰è®­ç»ƒç»éªŒåˆ†çº§ï¼šæ–°æ‰‹ 3.5 g/kgã€ä¸­çº§ 4.5g/kgã€é«˜çº§ 5 g/kgã€‚</li>
            <li>å‰©ä½™çƒ­é‡å…¨éƒ¨ç»™ç¢³æ°´ï¼Œä¼‘æ¯æ—¥ -15% ç¢³æ°´ã€‚</li>
        </ul>
    </div>
</div>
            <!-- æ©™å­ç¢³æ°´æ¸é™éƒ¨åˆ† -->
            <div id="orange-carb" class="tab-content">
                <div class="top-row">
                    <!-- åŸºç¡€ä¿¡æ¯ -->
                    <section>
                        <h3>ç¬¬ä¸€æ­¥ï¼šè¾“å…¥åŸºç¡€ä¿¡æ¯</h3>
                        <div class="basic-row">
                            <div class="input-group"><label>å½“å‰ä½“é‡(kg)</label><input type="number" id="orange-weight" value="80" min="40" max="200"></div>
                            <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="orange-height" value="175" min="140" max="220"></div>
                            <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="orange-age" value="32" min="18" max="80"></div>
                            <div class="input-group"><label>æ€§åˆ«</label>
                                <select id="orange-gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
                            </div>
                        </div>
                    </section>

                    <!-- è®­ç»ƒä¿¡æ¯ -->
                    <section>
                        <h3>ç¬¬äºŒæ­¥ï¼šè®­ç»ƒä¿¡æ¯</h3>
                        <div class="orange-input-group">
                            <label>è®­ç»ƒæ—¶é•¿(åˆ†é’Ÿ)</label>
                            <input type="number" id="train-time" value="60" min="30" max="180">
                        </div>
                        <div class="orange-input-group">
                            <label>è®­ç»ƒå¼ºåº¦ç³»æ•°</label>
                            <select id="train-intensity">
                                <option value="5">æ–°æ‰‹/å¥³ç”Ÿ (5)</option>
                                <option value="8" selected>æ™®é€šå¥èº«çˆ±å¥½è€… (8)</option>
                                <option value="10">é«˜å¼ºåº¦è®­ç»ƒè€… (10)</option>
                            </select>
                        </div>
                    </section>

                    <!-- è¥å…»ç´ æ¯”ä¾‹ -->
                    <section>
                        <h3>ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©è¥å…»ç´ æ¯”ä¾‹</h3>
                        <div class="orange-ratio-cards">
                            <div class="orange-ratio-card selected" data-ratio="532">
                                <h4>532æ¯”ä¾‹</h4>
                                <p>ç¢³æ°´50% è›‹ç™½30% è„‚è‚ª20%</p>
                            </div>
                            <div class="orange-ratio-card" data-ratio="442">
                                <h4>442æ¯”ä¾‹<br>(ç¢³æ°´å¸æ”¶è¾ƒå¥½)</h4>
                                <p>ç¢³æ°´40% è›‹ç™½40% è„‚è‚ª20%</p>
                            </div>
                            <div class="orange-ratio-card" data-ratio="custom">
                                <h4>è‡ªå®šä¹‰æ¯”ä¾‹</h4>
                                <p>è‡ªå®šä¹‰è¥å…»ç´ æ¯”ä¾‹</p>
                            </div>
                        </div>
                        
                        <!-- è‡ªå®šä¹‰æ¯”ä¾‹è¾“å…¥ -->
                        <div id="custom-ratio-inputs" style="display: none; margin-top: 10px;">
                            <div class="custom-ratio-inputs">
                                <div class="custom-ratio-input">
                                    <label>ç¢³æ°´(%)</label>
                                    <input type="number" id="custom-carb" value="50" min="0" max="100">
                                </div>
                                <div class="custom-ratio-input">
                                    <label>è›‹ç™½è´¨(%)</label>
                                    <input type="number" id="custom-protein" value="30" min="0" max="100">
                                </div>
                                <div class="custom-ratio-input">
                                    <label>è„‚è‚ª(%)</label>
                                    <input type="number" id="custom-fat" value="20" min="0" max="100">
                                </div>
                            </div>
                            <div class="ratio-sum" id="ratio-sum">æ€»å’Œ: 100%</div>
                        </div>
                    </section>
                    
                    <!-- å‡é‡ç›®æ ‡ -->
                    <section>
                        <h3>ç¬¬å››æ­¥ï¼šè®¾ç½®å‡é‡ç›®æ ‡</h3>
                        <div class="weight-loss-slider">
                            <label>æ¯æœˆå‡é‡ç™¾åˆ†æ¯” (3-5%)</label>
                            <div class="slider-container">
                                <input type="range" id="weight-loss-percent" min="3" max="5" step="0.1" value="3.5">
                                <span class="slider-value" id="weight-loss-value">3.5%</span>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="btn-row">
                    <button class="btn-calc" id="orange-calculateBtn">è®¡ç®—è®¡åˆ’</button>
                    <button class="btn-down" id="orange-downloadBtn">ä¸‹è½½Excel(ç”µè„‘ç«¯)</button>
                    <button class="btn-reset" id="orange-resetBtn">é‡ç½®</button>
                    <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
                </div>

                <div class="orange-results">
                    <h3>ç¢³æ°´æ¸é™é£Ÿè°±+è®­ç»ƒè®¡åˆ’(æœ‰å¿)å¯åŠ QQï¼š504246035</h3>
                    <div class="orange-stats">
                        <div class="orange-stat">
                            <div class="value" id="orange-bmrValue">0</div>
                            <div class="label">åŸºç¡€ä»£è°¢(BMR)</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-trainCalories">0</div>
                            <div class="label">è®­ç»ƒæ¶ˆè€—çƒ­é‡</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-tdeeValue">0</div>
                            <div class="label">æ¯æ—¥æ€»æ¶ˆè€—(TDEE)</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-initialCarbs">0</div>
                            <div class="label">åˆå§‹ç¢³æ°´(g)</div>
                        </div>
                    </div>

                    <div class="orange-stats">
                        <div class="orange-stat">
                            <div class="value" id="orange-protein">0</div>
                            <div class="label">è›‹ç™½è´¨(g)</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-fat">0</div>
                            <div class="label">è„‚è‚ª(g)</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-weeklyLoss">0</div>
                            <div class="label">å‘¨å‡é‡ç›®æ ‡(kg)</div>
                        </div>
                        <div class="orange-stat">
                            <div class="value" id="orange-adjustment">15</div>
                            <div class="label">ç¢³æ°´è°ƒæ•´é‡(g)</div>
                        </div>
                    </div>
                    
                    <div class="orange-stats">
                      
                    </div>

                    <div class="table-wrap">
                        <table class="orange-table" id="orange-planTable">
                            <thead>
                                <tr>
                                    <th>å‘¨æ•°</th>
                                    <th>æ¯æ—¥ç¢³æ°´(g)</th>
                                    <th>æ¯æ—¥è›‹ç™½è´¨(g)</th>
                                    <th>æ¯æ—¥è„‚è‚ª(g)</th>
                                    <th>é¢„æœŸä½“é‡(kg)</th>
                                    <th>å‘¨å‡é‡ç›®æ ‡(kg)</th>
                                    <th>è°ƒæ•´è¯´æ˜</th>
                                </tr>
                            </thead>
                            <tbody id="orange-planBody">
                                <!-- è®¡åˆ’å†…å®¹å°†é€šè¿‡JSç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="notes">
                    <h3>ğŸ“Œ ç¢³æ°´æ¸é™è®¡åˆ’è¯´æ˜</h3>
                    <ul>
                        <li><strong>è®¡ç®—åŸºç¡€ä»£è°¢(BMR)ï¼š</strong> ä½¿ç”¨ Mifflin-St Jeor å…¬å¼è®¡ç®—</li>
                        <li><strong>è®­ç»ƒæ¶ˆè€—çƒ­é‡ï¼š</strong> è®­ç»ƒæ—¶é•¿(åˆ†é’Ÿ) Ã— å¼ºåº¦ç³»æ•°</li>
                        <li><strong>æ¯æ—¥æ€»æ¶ˆè€—(TDEE)ï¼š</strong> BMR + è®­ç»ƒæ¶ˆè€—çƒ­é‡</li>
                        <li><strong>åˆå§‹ç¢³æ°´è®¡ç®—ï¼š</strong> TDEE Ã— ç¢³æ°´æ¯”ä¾‹ Ã· 4</li>
                        <li><strong>å‘¨å‡é‡ç›®æ ‡ï¼š</strong> æ¯æœˆå‡é‡3-5%ï¼Œå¹³å‡åˆ°æ¯å‘¨</li>
                        <li><strong>ç¢³æ°´è°ƒæ•´ï¼š</strong> æ¯å‘¨å¦‚æœªè¾¾åˆ°å‡é‡ç›®æ ‡ï¼Œå‡å°‘ç¢³æ°´15-30g</li>
                        <li><strong>åœæ­¢è°ƒæ•´ï¼š</strong> å½“ç¢³æ°´é™è‡³100gå·¦å³æˆ–è¾¾åˆ°ç†æƒ³ä½“è„‚ç‡æ—¶åœæ­¢</li>
                    </ul>
                </div>
            </div>

            <footer>Cyyå¥èº«è¥å…»æ™ºèƒ½å·¥å…·Â© 2026 Â· Cyyå¥èº«(å‡¯é—¨)</footer>
        </div>
    </div>

    <script>
        // é¡µé¢å¯¼èˆªåŠŸèƒ½
function selectTool(tool) {
    document.getElementById('home-page').style.display = 'none';
    
    if (tool === 'kings-cycle') {
        document.getElementById('kings-cycle-tool').style.display = 'block';
        document.querySelector('.tab-btn[data-tab="kings-cycle"]').click();
    } else if (tool === 'orange-carb') {
        document.getElementById('kings-cycle-tool').style.display = 'block';
        document.querySelector('.tab-btn[data-tab="orange-carb"]').click();
    } else if (tool === 'sixteen-eight') {
        document.getElementById('kings-cycle-tool').style.display = 'block';
        document.querySelector('.tab-btn[data-tab="sixteen-eight"]').click();
    } else if (tool === 'bulk-plan') {
        document.getElementById('kings-cycle-tool').style.display = 'block';
        document.querySelector('.tab-btn[data-tab="bulk-plan"]').click();
    }
}
        
        function backToHome() {
            document.getElementById('kings-cycle-tool').style.display = 'none';
            document.getElementById('home-page').style.display = 'block';
        }
        
        /* ---------- é€šç”¨å·¥å…·å‡½æ•° ---------- */
        const $ = id => document.getElementById(id)

        // é€‰é¡¹å¡åˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'))
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'))
                
                // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                btn.classList.add('active')
                $(btn.dataset.tab).classList.add('active')
                // åˆ‡æ¢åˆ°å¢è‚Œè®¡åˆ’æ—¶è‡ªåŠ¨è®¡ç®—
        if (btn.dataset.tab === 'bulk-plan') {
            calcBulk();
        }
        // åˆ‡æ¢åˆ°16+8è½»æ–­é£Ÿæ—¶è‡ªåŠ¨è®¡ç®—
        if (btn.dataset.tab === 'sixteen-eight') {
            calculateFast();
        }
        // åˆ‡æ¢åˆ°æ©™å­ç¢³æ°´æ¸é™æ—¶è‡ªåŠ¨è®¡ç®—
        if (btn.dataset.tab === 'orange-carb') {
            calcOrangeCarb();
        }
        // åˆ‡æ¢åˆ°å‡¯åœ£ç‹ç¢³å¾ªç¯æ—¶è‡ªåŠ¨è®¡ç®—
        if (btn.dataset.tab === 'kings-cycle') {
            calcKingsCycle();
        }
            })
        })

        /* ---------- å‡¯åœ£ç‹ç¢³å¾ªç¯åŠŸèƒ½ ---------- */
        // èƒšå‹é€‰æ‹©
        const bodyCards = [...document.querySelectorAll('.body-type-card')]
        bodyCards.forEach(c => c.addEventListener('click', () => {
            bodyCards.forEach(x => x.classList.remove('selected'))
            c.classList.add('selected')
            setMacros(c.dataset.type)
        }))
        function setMacros(type){
            const map = {ectomorph:{c:3,p:1.3,f:1.1},mesomorph:{c:2.5,p:1.3,f:0.9},endomorph:{c:2,p:1.3,f:0.8}}
            $('carbsPerKg').value = map[type].c
            $('proteinPerKg').value = map[type].p
            $('fatPerKg').value = map[type].f
            calcKingsCycle()
        }

        // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰è¾“å…¥
        const planCards = [...document.querySelectorAll('.plan-card')]
        const customDiv = $('customPlan')
        planCards.forEach(c => c.addEventListener('click', () => {
            planCards.forEach(x => x.classList.remove('selected'))
            c.classList.add('selected')
            customDiv.style.display = c.dataset.plan === 'custom' ? 'flex' : 'none'
            calcKingsCycle()
        }))

        // è®­ç»ƒéƒ¨ä½ç”Ÿæˆ
        function buildParts(plan){
            switch(plan){
                case '1': return ['ä¼‘æ¯','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','ä¼‘æ¯']
                case '2': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´']
                case '3': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©']
                case '4': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','è…¿+è‚©']
                case 'custom':
                    return ['mon','tue','wed','thu','fri','sat','sun'].map(d=>$(`cus-${d}`).value.trim()||'ä¼‘æ¯')
            }
        }
        // ç”Ÿæˆ 28 å¤©çš„è®­ç»ƒéƒ¨ä½
function build28Parts(plan) {
  const oneWeek = buildParts(plan);
  const arr = [];
  for (let i = 0; i < 28; i++) arr.push(oneWeek[i % 7]);
  return arr;
}
// ç”Ÿæˆ 28 å¤©çš„ç¢³æ°´å¹³
function build28CarbMap(plan, parts28) {
  const oneWeek = buildCarbMap(plan, parts28.slice(0, 7));
  const arr = [];
  for (let i = 0; i < 28; i++) arr.push(oneWeek[i % 7]);
  return arr;
}

        // ç¢³æ°´å¹³æ˜ å°„ç”Ÿæˆï¼ˆæ ¹æ®è®­ç»ƒè®¡åˆ’ï¼‰
       // å‡¯åœ£ç‹ç¢³å¾ªç¯ä¸“ç”¨ï¼šå†™æ­»ç¢³æ—¥åˆ†å¸ƒ
function buildCarbMap(plan, parts) {
  // å››ç§å›ºå®šæ¨¡æ¿ï¼Œé¡ºåºå¯¹åº”å‘¨ä¸€â†’å‘¨æ—¥
  const fixedMap = {
    '1': ['ä½','é«˜','ä¸­','ä¸­','ä½','é«˜','ä¸­'],   // ç»ƒ1ä¼‘1
    '2': ['é«˜','ä¸­','ä½','é«˜','ä¸­','ä½','ä¸­'],   // ç»ƒ2ä¼‘1
    '3': ['ä¸­','ä¸­','é«˜','ä½','ä¸­','ä½','é«˜'],   // ç»ƒ3ä¼‘1
    '4': ['ä¸­','ä½','é«˜','ä¸­','ä½','ä¸­','é«˜']    // ç»ƒ4ä¼‘1
  };

  // å¦‚æœæ˜¯è‡ªå®šä¹‰è®¡åˆ’ï¼Œä»ç”¨å›åŸæ¥çš„éšæœºé€»è¾‘ï¼ˆæˆ–ä½ è‡ªå·±å†è¡¥ä¸€ä¸ªæ¨¡æ¿ï¼‰
  if (plan === 'custom') {
    return oldRandomCarbMap(plan, parts); // ä¿ç•™åŸé€»è¾‘ï¼Œå¯é€‰
  }

  // è¿”å›å†™æ­»çš„æ¨¡æ¿
  return fixedMap[plan] || fixedMap['1']; // é˜²å‘†é»˜è®¤å€¼
}

/* ---------- å¯é€‰ï¼šä¿ç•™åŸæ¥çš„éšæœºé€»è¾‘ï¼Œä¾›è‡ªå®šä¹‰è®¡åˆ’ä½¿ç”¨ ---------- */
function oldRandomCarbMap(plan, parts) {
  const isRestDay = parts.map(p => p === 'ä¼‘æ¯');
  const carbPatterns = [
    ['é«˜','ä¸­','ä½','é«˜','ä¸­','ä½','ä¸­'],
    ['é«˜','ä½','ä¸­','é«˜','ä½','ä¸­','ä¸­'],
    ['ä¸­','é«˜','ä½','ä¸­','é«˜','ä½','ä¸­'],
    ['ä¸­','ä½','é«˜','ä¸­','ä½','é«˜','ä¸­'],
    ['ä½','é«˜','ä¸­','ä½','é«˜','ä¸­','ä¸­'],
    ['ä½','ä¸­','é«˜','ä½','ä¸­','é«˜','ä¸­'],
    ['ä¸­','ä¸­','é«˜','ä½','ä¸­','é«˜','ä½']
  ];
  const valid = carbPatterns.filter(pat => {
    if (pat.filter(d => d === 'é«˜').length !== 2) return false;
    if (pat.filter(d => d === 'ä¸­').length !== 3) return false;
    if (pat.filter(d => d === 'ä½').length !== 2) return false;
    // é«˜ç¢³æ—¥ä¸èƒ½è½åœ¨ä¼‘æ¯æ—¥
    for (let i = 0; i < 7; i++) if (pat[i] === 'é«˜' && isRestDay[i]) return false;
    return true;
  });
  if (valid.length) return valid[0];
  // å…œåº•
  return ['ä¸­','é«˜','ä½','ä¸­','ä½','é«˜','ä¸­'];
}

        // å‡¯åœ£ç‹ç¢³å¾ªç¯ä¸»è®¡ç®—
        function calcKingsCycle(){
            const w=+$('weight').value,h=+$('height').value,a=+$('age').value,g=$('gender').value
            const targetW = +$('targetWeight').value
            if(!w||!h||!a||!targetW){alert('è¯·è¡¥å…¨ä¿¡æ¯');return}
            const cp=+$('carbsPerKg').value,pp=+$('proteinPerKg').value,fp=+$('fatPerKg').value
            const plan=document.querySelector('.plan-card.selected').dataset.plan

            const bmr=g==='male'?10*w+6.25*h-5*a+5:10*w+6.25*h-5*a-161
            const tdee=bmr+500
            const pro=Math.round(pp*targetW)
            const weekC=Math.round(cp*targetW*7)
            const weekF=Math.round(fp*targetW*7)
            const hc=Math.round(weekC*.5/2)
            const mc=Math.round(weekC*.35/3)
            const lc=Math.round(weekC*.15/2)
            const hf=Math.round(weekF*.15/2)
            const mf=Math.round(weekF*.35/3)
            const lf=Math.round(weekF*.50/2)

            $('bmrValue').textContent=Math.round(bmr)
            $('tdeeValue').textContent=Math.round(tdee)
            $('proteinValue').textContent=pro
            $('carbsValue').textContent=weekC

            const parts=buildParts(plan)
            const carbMap=buildCarbMap(plan, parts)
            const dayKeys=['mon','tue','wed','thu','fri','sat','sun']
            const carbNum=dayKeys.map((_,i)=>{
                switch(carbMap[i]){
                    case 'é«˜':return hc
                    case 'ä¸­':return mc
                    case 'ä½':return lc
                }
            })
            const fats=dayKeys.map((_,i)=>{
                switch(carbMap[i]){
                    case 'é«˜':return hf
                    case 'ä¸­':return mf
                    case 'ä½':return lf
                }
            })

         /* ---------- 28 å¤©ç‰ˆæœ¬ ---------- */
// æ”¹æˆ
/* ---------- 28 å¤©ç¡¬ç¼–ç ï¼ˆç»ƒ X ä¼‘ 1ï¼‰ ---------- */
const parts28 = (() => {
  const map = {
    /* ç»ƒ 1 ä¼‘ 1 */
    '1': [
      'èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´',
      'ä¼‘æ¯','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','ä¼‘æ¯',
      'èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´',
      'ä¼‘æ¯','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','ä¼‘æ¯'
    ],
    /* ç»ƒ 2 ä¼‘ 1 */
    '2': [
      'èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´',
  'è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','èƒ¸+ä¸‰å¤´',
  'ä¼‘æ¯','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','ä¼‘æ¯',
  'è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´'
    ],
    /* ç»ƒ 3 ä¼‘ 1 */
    '3': [
      'èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©',
      'ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´',
      'è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´',
      'èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯'
    ],
    /* ç»ƒ 4 ä¼‘ 1 */
    '4': [
 'èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','è…¿+è‚©',
      'èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©',
      'ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´',
      'è…¿+è‚©','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´'
    ]
  };
  return plan === 'custom'
    ? buildParts(plan).concat(...Array(3).fill(buildParts(plan))).flat()
    : map[plan] || map['1'];
})();
/* ---------- 28 å¤©ç¢³æ°´å¹³ç¡¬ç¼–ç  ---------- */
window.carb28 = (() => {
  const map = {
    /* ç»ƒ 1 ä¼‘ 1  â†’  é«˜ç¢³æ—¥è½åœ¨è®­ç»ƒæ—¥ï¼Œä½ç¢³æ—¥è½åœ¨ä¼‘æ¯æ—¥ */
    '1': [
 'é«˜','ä½','ä¸­','ä½','é«˜','ä¸­','ä¸­',
      'ä½','ä¸­','ä¸­','é«˜','ä¸­','é«˜','ä½',
      'ä¸­','ä½','é«˜','ä¸­','é«˜','ä½','ä¸­',
      'ä½','é«˜','ä¸­','é«˜','ä½','ä¸­','ä¸­'
    ],
    /* ç»ƒ 2 ä¼‘ 1  â†’  æ¯ 3 å¤©ï¼šé«˜ã€ä¸­ã€ä½ */
    '2': [
   'é«˜','ä¸­','ä½','é«˜','ä¸­','ä½','ä¸­',
      'é«˜','ä½','ä¸­','ä¸­','ä½','é«˜','ä¸­',
      'ä½','ä¸­','é«˜','ä½','é«˜','ä¸­','ä¸­',
      'é«˜','ä¸­','ä½','ä¸­','é«˜','ä½','ä¸­'
    ],
    /* ç»ƒ 3 ä¼‘ 1  â†’  æ¯ 4 å¤©ï¼šé«˜ã€ä¸­ã€é«˜ã€ä½ */
    '3': [
 'ä¸­','ä½','é«˜','ä½','ä¸­','ä¸­','é«˜',
      'ä½','é«˜','ä¸­','é«˜','ä½','ä¸­','ä¸­',
      'é«˜','ä½','ä¸­','ä¸­','é«˜','ä½','ä¸­',
      'ä¸­','é«˜','ä½','ä¸­','ä¸­','é«˜','ä½'
    ],
    /* ç»ƒ 4 ä¼‘ 1  â†’  æ¯ 5 å¤©ï¼šé«˜ã€ä¸­ã€é«˜ã€ä¸­ã€ä½ */
    '4': [
   'ä¸­','ä½','é«˜','ä¸­','ä½','ä¸­','é«˜',
      'ä¸­','ä¸­','ä½','é«˜','ä¸­','ä½','é«˜',
      'ä½','é«˜','ä¸­','é«˜','ä¸­','ä½','ä¸­',
      'é«˜','ä¸­','ä¸­','ä½','é«˜','ä¸­','ä½'
    ]
  };
  return map[plan] || map['1'];   // é˜²å‘†
})();
const dayRow       = $('dayRow');
const carbLevelRow = $('carbLevelRow');
dayRow.innerHTML = '<th rowspan="2">é¡¹ç›®</th>';
carbLevelRow.innerHTML = '';

for (let i = 0; i < 28; i++) {
  const dayTh = document.createElement('th');
  dayTh.textContent = ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'][i % 7];
  dayRow.appendChild(dayTh);

  const carbTh = document.createElement('th');
  carbTh.className = carb28[i]==='é«˜'?'high':(carb28[i]==='ä¸­'?'med':'low');
  carbTh.textContent = carb28[i];
  carbLevelRow.appendChild(carbTh);
}

/* è®­ç»ƒéƒ¨ä½è¡Œ */
const trParts = document.querySelector('#planTable tbody tr:nth-child(1)');
trParts.innerHTML = '<td>è®­ç»ƒéƒ¨ä½<br>(å¯åŒå‡»è‡ªå®šä¹‰)</td>';
parts28.forEach(p=> {
  const td = document.createElement('td');
  td.className = 'editable';
  td.textContent = p;
  trParts.appendChild(td);
});

/* è¥å…»ç´  & çƒ­é‡ 5 è¡Œ */
const labels = ['ç¢³æ°´(g)','è›‹ç™½è´¨(g)','è„‚è‚ª(g)','çƒ­é‡(kcal)','ç¼ºå£/ç›ˆä½™'];
[2,3,4,5,6].forEach((rowIdx, idx) => {
  const tr = document.querySelector(`#planTable tbody tr:nth-child(${rowIdx})`);
  tr.innerHTML = `<td>${labels[idx]}</td>`;
  for (let i = 0; i < 28; i++) {
    const td = document.createElement('td');
    const cVal = carb28[i]==='é«˜'?hc:(carb28[i]==='ä¸­'?mc:lc);
    const fVal = carb28[i]==='é«˜'?hf:(carb28[i]==='ä¸­'?mf:lf);
    switch(idx){
      case 0: td.textContent = cVal; break;
      case 1: td.textContent = pro; break;
      case 2: td.textContent = fVal; break;
      case 3: td.textContent = cVal*4 + pro*4 + fVal*9; break;
      case 4: {
        const cal = cVal*4 + pro*4 + fVal*9;
        const diff = Math.round(cal - tdee);
        td.innerHTML = `<span style="color:${diff>0?(diff>300?'#10b981':'#f59e0b'):'#f43f5e'}">${diff>0?'+':''}${diff}</span>`;
        break;
      }
    }
    tr.appendChild(td);
  }
});
/* ---------- 28 å¤©ç‰ˆæœ¬ç»“æŸ ---------- */
/* æ¸²æŸ“ç«–å‘å‘¨è¡¨ */
renderWeekTables();
          // âœ… è®¡ç®—æ¯æ—¥çƒ­é‡å·®ï¼ˆåŸºäº28å¤©è¡¨æ ¼ï¼‰
// âœ… è®¡ç®—æ¯æ—¥çƒ­é‡å·®ï¼ˆåŸºäº28å¤©è¡¨æ ¼ï¼‰
const diffs28 = [];
for (let i = 0; i < 28; i++) {
  const cVal = carb28[i] === 'é«˜' ? hc : (carb28[i] === 'ä¸­' ? mc : lc);
  const fVal = carb28[i] === 'é«˜' ? hf : (carb28[i] === 'ä¸­' ? mf : lf);
  const cal = cVal * 4 + pro * 4 + fVal * 9;
  diffs28.push(cal - tdee);
}

const weeklyCalorieDiff = Math.round(diffs28.reduce((sum, d) => sum + d, 0) / 4);
const weightDiff = targetW - w;

let daysNeeded = 0;
let targetDateText = '';

// âœ… æ–°å¢ï¼šç›®æ ‡å¢é‡ä½†çƒ­é‡èµ¤å­— â†’ æç¤ºæ— æ³•å®Œæˆ
if (weightDiff > 0 && weeklyCalorieDiff < 0) {
  targetDateText = 'ç›®æ ‡ä¸ºå¢é‡ï¼Œä½†å½“å‰è®¡åˆ’ä¸ºçƒ­é‡èµ¤å­—ï¼Œæ— æ³•å®Œæˆç›®æ ‡ï¼Œè¯·è°ƒæ•´è®¡åˆ’';
} else if (weightDiff < 0 && weeklyCalorieDiff > 0) {
  targetDateText = 'ç›®æ ‡ä¸ºå‡é‡ï¼Œä½†å½“å‰è®¡åˆ’ä¸ºçƒ­é‡ç›ˆä½™ï¼Œæ— æ³•å®Œæˆç›®æ ‡ï¼Œè¯·è°ƒæ•´è®¡åˆ’';
} else if (weeklyCalorieDiff === 0) {
  targetDateText = 'çƒ­é‡å¹³è¡¡ï¼Œè¯·è°ƒæ•´è®¡åˆ’';
} else {
  daysNeeded = Math.abs(Math.round((weightDiff * 7700) / (weeklyCalorieDiff / 7)));
  const targetDate = new Date();
  targetDate.setDate(targetDate.getDate() + daysNeeded);
  targetDateText = targetDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' });
}

// âœ… æ›´æ–°é¡µé¢
$('weightDiffValue').textContent = weightDiff > 0 ? `+${weightDiff}` : weightDiff;
$('weightDiffValue').style.color = weightDiff > 0 ? '#10b981' : (weightDiff < 0 ? '#f43f5e' : '#334155');

$('weeklyCalorieDiffValue').textContent = weeklyCalorieDiff > 0 ? `+${weeklyCalorieDiff}` : weeklyCalorieDiff;
$('weeklyCalorieDiffValue').style.color = weeklyCalorieDiff > 0 ? '#10b981' : (weeklyCalorieDiff < 0 ? '#f43f5e' : '#334155');

$('daysNeededValue').textContent = daysNeeded || 'â€”';
$('targetDate').textContent = targetDateText;
            
        }

        // å‡¯åœ£ç‹ç¢³å¾ªç¯å¯¼å‡º & é‡ç½®
       /* =========  å‡¯åœ£ç‹ç¢³å¾ªç¯ï¼ç«–å‘ 4 å‘¨è¡¨ï¼ˆä¿®å¤ç‰ˆï¼‰ ========= */
function dlKingsCycle() {
  /* 1. åŸºç¡€ä¿¡æ¯ï¼ˆä¿æŒä¸åŸä¸€è‡´ï¼‰ */
  const w   = +$('weight').value,
        tgt = +$('targetWeight').value,
        h   = +$('height').value,
        a   = +$('age').value,
        g   = $('gender').value === 'male' ? 'ç”·' : 'å¥³',
        bmr = +$('bmrValue').textContent,
        tdee= +$('tdeeValue').textContent,
        pro = +$('proteinValue').textContent,
        weekCarb = +$('carbsValue').textContent,
        weightDiff  = +$('weightDiffValue').textContent,
        weekDiffKcal= +$('weeklyCalorieDiffValue').textContent,
        daysNeed    = $('daysNeededValue').textContent,
        finishDate  = $('targetDate').textContent;

  const basicRows = [
    ['åŸºç¡€ä¿¡æ¯'], 
    ['å½“å‰ä½“é‡(kg)', w], 
    ['ç›®æ ‡ä½“é‡(kg)', tgt], 
    ['èº«é«˜(cm)', h], 
    ['å¹´é¾„(å²)', a], 
    ['æ€§åˆ«', g], 
    ['åŸºç¡€ä»£è°¢(kcal)', bmr], 
    ['æ¯æ—¥æ€»æ¶ˆè€—(kcal)', tdee], 
    ['æ¯æ—¥è›‹ç™½(g)', pro], 
    ['æ¯å‘¨ç¢³æ°´(g)', weekCarb], 
    [], 
    ['ç›®æ ‡åˆ†æ'], 
    ['ä½“é‡å·®(kg)', weightDiff], 
    ['å‘¨çƒ­é‡å·®(kcal)', weekDiffKcal], 
    ['é¢„è®¡å¤©æ•°', daysNeed], 
    ['é¢„è®¡å®Œæˆæ—¥æœŸ', finishDate]
  ];

  /* 2. æŠ“å– 28 åˆ—æ•°æ®ï¼ˆä¿®å¤ï¼šæå–çº¯æ•°å­—ï¼‰ */
  const parts  = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(1) td')).slice(1).map(td=>td.textContent);
  const carbs  = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(2) td')).slice(1).map(td=>+td.textContent);
  const pros   = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(3) td')).slice(1).map(td=>td.textContent);
  const fats   = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(4) td')).slice(1).map(td=>td.textContent);
  const cals   = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(5) td')).slice(1).map(td=>td.textContent);
  
  // ä¿®å¤ï¼šæå–çº¯æ•°å­—ï¼Œç§»é™¤HTMLæ ‡ç­¾
  const diffs  = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(6) td')).slice(1).map(td=>{
    const text = td.textContent || td.innerText;
    // æå–æ•°å­—éƒ¨åˆ†ï¼ˆåŒ…æ‹¬æ­£è´Ÿå·ï¼‰
    const match = text.match(/[-+]?\d+/);
    return match ? match[0] : '0';
  });

  /* 3. ç›´æ¥ç”Ÿæˆ 4 å¼ ç«–å‘å‘¨è¡¨ */
  const weekDays = ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'];
  const planRows = [];
  for (let w = 0; w < 4; w++) {
    planRows.push([], [`ç¬¬ ${w+1} å‘¨`]);
    planRows.push(['é¡¹ç›®', ...weekDays]);
    planRows.push(['ç¢³æ—¥', ...weekDays.map((_,i)=>window.carb28[w*7+i])]);
    const labels = ['è®­ç»ƒéƒ¨ä½','ç¢³æ°´(g)','è›‹ç™½è´¨(g)','è„‚è‚ª(g)','çƒ­é‡(kcal)','ç¼ºå£/ç›ˆä½™(kcal)'];
    labels.forEach((lab, idx)=>{
      const row = [lab];
      for (let d = 0; d < 7; d++) {
        const col = w*7+d;
        switch(idx){
          case 0: row.push(parts[col]); break;
          case 1: row.push(carbs[col]); break;
          case 2: row.push(pros[col]);  break;
          case 3: row.push(fats[col]);  break;
          case 4: row.push(cals[col]);  break;
          case 5: row.push(diffs[col]); break; // ç°åœ¨è¿™é‡Œæ˜¯çº¯æ•°å­—
        }
      }
      planRows.push(row);
    });
  }

  /* 4. åˆå¹¶ & å¯¼å‡º */
  const fullData = [...basicRows, ...planRows];
  const ws = XLSX.utils.aoa_to_sheet(fullData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'ç¢³å¾ªç¯ç«–å‘å‘¨è¡¨');
  XLSX.writeFile(wb, `ç¢³å¾ªç¯ç«–è¡¨_${w}kg.xlsx`);
}

        function resetKingsCycle(){
            $('weight').value=75;
            $('targetWeight').value=70;
            $('height').value=178;
            $('age').value=30;
            $('gender').value='male'
            bodyCards[0].click()
            planCards[0].click()
            ;['mon','tue','wed','thu','fri','sat','sun'].forEach(d=>$(`cus-${d}`).value='')
            calcKingsCycle()
        }

        function clipTargetWeight(){
            const w   = +$('weight').value;
            const tgt = $('targetWeight');
            let v = +tgt.value;
            v = Math.min(Math.max(v, w - 5), w + 5);
            if(v !== +tgt.value) tgt.value = v;
        }

        function adjustTarget(delta){
            const el = $('targetWeight');
            let v = +el.value + delta;
            const w = +$('weight').value;
            v = Math.min(Math.max(v, w - 5), w + 5);
            el.value = v;
            clipTargetWeight();
        }
/* ========= å¢è‚Œè®¡åˆ’åŠŸèƒ½ ========= */
const bulkPalCards  = [...document.querySelectorAll('#pal-cards .bulk-level-card')];
const bulkExpCards  = [...document.querySelectorAll('#exp-cards .bulk-level-card')];
const bulkSurCards  = [...document.querySelectorAll('#surplus-cards .bulk-level-card')];

function selectBulkCard(list, target){
    list.forEach(c=>c.classList.remove('selected'));
    target.classList.add('selected');
    calcBulk();
}
bulkPalCards.forEach(c=>c.addEventListener('click',()=>selectBulkCard(bulkPalCards,c)));
bulkExpCards.forEach(c=>c.addEventListener('click',()=>selectBulkCard(bulkExpCards,c)));
bulkSurCards.forEach(c=>c.addEventListener('click',()=>selectBulkCard(bulkSurCards,c)));
/* ========= å¢è‚Œè®¡åˆ’æ–°å¢ä»£ç  ========= */
const bulkPlanCards = [...document.querySelectorAll('#bulk-plan-cards .plan-card')];
const bulkCustomDiv = $('bulk-custom-plan');
bulkPlanCards.forEach(c => c.addEventListener('click', () => {
  bulkPlanCards.forEach(x => x.classList.remove('selected'));
  c.classList.add('selected');
  bulkCustomDiv.style.display = c.dataset.plan === 'custom' ? 'flex' : 'none';
  calcBulk();
}));

function buildBulkParts(plan){
  switch(plan){
    case '1': return ['ä¼‘æ¯','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','ä¼‘æ¯'];
    case '2': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´'];
    case '3': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©'];
    case '4': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','è…¿+è‚©'];
    case 'custom':
      return ['mon','tue','wed','thu','fri','sat','sun'].map(d=>$(`bulk-cus-${d}`).value.trim()||'ä¼‘æ¯');
  }
}

const dayCN = ['å‘¨ä¸€','å‘¨äºŒ','å‘¨ä¸‰','å‘¨å››','å‘¨äº”','å‘¨å…­','å‘¨æ—¥'];
function calcBulk(){
  const w = +$('bulk-weight').value,
        h = +$('bulk-height').value,
        a = +$('bulk-age').value,
        g = $('bulk-gender').value,
        pal  = +document.querySelector('#pal-cards .selected').dataset.pal,
        exp  = document.querySelector('#exp-cards .selected').dataset.exp,
        sur  = +document.querySelector('#surplus-cards .selected').dataset.surplus;

  const bmr = g==='male' ? 10*w+6.25*h-5*a+5 : 10*w+6.25*h-5*a-161;
  const tdee = Math.round(bmr * pal);
  const target = tdee + sur;

/* =========  ç»éªŒç³»æ•°è¡¨ ========= */
const proMap = {novice: 1.6, intermediate: 1.8, advanced: 2.0};
const fatMap = {novice: 0.9, intermediate: 1.0, advanced: 1.0};
const carbMap= {novice: 3.5, intermediate: 4.5, advanced: 5.0};

/* =========  å…ˆæŒ‰ä½“é‡ç»™å›ºå®šå…‹æ•° ========= */
const pro  = Math.round(w * proMap[exp]);
const fat  = Math.round(w * fatMap[exp]);
let carb = Math.round(w * carbMap[exp]);

/* =========  æŠŠç›ˆä½™çƒ­é‡å…¨éƒ¨è¿½åŠ ç»™ç¢³æ°´ ========= */
const proKcal = pro * 4, fatKcal = fat * 9, carbKcal = carb * 4;
const leftKcal = target - (proKcal + fatKcal + carbKcal);
if (leftKcal > 0) carb += Math.round(leftKcal / 4);

/* =========  è®­ç»ƒæ—¥ / ä¼‘æ¯æ—¥æµ®åŠ¨ ========= */
const trainCarb = Math.round(carb * 1);
const restCarb  = Math.round(carb * 0.85);

$('bulk-bmr').textContent   = bmr + ' kcal';
$('bulk-tdee').textContent  = tdee + ' kcal';
$('bulk-target').textContent= target + ' kcal';
$('bulk-protein').textContent= pro + ' g';
$('bulk-carb-display').textContent = trainCarb + ' g';
$('bulk-fat-display').textContent = fat + ' g';
$('bulk-rest-carb-display').textContent = restCarb + ' g';

  const plan = document.querySelector('#bulk-plan-cards .plan-card.selected').dataset.plan;
  const parts = buildBulkParts(plan);
  // 1. è®­ç»ƒéƒ¨ä½
const trParts = document.querySelectorAll('#bulk-week-table tbody tr')[0];
parts.forEach((part, i) => {
  trParts.children[i + 1].textContent = part;
});

// 2. è¥å…»ç´  & çƒ­é‡
const dayCarbs = [], dayCals = [];
for (let i = 0; i < 7; i++) {
  const isRest = parts[i] === 'ä¼‘æ¯';
  const c      = isRest ? restCarb : trainCarb;
  const cal    = c * 4 + pro * 4 + fat * 9;
  dayCarbs.push(c);
  dayCals.push(cal);
  $(`bulk-carb-${i}`).textContent = c;
  $(`bulk-pro-${i}`).textContent  = pro;
  $(`bulk-fat-${i}`).textContent  = fat;
  $(`bulk-cal-${i}`).textContent  = cal;
  const diff = cal - tdee;
  $(`bulk-diff-${i}`).innerHTML =
    `<span style="color:${diff>0?'#10b981':'#f43f5e'}">${diff>0?'+':''}${diff}</span>`
}
/* ===== é¢„è®¡æ¯å‘¨å¢é‡ =====
   7700 kcal â‰ˆ 1 kg ä½“é‡ï¼›ä¸€å‘¨æ€»ç›ˆä½™ Ã· 7700 */
/* ===== é¢„è®¡æ¯å‘¨å¢é‡ =====
   7700 kcal â‰ˆ 1 kg ä½“é‡ï¼›ä¸€å‘¨æ€»ç›ˆä½™ Ã· 7700 */
// è®¡ç®—ä¸€å‘¨æ€»æ‘„å…¥
const weeklyIntake = dayCals.reduce((sum, cal) => sum + cal, 0);
// è®¡ç®—ä¸€å‘¨æ€»æ¶ˆè€—
const weeklyExpenditure = tdee * 7;
// è®¡ç®—ä¸€å‘¨æ€»ç›ˆä½™
const weeklySurplus = weeklyIntake - weeklyExpenditure;
const weeklyGain = (weeklySurplus / 7700).toFixed(2);
$('bulk-weekly-gain').textContent = weeklyGain;
/* ---------- è®¡ç®—é€»è¾‘è¯¦æƒ… ---------- */
const logicHtml = `
  <div class="bulk-logic" style="margin-top:12px;font-size:.75rem;color:#475569;line-height:1.6;">
    <b>è®¡ç®—é€»è¾‘ï¼š</b><br>
    1) BMR = ${g==='male'?10*w+6.25*h-5*a+5:10*w+6.25*h-5*a-161} kcalï¼ˆMifflin-St Jeorï¼‰<br>
    2) TDEE = BMR Ã— ${pal} = ${tdee} kcalï¼ˆè¿åŠ¨ç³»æ•°ï¼‰<br>
    3) ç›®æ ‡çƒ­é‡ = TDEE + ${sur} = ${target} kcal<br>
    4) è›‹ç™½è´¨ = ä½“é‡ Ã— ${exp==='novice'?1.6:exp==='intermediate'?1.8:2.0} = ${pro} g<br>
    5) è„‚è‚ª = ä½“é‡ Ã—${fatMap[exp]} = ${fat} g<br>
    6) è®­ç»ƒæ—¥ç¢³æ°´ =ä½“é‡Ã—${carbMap[exp]} g/kg + ç›ˆä½™çƒ­é‡(è‹¥æœ‰)Ã·4 = ${trainCarb} g<br>
    7) ä¼‘æ¯æ—¥ç¢³æ°´ =ï¼ˆå‰©ä½™çƒ­é‡ Ã· 4ï¼‰*0.85  =  ${restCarb} g
  </div>
`;
/* å¦‚æœå·²å­˜åœ¨å…ˆæ¸…ç©ºå†å†™å…¥ï¼Œé¿å…é‡å¤ */
let oldBox = document.getElementById('bulk-logic-box');
if(oldBox) oldBox.remove();
document.querySelector('.bulk-stats').insertAdjacentHTML('afterend',
  `<div id="bulk-logic-box">${logicHtml}</div>`);
  
}

function editBulkCell(cell){
  const old = cell.textContent;
  cell.innerHTML = `<input style="width:100%;font-size:.75rem" value="${old}">`;
  const inp = cell.querySelector('input');
  inp.focus();
  inp.onblur = inp.onkeydown = e => {
    if(e.type==='blur'||e.key==='Enter') cell.textContent = inp.value||old;
  };
}

/* ========= æ›¿æ¢æ‰åŸæ¥çš„ dlBulk() ========= */
function dlBulk() {
  // 1. é‡æ–°æŠ“å–å¹¶è®¡ç®—ä¸€æ¬¡ï¼Œç¡®ä¿æ‰€æœ‰å˜é‡å­˜åœ¨
  calcBulk();   // å…ˆç®—ä¸€é

  const w   = +$('bulk-weight').value;
  const h   = +$('bulk-height').value;
  const a   = +$('bulk-age').value;
  const g   = $('bulk-gender').value;
  const pal = +document.querySelector('#pal-cards .selected').dataset.pal;
  const exp = document.querySelector('#exp-cards .selected').dataset.exp;
  const sur = +document.querySelector('#surplus-cards .selected').dataset.surplus;

  // 2. ä»é¡µé¢ä¸ŠæŠŠå·²ç»ç®—å¥½çš„æ•°å€¼æ‹¿ä¸‹æ¥
  const bmr   = +$('bulk-bmr').textContent.replace(' kcal','');
  const tdee  = +$('bulk-tdee').textContent.replace(' kcal','');
  const target= +$('bulk-target').textContent.replace(' kcal','');
  const pro   = +$('bulk-protein').textContent.replace(' g','');
  const fat   = +$('bulk-fat-display').textContent.replace(' g','');
  const trainCarb = +$('bulk-carb-display').textContent.replace(' g','');
  const restCarb  = +$('bulk-rest-carb-display').textContent.replace(' g','');
 const weeklyGain = $('bulk-weekly-gain').textContent; // æ–°å¢ï¼šè·å–é¢„è®¡æ¯å‘¨å¢é‡
  // 3. ç»éªŒç³»æ•°è¡¨ï¼ˆä¸ calcBulk ä¿æŒä¸€è‡´ï¼‰
  const proMap = {novice: 1.6, intermediate: 1.8, advanced: 2.0};
  const fatMap = {novice: 0.9, intermediate: 1.0, advanced: 1.0};
  const carbMap= {novice: 3.5, intermediate: 4.5, advanced: 5.0};

  /* ---------- åŸºç¡€ä¿¡æ¯ + è®¡ç®—è¿‡ç¨‹ ---------- */
  const basic = [
    ['å¢è‚Œè®¡åˆ’å¯¼å‡º'],
    ['ä½“é‡(kg)', w],
    ['èº«é«˜(cm)', h],
    ['å¹´é¾„(å²)', a],
    ['æ€§åˆ«', g==='male'?'ç”·':'å¥³'],
    ['è¿åŠ¨ç³»æ•°', pal],
    ['æ¯æ—¥ç›ˆä½™(kcal)', sur],
    [],['è®¡ç®—è¿‡ç¨‹'],
    ['åŸºç¡€ä»£è°¢(BMR)', `${bmr} kcal`],
    ['æ¯æ—¥æ€»æ¶ˆè€—(TDEE)', `${tdee} kcal`],
    ['ç›®æ ‡çƒ­é‡', `${target} kcal`],
    ['é¢„è®¡æ¯å‘¨å¢é‡', `${weeklyGain} kg`], // æ–°å¢ï¼šæ¯å‘¨å¢é‡æ•°æ®
    [`è›‹ç™½è´¨ (${proMap[exp]} g/kg)`, `${pro} g`],
    [`è„‚è‚ª (${fatMap[exp]} g/kg)`, `${fat} g`],
    [`è®­ç»ƒæ—¥ç¢³æ°´ (ä½“é‡Ã—${carbMap[exp]} + ç›ˆä½™Ã·4)`, `${trainCarb} g`],
    [`ä¼‘æ¯æ—¥ç¢³æ°´ (è®­ç»ƒæ—¥Ã—0.85)`, `${restCarb} g`],
    [],['ä¸€å‘¨æ˜ç»†']
  ];

  /* ---------- ä¸€å‘¨è®¡åˆ’è¡¨ ---------- */
  const plan = [
    ['é¡¹ç›®','å‘¨ä¸€','å‘¨äºŒ','å‘¨ä¸‰','å‘¨å››','å‘¨äº”','å‘¨å…­','å‘¨æ—¥']
  ];
  const tbody = document.querySelectorAll('#bulk-week-table tbody tr');
  tbody.forEach(tr=>{
    plan.push(Array.from(tr.children).map(td=>td.textContent));
  });

  const data = [...basic, ...plan];
  const ws = XLSX.utils.aoa_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'å¢è‚Œè®¡åˆ’');
  XLSX.writeFile(wb, `å¢è‚Œ_${w}kg.xlsx`);
}

function resetBulk(){
  $('bulk-weight').value = 70;
  $('bulk-height').value = 175;
  $('bulk-age').value = 25;
  $('bulk-gender').value = 'male';
  document.querySelector('#pal-cards .bulk-level-card').click();
  document.querySelector('#exp-cards .bulk-level-card').click();
  document.querySelector('#surplus-cards .bulk-level-card').click();
  bulkPlanCards[0].click();
  ['mon','tue','wed','thu','fri','sat','sun'].forEach(d=>$(`bulk-cus-${d}`).value='');
  calcBulk();
}

$('bulk-calc').addEventListener('click', calcBulk);
$('bulk-reset').addEventListener('click', resetBulk);
$('bulk-dl').addEventListener('click', dlBulk);
        /* ---------- æ©™å­ç¢³æ°´æ¸é™åŠŸèƒ½ ---------- */
        // è¥å…»ç´ æ¯”ä¾‹é€‰æ‹©
        const ratioCards = [...document.querySelectorAll('.orange-ratio-card')]
        ratioCards.forEach(c => c.addEventListener('click', () => {
            ratioCards.forEach(x => x.classList.remove('selected'))
            c.classList.add('selected')
            
            // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰æ¯”ä¾‹è¾“å…¥
            const customInputs = $('custom-ratio-inputs')
            customInputs.style.display = c.dataset.ratio === 'custom' ? 'block' : 'none'
            
            calcOrangeCarb()
        }))

        // è‡ªå®šä¹‰æ¯”ä¾‹è¾“å…¥éªŒè¯
        function validateCustomRatio() {
            const carb = +$('custom-carb').value || 0
            const protein = +$('custom-protein').value || 0
            const fat = +$('custom-fat').value || 0
            const total = carb + protein + fat
            
            const ratioSum = $('ratio-sum')
            ratioSum.textContent = `æ€»å’Œ: ${total}%`
            
            if (total !== 100) {
                ratioSum.classList.add('error')
                return false
            } else {
                ratioSum.classList.remove('error')
                return true
            }
        }

        // ç›‘å¬è‡ªå®šä¹‰æ¯”ä¾‹è¾“å…¥å˜åŒ–
        document.querySelectorAll('#custom-carb, #custom-protein, #custom-fat').forEach(input => {
            input.addEventListener('input', () => {
                validateCustomRatio()
                calcOrangeCarb()
            })
        })

        // å‡é‡ç™¾åˆ†æ¯”æ»‘å—
        const weightLossSlider = $('weight-loss-percent')
        const weightLossValue = $('weight-loss-value')
        
        weightLossSlider.addEventListener('input', () => {
            weightLossValue.textContent = `${weightLossSlider.value}%`
            calcOrangeCarb()
        })

        // æ©™å­ç¢³æ°´æ¸é™ä¸»è®¡ç®—
        function calcOrangeCarb(){
            const w = +$('orange-weight').value
            const h = +$('orange-height').value
            const a = +$('orange-age').value
            const g = $('orange-gender').value
            const trainTime = +$('train-time').value
            const intensity = +$('train-intensity').value
            const weightLossPercent = +weightLossSlider.value / 100 // è½¬æ¢ä¸ºå°æ•°
            const weeklyLossPercent = weightLossPercent / 4.33; 
            // è·å–é€‰ä¸­çš„æ¯”ä¾‹
            const selectedRatio = document.querySelector('.orange-ratio-card.selected').dataset.ratio
            let carbRatio, proteinRatio, fatRatio
            
            if(selectedRatio === 'custom') {
                if (!validateCustomRatio()) return
                carbRatio = (+$('custom-carb').value || 0) / 100
                proteinRatio = (+$('custom-protein').value || 0) / 100
                fatRatio = (+$('custom-fat').value || 0) / 100
            } else if(selectedRatio === '532') {
                carbRatio = 0.5
                proteinRatio = 0.3
                fatRatio = 0.2
            } else {
                carbRatio = 0.4
                proteinRatio = 0.4
                fatRatio = 0.2
            }
            
            if(!w || !h || !a || !trainTime){alert('è¯·è¡¥å…¨ä¿¡æ¯');return}
            
            // è®¡ç®—BMR
            const bmr = g === 'male' ? 10*w + 6.25*h - 5*a + 5 : 10*w + 6.25*h - 5*a - 161
            
            // è®¡ç®—è®­ç»ƒæ¶ˆè€—çƒ­é‡
            const trainCalories = trainTime * intensity
            
            // è®¡ç®—TDEE
            const tdee = Math.round(bmr + trainCalories)
            
            // è®¡ç®—åˆå§‹ç¢³æ°´
            const initialCarbs = Math.round(tdee * carbRatio / 4)
            
            // è®¡ç®—è›‹ç™½è´¨å’Œè„‚è‚ª
            const protein = Math.round(tdee * proteinRatio / 4)
            const fat = Math.round(tdee * fatRatio / 9)
            
            // è®¡ç®—å‘¨å‡é‡ç›®æ ‡ (æ ¹æ®ç”¨æˆ·è®¾ç½®çš„ç™¾åˆ†æ¯”)
            const weeklyLoss = Math.round(w * weeklyLossPercent * 100) / 100
            
            // è®¡ç®—é¢„è®¡å‘¨æ•°å’Œå®Œæˆæ—¥æœŸ
            const targetWeightLoss = w * 0.15 // å‡è®¾ç›®æ ‡å‡é‡15%
            const estimatedWeeks = Math.round(targetWeightLoss / weeklyLoss)
            const today = new Date()
            const targetDate = new Date(today)
            targetDate.setDate(today.getDate() + estimatedWeeks * 7)
            const formattedDate = targetDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })
            
            // æ›´æ–°æ˜¾ç¤º
            $('orange-bmrValue').textContent = Math.round(bmr)
            $('orange-trainCalories').textContent = trainCalories
            $('orange-tdeeValue').textContent = tdee
            $('orange-initialCarbs').textContent = initialCarbs
            $('orange-protein').textContent = protein
            $('orange-fat').textContent = fat
            $('orange-weeklyLoss').textContent = weeklyLoss
            
            
            // ç”Ÿæˆç¢³æ°´æ¸é™è®¡åˆ’è¡¨
            generateOrangePlan(initialCarbs, protein, fat, weeklyLoss, estimatedWeeks, w)
        }

        // ç”Ÿæˆç¢³æ°´æ¸é™è®¡åˆ’è¡¨
        // ç”Ÿæˆç¢³æ°´æ¸é™è®¡åˆ’è¡¨ï¼ˆæ— å‘¨æ•°ã€æ— æ—¥æœŸç‰ˆï¼‰
function generateOrangePlan(initialCarbs, protein, fat, weeklyLoss, estimatedWeeks, initialWeight) {
  const planBody = $('orange-planBody');
  planBody.innerHTML = '';

  let currentCarbs = initialCarbs;
  const adjustment = 15;               // æ¯æ¬¡ä¸‹è°ƒ 15 g
  let seq = 1;                         // è¡Œå·ä» 1 å¼€å§‹

  for (let week = 1; week <= estimatedWeeks + 2; week++) {
    const expectedWeight = Math.max(initialWeight - (week - 1) * weeklyLoss, initialWeight * 0.85);

    if (currentCarbs < 100) {          // ä½äº 100 g åœæ­¢
      planBody.insertAdjacentHTML('beforeend', `
        <tr>
          <td>${seq++}</td>
          <td>${currentCarbs}</td>
          <td>${protein}</td>
          <td>${fat}</td>
          <td>${expectedWeight.toFixed(1)}</td>
          <td>${weeklyLoss}</td>
          <td>ç¢³æ°´å·²ä½äº 100 gï¼Œå»ºè®®åœæ­¢å‡å°‘</td>
        </tr>`);
      break;
    }

    planBody.insertAdjacentHTML('beforeend', `
      <tr>
        <td>${seq++}</td>
        <td>${currentCarbs}</td>
        <td>${protein}</td>
        <td>${fat}</td>
        <td>${expectedWeight.toFixed(1)}</td>
        <td>${weeklyLoss}</td>
        <td>${week === 1 ? 'åˆå§‹ç¢³æ°´æ‘„å…¥' : 'å¦‚æœªè¾¾ç›®æ ‡,å‡å°‘15gç¢³æ°´'}</td>
      </tr>`);

    currentCarbs -= adjustment;
  }
}

        // æ©™å­ç¢³æ°´æ¸é™å¯¼å‡ºåŠŸèƒ½
        // æ©™å­ç¢³æ°´æ¸é™å¯¼å‡ºåŠŸèƒ½ï¼ˆä¿®å¤ç‰ˆï¼‰
function dlOrangeCarb() {
    const w = +$('orange-weight').value,
          h = +$('orange-height').value,
          a = +$('orange-age').value,
          g = $('orange-gender').value === 'male' ? 'ç”·' : 'å¥³',
          trainTime = +$('train-time').value,
          intensity = +$('train-intensity').value,
          weightLossPercent = +$('weight-loss-percent').value;

    const ratioCard = document.querySelector('.orange-ratio-card.selected'),
          ratioText = ratioCard.dataset.ratio === 'custom'
              ? `è‡ªå®šä¹‰: ${$('custom-carb').value}%ç¢³æ°´, ${$('custom-protein').value}%è›‹ç™½, ${$('custom-fat').value}%è„‚è‚ª`
              : ratioCard.dataset.ratio === '532'
                  ? '50%ç¢³æ°´ 30%è›‹ç™½ 20%è„‚è‚ª'
                  : '40%ç¢³æ°´ 40%è›‹ç™½ 20%è„‚è‚ª';

    const bmr = +$('orange-bmrValue').textContent,
          trainCal = +$('orange-trainCalories').textContent,
          tdee = +$('orange-tdeeValue').textContent,
          initCarb = +$('orange-initialCarbs').textContent,
          protein = +$('orange-protein').textContent,
          fat = +$('orange-fat').textContent,
          weeklyLoss = +$('orange-weeklyLoss').textContent;

    /* ---------- åŸºç¡€ä¿¡æ¯éƒ¨åˆ† ---------- */
    const basic = [
        ['åŸºç¡€ä¿¡æ¯','','','','','','',''],
        ['å½“å‰ä½“é‡(kg)', w],
        ['èº«é«˜(cm)', h],
        ['å¹´é¾„(å²)', a],
        ['æ€§åˆ«', g],
        ['è®­ç»ƒæ—¶é•¿(åˆ†é’Ÿ)', trainTime],
        ['è®­ç»ƒå¼ºåº¦ç³»æ•°', intensity],
        ['æ¯æœˆå‡é‡ç™¾åˆ†æ¯”', `${weightLossPercent}%`],
        ['è¥å…»ç´ æ¯”ä¾‹', ratioText],
        [], [],
        ['è®¡ç®—ç»“æœ'],
        ['åŸºç¡€ä»£è°¢(BMR)', bmr],
        ['è®­ç»ƒæ¶ˆè€—çƒ­é‡', trainCal],
        ['æ¯æ—¥æ€»æ¶ˆè€—(TDEE)', tdee],
        ['åˆå§‹ç¢³æ°´(g)', initCarb],
        ['è›‹ç™½è´¨(g)', protein],
        ['è„‚è‚ª(g)', fat],
        ['å‘¨å‡é‡ç›®æ ‡(kg)', weeklyLoss],
        [], []
    ];

    /* ---------- è®¡åˆ’è¡¨éƒ¨åˆ† ---------- */
    const plan = [
        ['ç¢³æ°´æ¸é™è®¡åˆ’'],
        ['å‘¨æ•°','æ¯æ—¥ç¢³æ°´(g)','æ¯æ—¥è›‹ç™½è´¨(g)','æ¯æ—¥è„‚è‚ª(g)','é¢„æœŸä½“é‡(kg)','å‘¨å‡é‡ç›®æ ‡(kg)','è°ƒæ•´è¯´æ˜']
    ];
    Array.from($('orange-planBody').querySelectorAll('tr')).forEach(tr => {
        plan.push(Array.from(tr.querySelectorAll('td')).map(td => td.textContent));
    });

    const data = [...basic, ...plan];
    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'ç¢³æ°´æ¸é™è®¡åˆ’');
    XLSX.writeFile(wb, `ç¢³æ°´æ¸é™_${w}kg.xlsx`);
}

        // æ©™å­ç¢³æ°´æ¸é™é‡ç½®åŠŸèƒ½
        function resetOrangeCarb(){
            $('orange-weight').value = 80
            $('orange-height').value = 175
            $('orange-age').value = 32
            $('orange-gender').value = 'male'
            $('train-time').value = 60
            $('train-intensity').value = 8
            weightLossSlider.value = 3.5
            weightLossValue.textContent = '3.5%'
            ratioCards[0].click()
            $('custom-carb').value = 50
            $('custom-protein').value = 30
            $('custom-fat').value = 20
            validateCustomRatio()
            calcOrangeCarb()
        }

        /* ---------- äº‹ä»¶ç»‘å®š ---------- */
        // å‡¯åœ£ç‹ç¢³å¾ªç¯äº‹ä»¶
        $('calculateBtn').addEventListener('click', calcKingsCycle)
        $('downloadBtn').addEventListener('click', dlKingsCycle)
        $('resetBtn').addEventListener('click', resetKingsCycle)

        // æ©™å­ç¢³æ°´æ¸é™äº‹ä»¶
        $('orange-calculateBtn').addEventListener('click', calcOrangeCarb)
        $('orange-downloadBtn').addEventListener('click', dlOrangeCarb)
        $('orange-resetBtn').addEventListener('click', resetOrangeCarb)

        // è®­ç»ƒéƒ¨ä½å•å…ƒæ ¼åŒå‡»ç¼–è¾‘
        document.querySelectorAll('.editable').forEach(cell=>{
            cell.addEventListener('dblclick',()=>{
                const v=cell.textContent
                cell.innerHTML=`<input value="${v}" style="width:100%;font-size:.7rem">`
                const inp=cell.querySelector('input')
                inp.focus()
                inp.onblur=inp.onkeydown=e=>{
                    if(e.type==='blur'||e.key==='Enter'){cell.textContent=inp.value||v}
                }
            })
        })
	function toggleBodyFatImage() {
    const container = document.getElementById('bodyfat-container');
    if (container.style.display === 'none') {
        container.style.display = 'block';
    } else {
        container.style.display = 'none';
    }
}
/* èƒšå‹å‚è€ƒå›¾æ˜¾éš */
function toggleBodyTypeRef() {
  const box = document.getElementById('bodytype-ref');
  const link = event.currentTarget;
  if (box.style.display === 'none') {
    box.style.display = 'block';
    link.textContent = 'ğŸ“Œ éšè—èƒšå‹å‚è€ƒå›¾';
  } else {
    box.style.display = 'none';
    link.textContent = 'ğŸ“Œ ç‚¹å‡»æŸ¥çœ‹èƒšå‹å‚è€ƒå›¾';
  }
}
// é¡µé¢åŠ è½½æ—¶æå‰åˆ›å»ºå¢è‚Œè®¡åˆ’ tab
document.addEventListener('DOMContentLoaded', () => {
    const tabsContainer = document.querySelector('.tabs');
    if (!document.querySelector('.tab-btn[data-tab="bulk-plan"]')) {
        const bulkTab = document.createElement('button');
        bulkTab.className = 'tab-btn';
        bulkTab.dataset.tab = 'bulk-plan';
        bulkTab.textContent = 'å¢è‚Œè®¡åˆ’';
        tabsContainer.appendChild(bulkTab);

        bulkTab.addEventListener('click', () => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            bulkTab.classList.add('active');
            document.getElementById('bulk-plan').classList.add('active');
            calcBulk();
        });
    }
});
// é¤æ¬¡å®‰æ’å•å…ƒæ ¼åŒå‡»ç¼–è¾‘
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('editable') && e.target.closest('#fast-week-table')) {
        const cell = e.target;
        const oldValue = cell.textContent;
        cell.innerHTML = `<input value="${oldValue}" style="width:100%;font-size:.7rem">`;
        const input = cell.querySelector('input');
        input.focus();
        
        input.onblur = input.onkeydown = function(e) {
            if (e.type === 'blur' || e.key === 'Enter') {
                cell.textContent = input.value || oldValue;
            }
        };
    }
});
        /* ---------- åˆå§‹åŒ– ---------- */
        setMacros('ectomorph')
        calcKingsCycle();
        clipTargetWeight();
        
        // åˆå§‹åŒ–æ©™å­ç¢³æ°´æ¸é™
        weightLossValue.textContent = `${weightLossSlider.value}%`
        validateCustomRatio()
        calcOrangeCarb();
        /* ========= ç«–å‘å‘¨è¡¨æ¸²æŸ“ ========= */
/* ========= ç«–å‘å‘¨è¡¨ï¼ˆ4 å¼ ç‹¬ç«‹è¡¨ï¼Œæ²¿ç”¨æ¨ªè¡¨å½©è‰²è¡¨å¤´æ¨¡å¼ï¼‰ ========= */
function renderWeekTables(){
    const weekTables=$('weekTables');
    weekTables.innerHTML='';

    /* 1. æŠ“ 28 åˆ—æ•°æ® */
    const parts  = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(1) td')).slice(1).map(td=>td.textContent);
    const carbs  = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(2) td')).slice(1).map(td=>+td.textContent);
    const pros   = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(3) td')).slice(1).map(td=>td.textContent);
    const fats   = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(4) td')).slice(1).map(td=>td.textContent);
    const cals   = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(5) td')).slice(1).map(td=>td.textContent);
    const diffs  = Array.from(document.querySelectorAll('#planTable tbody tr:nth-child(6) td')).slice(1).map(td=>td.innerHTML);

    /* 2. ç¢³æ—¥åˆ¤å®šï¼ˆå¤ç”¨æ¨ªè¡¨é˜ˆå€¼ï¼‰ */
    
    const [hc, mc, lc] = (()=>{
        const w=+$('weight').value, cPerKg=+$('carbsPerKg').value;
        const weekC=Math.round(cPerKg*w*7);
        return [
            Math.round(weekC*0.50/2),
            Math.round(weekC*0.35/3),
            Math.round(weekC*0.15/2)
        ];
    })();
   const carbLevel = g => g === 'é«˜' ? 'high' : (g === 'ä¸­' ? 'med' : 'low');

    /* 3. ä¸€å‘¨ä¸­æ–‡å */
    const weekDays=['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'];

    /* 4. ç”Ÿæˆ 4 å¼ ç«–å‘è¡¨ */
    for (let w = 0; w < 4; w++) {
  const carbHeadRow = weekDays.map((_, i) => {
    const lvl = window.carb28[w * 7 + i];   // â† å…³é”®ï¼šåŒä¸€å¥— carb28
    const cls = carbLevel(lvl);
    return `<th class="${cls}">${lvl}</th>`;
  }).join('');

        const html=`
          <div class="week-table">
     
            <table>
              <thead>
                <tr><th>ç¬¬ ${w+1} å‘¨</th>${weekDays.map(d=>`<th>${d}</th>`).join('')}</tr>
                <tr><th>ç¢³æ—¥</th>${carbHeadRow}</tr>
              </thead>
              <tbody>
                <tr><td>è®­ç»ƒéƒ¨ä½</td>${weekDays.map((_,i)=>`<td class="editable">${parts[w*7+i]}</td>`).join('')}</tr>
                <tr><td>ç¢³æ°´(g)</td>${weekDays.map((_,i)=>`<td>${carbs[w*7+i]}</td>`).join('')}</tr>
                <tr><td>è›‹ç™½è´¨(g)</td>${weekDays.map((_,i)=>`<td>${pros[w*7+i]}</td>`).join('')}</tr>
                <tr><td>è„‚è‚ª(g)</td>${weekDays.map((_,i)=>`<td>${fats[w*7+i]}</td>`).join('')}</tr>
                <tr><td>çƒ­é‡(kcal)</td>${weekDays.map((_,i)=>`<td>${cals[w*7+i]}</td>`).join('')}</tr>
                <tr><td>ç¼ºå£/ç›ˆä½™</td>${weekDays.map((_,i)=>`<td>${diffs[w*7+i]}</td>`).join('')}</tr>
              </tbody>
            </table>
          </div>`;
        weekTables.insertAdjacentHTML('beforeend',html);
    }

    /* 5. ä¿ç•™åŒå‡»ç¼–è¾‘ */
    weekTables.querySelectorAll('.editable').forEach(cell=>{
        cell.addEventListener('dblclick',()=>{
            const v=cell.textContent;
            cell.innerHTML=`<input value="${v}" style="width:100%;font-size:.7rem">`;
            const inp=cell.querySelector('input');
            inp.focus();
            inp.onblur=inp.onkeydown=e=>{if(e.type==='blur'||e.key==='Enter')cell.textContent=inp.value||v;};
        });
    });
    
}
/* ---------- 16+8è½»æ–­é£ŸåŠŸèƒ½ ---------- */
// è¿›é£Ÿçª—å£é€‰æ‹©
const windowCards = [...document.querySelectorAll('[data-window]')];
const customWindow = $('#fast-custom-window');
windowCards.forEach(c => c.addEventListener('click', () => {
    windowCards.forEach(x => x.classList.remove('selected'));
    c.classList.add('selected');
    customWindow.style.display = c.dataset.window === 'custom' ? 'flex' : 'none';
    calculateFast();
}));

// æ´»åŠ¨æ°´å¹³é€‰æ‹©
const activityCards = [...document.querySelectorAll('[data-activity]')];
activityCards.forEach(c => c.addEventListener('click', () => {
    activityCards.forEach(x => x.classList.remove('selected'));
    c.classList.add('selected');
    calculateFast();
}));

// 16+8è®¡ç®—å‡½æ•°
// 16+8è®¡ç®—å‡½æ•°
// 16+8è®¡ç®—å‡½æ•°
// 16+8è®¡ç®—å‡½æ•°
function calculateFast() {
    const w = +$('fast-weight').value,
          h = +$('fast-height').value,
          a = +$('fast-age').value,
          g = $('fast-gender').value,
          activity = +document.querySelector('[data-activity].selected').dataset.activity;
    
    // è®¡ç®—BMRå’ŒTDEE
    const bmr = g === 'male' ? 10*w + 6.25*h - 5*a + 5 : 10*w + 6.25*h - 5*a - 161;
    const tdee = Math.round(bmr * activity);
    const targetCalories = Math.round(tdee * 0.80); // 20%çƒ­é‡ç¼ºå£
    const protein = Math.round(w * 1.6); // 1.6g/kgè›‹ç™½è´¨
    const fat = Math.round(w * 0.7); // 0.7g/kgè„‚è‚ª
    
    // è®¡ç®—ç¢³æ°´ (å‰©ä½™çƒ­é‡ç»™ç¢³æ°´)
    const proteinCalories = protein * 4;
    const fatCalories = fat * 9;
    const carbCalories = targetCalories - proteinCalories - fatCalories;
    const carbs = Math.round(carbCalories / 4);
    
    // æ›´æ–°åŸºç¡€æ˜¾ç¤º
    $('fast-bmr').textContent = Math.round(bmr);
    $('fast-tdee').textContent = tdee;
    $('fast-calories').textContent = targetCalories;
    $('fast-protein').textContent = protein;
    
    // æ›´æ–°ä¸€å‘¨è¡¨æ ¼
    updateFastWeekTable(carbs, protein, fat, targetCalories);

    /* ---------- è®¡ç®—é€»è¾‘è¯¦æƒ… ---------- */
    const logicHtml = `
        <b style="color:#0ea5e9;">è¯¦ç»†è®¡ç®—æ­¥éª¤ï¼š</b><br>
        1) BMRï¼ˆåŸºç¡€ä»£è°¢ï¼‰= ${g === 'male' ? '10Ã—ä½“é‡ + 6.25Ã—èº«é«˜ - 5Ã—å¹´é¾„ + 5' : '10Ã—ä½“é‡ + 6.25Ã—èº«é«˜ - 5Ã—å¹´é¾„ - 161'} = <b>${Math.round(bmr)} kcal</b><br>
        2) TDEEï¼ˆæ¯æ—¥æ¶ˆè€—ï¼‰= BMR Ã— æ´»åŠ¨ç³»æ•°ï¼ˆ${activity}ï¼‰= <b>${tdee} kcal</b><br>
        3) ç›®æ ‡çƒ­é‡ = TDEE Ã— 0.80ï¼ˆåˆ¶é€ 20%ç¼ºå£ï¼‰= <b>${targetCalories} kcal</b><br>
        4) å®é‡åˆ†é…ï¼š<br>
           &nbsp;&nbsp;â€¢ è›‹ç™½è´¨ = ä½“é‡ Ã— 1.6g/kg = ${w} Ã— 1.6 = <b>${protein} g</b>ï¼ˆ${protein * 4} kcalï¼‰<br>
           &nbsp;&nbsp;â€¢ è„‚è‚ª = ä½“é‡ Ã— 0.8g/kg = ${w} Ã— 0.7 = <b>${fat} g</b>ï¼ˆ${fat * 9} kcalï¼‰<br>
           &nbsp;&nbsp;â€¢ å‰©ä½™çƒ­é‡ç»™ç¢³æ°´ = æ€»çƒ­é‡ - è›‹ç™½çƒ­é‡ - è„‚è‚ªçƒ­é‡ = ${targetCalories} - ${protein * 4} - ${fat * 9} = <b>${carbCalories} kcal</b> Ã· 4 = <b>${carbs} g</b><br>
        5) å®é‡æ¯”ä¾‹ï¼š
           &nbsp;&nbsp;â€¢ ç¢³æ°´ = ${Math.round(carbs * 4 / targetCalories * 100)}%
           &nbsp;&nbsp;â€¢ è›‹ç™½è´¨ = ${Math.round(protein * 4 / targetCalories * 100)}%
           &nbsp;&nbsp;â€¢ è„‚è‚ª = ${Math.round(fat * 9 / targetCalories * 100)}%
    `;

    // ç›´æ¥æ›´æ–° #fast-logic-box çš„å†…å®¹
    const logicBox = document.getElementById('fast-logic-box');
    if (logicBox) {
        logicBox.innerHTML = logicHtml;
    }
}

// æ›´æ–°ä¸€å‘¨è¡¨æ ¼å‡½æ•°
// æ›´æ–°ä¸€å‘¨è¡¨æ ¼å‡½æ•° - ç¡®ä¿è¿™ä¸ªå‡½æ•°æ­£ç¡®æ›´æ–°æ‰€æœ‰å•å…ƒæ ¼
function updateFastWeekTable(carbs, protein, fat, totalCalories) {
    const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
    const selectedWindow = document.querySelector('[data-window].selected').dataset.window;
    
    // è·å–è¿›é£Ÿçª—å£æ˜¾ç¤ºæ–‡æœ¬
    let windowText = '12:00-20:00';
    switch(selectedWindow) {
        case '12-20': windowText = '12:00-20:00'; break;
        case '10-18': windowText = '10:00-18:00'; break;
        case '13-21': windowText = '13:00-21:00'; break;
        case 'custom': 
            const start = $('#fast-start').value || '12:00';
            const end = $('#fast-end').value || '20:00';
            windowText = `${start}-${end}`;
            break;
    }
    
    // å‘¨æœ«ç¨å¾®è°ƒæ•´ç¢³æ°´å’Œçƒ­é‡ï¼ˆæ¨¡æ‹Ÿæ¬ºéª—é¤ï¼‰
    const weekendCarbs = Math.round(carbs * 1.1); // å‘¨æœ«å¢åŠ 10%ç¢³æ°´
    const weekendCalories = Math.round(totalCalories * 1.05); // å‘¨æœ«å¢åŠ 5%çƒ­é‡
    
    days.forEach((day, index) => {
        const isWeekend = index >= 5; // å‘¨å…­å‘¨æ—¥
        const dayCarbs = isWeekend ? weekendCarbs : carbs;
        const dayCalories = isWeekend ? weekendCalories : totalCalories;
        
        // æ›´æ–°è¡¨æ ¼æ•°æ® - ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ID
        $(`fast-${day}-window`).textContent = windowText;
        $(`fast-${day}-carb`).textContent = dayCarbs;
        $(`fast-${day}-protein`).textContent = protein;
        $(`fast-${day}-fat`).textContent = fat;
        $(`fast-${day}-calories`).textContent = dayCalories;
        
        // æ›´æ–°é¤æ¬¡å®‰æ’æç¤º - ä¿®å¤è¿™é‡Œï¼
        const mealCell = $(`fast-${day}-calories`).closest('tr').querySelector('td:last-child');
        if (mealCell && mealCell.classList.contains('editable')) {
            if (isWeekend) {
                mealCell.textContent = 'æ—©åˆé¤+æ™šé¤ï¼ˆå‘¨æœ«ï¼‰';
            } else {
                mealCell.textContent = 'åˆé¤+æ™šé¤';
            }
        }
    });
}
// 16+8å¯¼å‡ºåŠŸèƒ½
function dlFastPlan() {
    const w = +$('fast-weight').value,
          h = +$('fast-height').value,
          a = +$('fast-age').value,
          g = $('fast-gender').value,
          activity = +document.querySelector('[data-activity].selected').dataset.activity,
          windowType = document.querySelector('[data-window].selected').dataset.window;
    
    const bmr = +$('fast-bmr').textContent,
          tdee = +$('fast-tdee').textContent,
          targetCalories = +$('fast-calories').textContent,
          protein = +$('fast-protein').textContent;
    
    // åŸºç¡€ä¿¡æ¯
    const basic = [
        ['16+8è½»æ–­é£Ÿè®¡åˆ’'],
        ['ä½“é‡(kg)', w],
        ['èº«é«˜(cm)', h],
        ['å¹´é¾„(å²)', a],
        ['æ€§åˆ«', g === 'male' ? 'ç”·' : 'å¥³'],
        ['æ´»åŠ¨ç³»æ•°', activity],
        ['åŸºç¡€ä»£è°¢(BMR)', `${bmr} kcal`],
        ['æ¯æ—¥æ€»æ¶ˆè€—(TDEE)', `${tdee} kcal`],
        ['ç›®æ ‡çƒ­é‡', `${targetCalories} kcal`],
        ['è¿›é£Ÿçª—å£', windowType],
        [], [],
        ['ä¸€å‘¨è½»æ–­é£Ÿè®¡åˆ’è¡¨']
    ];
    
    // è¡¨æ ¼æ ‡é¢˜
    const tableHeader = ['æ˜ŸæœŸ', 'è¿›é£Ÿçª—å£', 'ç¢³æ°´(g)', 'è›‹ç™½è´¨(g)', 'è„‚è‚ª(g)', 'æ€»çƒ­é‡(kcal)', 'é¤æ¬¡å®‰æ’'];
    
    // è¡¨æ ¼æ•°æ®
    const daysCN = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
    const daysEN = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
    const tableData = daysCN.map((dayCN, index) => {
        const day = daysEN[index];
        return [
            dayCN,
            $(`fast-${day}-window`).textContent,
            $(`fast-${day}-carb`).textContent,
            $(`fast-${day}-protein`).textContent,
            $(`fast-${day}-fat`).textContent,
            $(`fast-${day}-calories`).textContent,
            $(`fast-${day}-calories`).parentNode.querySelector('.editable').textContent
        ];
    });
    
    const data = [...basic, tableHeader, ...tableData];
    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, '16+8è½»æ–­é£Ÿè®¡åˆ’');
    XLSX.writeFile(wb, `16+8è½»æ–­é£Ÿ_${w}kg.xlsx`);
}

// ç»‘å®šå¯¼å‡ºæŒ‰é’®
$('fast-downloadBtn').addEventListener('click', dlFastPlan);

// è‡ªå®šä¹‰çª—å£æ—¶é—´å˜åŒ–æ—¶æ›´æ–°è¡¨æ ¼
function updateCustomWindow() {
    if (document.querySelector('[data-window].selected').dataset.window === 'custom') {
        calculateFast();
    }
}

// ç»‘å®šè‡ªå®šä¹‰çª—å£æ—¶é—´å˜åŒ–äº‹ä»¶
$('fast-start').addEventListener('change', updateCustomWindow);
$('fast-end').addEventListener('change', updateCustomWindow);

// äº‹ä»¶ç»‘å®š
$('fast-calculateBtn').addEventListener('click', calculateFast);
$('fast-downloadBtn').addEventListener('click', dlFastPlan);
$('fast-resetBtn').addEventListener('click', function() {
    $('fast-weight').value = 70;
    $('fast-height').value = 175;
    $('fast-age').value = 30;
    $('fast-gender').value = 'male';
    $('fast-start').value = '12:00';
    $('fast-end').value = '20:00';
    windowCards[0].click();
    activityCards[0].click();
    calculateFast();
});

// åˆå§‹åŒ–è®¡ç®—
calculateFast();
// åˆå§‹åŒ–16+8è½»æ–­é£Ÿ
calculateFast();

// åˆå§‹åŒ–å¢è‚Œè®¡åˆ’ï¼ˆç¡®ä¿æœ‰åˆå§‹æ•°æ®ï¼‰
calcBulk(); // æ·»åŠ è¿™ä¸€è¡Œ
    </script>
<!-- ========= 1. å…¨å±æ°´å° ========= -->
<script>
(function(){
  const canvas = document.createElement('canvas');
  const ctx    = canvas.getContext('2d');
  canvas.width = 320;
  canvas.height = 320;
  ctx.font = 'bold 20px sans-serif';
  ctx.fillStyle = 'rgba(60,60,60,0.25)'; // æ·±ç° 35% ä¸é€æ˜åº¦
  ctx.textAlign = 'center';
  ctx.translate(160,160);
  ctx.rotate(-Math.PI/6);
  ctx.fillText('Â© Cyyå¥èº«,ç¦æ­¢è½¬è½½/å•†ç”¨',0,0);
  ctx.rotate(Math.PI/6);
  const div = document.createElement('div');
  div.style.cssText = 'position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:9999;background:url('+canvas.toDataURL()+') repeat';
  document.body.appendChild(div);
})();
</script>

<!-- ========= 2. ç¦ç”¨å³é”® & å¸¸ç”¨å¼€å‘è€…å¿«æ·é”® ========= -->
<!-- ========= 2. ä¿®æ”¹ç¦ç”¨å³é”® & å¸¸ç”¨å¼€å‘è€…å¿«æ·é”® ========= -->
<script>
['keydown'].forEach(function(ev){
  document.addEventListener(ev,function(e){
    if(ev==='keydown' && (
         e.ctrlKey&&e.shiftKey&&(e.key==='I'||e.key==='J') ||
         e.ctrlKey&&e.key==='U' ||
         e.key==='F12'
       )){
      e.preventDefault(); return false;
    }
  });
});
</script>

<!-- ========= 3. åˆ é™¤å¤åˆ¶æ—¶è¿½åŠ ç‰ˆæƒçš„ä»£ç ï¼ˆæ”¾å¼€å¤åˆ¶ï¼‰ ========= -->
<!-- å®Œå…¨åˆ é™¤æ­¤éƒ¨åˆ†ä»£ç  -->
<!-- ========= 4. é¡µé¢åº•éƒ¨å›ºå®šç‰ˆæƒæ  ========= -->
<style>
#copyright-bar{
  position:fixed;
  left:0;right:0;bottom:0;
  height:32px;
  background:#0ea5e9;
  color:#fff;
  font-size:13px;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10000;
  letter-spacing:.5px;
}
/* ===== å¢è‚Œè®¡åˆ’ä¸“å±æ ·å¼ ===== */
.bulk-section{display:none;}
.bulk-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;}
.bulk-input-group{flex:1 1 120px;display:flex;flex-direction:column;}
.bulk-level-cards{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;}
.bulk-level-card{flex:1 1 130px;border:1px solid #cbd5e1;border-radius:8px;padding:10px;text-align:center;cursor:pointer;transition:.2s;background:#fff;}
.bulk-level-card.selected{border-color:var(--primary);background:#e0f2fe;}
.bulk-level-card h4{font-size:.8rem;margin-bottom:4px;color:var(--primary);}
.bulk-level-card p{font-size:.65rem;margin:0;color:#64748b;}
.bulk-stats{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;}
.quick-stats{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;}
.bulk-stat{flex:1 1 120px;background:#f0f9ff;border-radius:8px;padding:10px;text-align:center;}
.bulk-stat .value{font-size:1.1rem;font-weight:700;color:var(--primary);}
.bulk-stat .label{font-size:.7rem;color:#64748b;}
/* è®©å¢è‚Œè®¡åˆ’é‡Œçš„ plan-cards ä¸ç¢³å¾ªç¯ä¿æŒä¸€è‡´ */
#bulk-plan-cards{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px;}
#bulk-plan-cards .plan-card{flex:1 1 80px;}
</style>
<div id="copyright-bar">
  Â© 2026 Cyyå¥èº« | ä»…é™ä¸ªäººä½¿ç”¨ | ç¦æ­¢è½¬è½½ã€å•†ç”¨ | è¿è€…å¿…ç©¶
</div>
</body>
</html>