<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyyå¥èº«è¥å…»æ™ºèƒ½å·¥å…·</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            /* Light Mode Variables */
            --primary: #0ea5e9;
            --primary-rgb: 14, 165, 233;
            --primary-dark: #0284c7;
            --primary-light: #e0f2fe;
            
            --bg-body: #f8fafc;
            --bg-gradient: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            --bg-card: #ffffff;
            --bg-input: #ffffff;
            
            --text-main: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            
            --border-color: #e2e8f0;
            --border-focus: #38bdf8;
            
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #f43f5e;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            
            /* Tag Colors (Light) */
            --tag-high-bg: #bae6fd; --tag-high-text: #0c4a6e;
            --tag-med-bg: #e0f2fe; --tag-med-text: #0c4a6e;
            --tag-low-bg: #fef3c7; --tag-low-text: #78350f;
        }

        [data-theme="dark"] {
            /* Dark Mode Variables */
            --primary: #38bdf8; /* Lighter blue for dark mode */
            --primary-rgb: 56, 189, 248;
            --primary-dark: #7dd3fc;
            --primary-light: rgba(14, 165, 233, 0.2);
            
            --bg-body: #0f172a;
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --bg-card: #1e293b;
            --bg-input: #334155;
            
            --text-main: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            
            --border-color: #334155;
            --border-focus: #0ea5e9;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3);

            /* Tag Colors (Dark) */
            --tag-high-bg: #075985; --tag-high-text: #e0f2fe;
            --tag-med-bg: #0c4a6e; --tag-med-text: #e0f2fe;
            --tag-low-bg: #78350f; --tag-low-text: #fef3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        }

        body {
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-main);
            padding-bottom: 50px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* é¦–é¡µæ ·å¼ */
        .home-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 40px;
            text-align: center;
            animation: fadeIn 0.6s ease-out;
            margin-top: 30px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .home-container h1 {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 2.2rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .home-subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 30px;
        }

        .tool-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-align: left;
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
        }

        .tool-card:hover {
            transform: translateY(-6px);
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
        }

        .tool-card h2 {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .tool-card p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 0.95rem;
            flex-grow: 1;
        }

        .tool-features {
            list-style: none;
            text-align: left;
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 20px;
            background: rgba(var(--primary-rgb), 0.05);
            padding: 12px;
            border-radius: var(--radius-sm);
        }

        .tool-features li {
            padding: 3px 0;
            padding-left: 18px;
            position: relative;
        }

        .tool-features li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: bold;
        }

        .btn-enter {
            width: 100%;
            background: var(--primary);
            color: #ffffff; /* Always white text on primary button */
            border: none;
            padding: 12px;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(var(--primary-rgb), 0.3);
        }

        .btn-enter:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 6px 8px rgba(var(--primary-rgb), 0.4);
        }

        .badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--warning);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 2;
        }

        /* å·¥å…·é¡µé¢ */
        .tool-page {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        header {
            background: rgba(var(--bg-card), 0.8); /* Glass effect base */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 16px 24px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            position: sticky;
            top: 10px;
            z-index: 100;
            border: 1px solid var(--border-color);
        }

        .header-left { display: flex; align-items: center; gap: 15px; }
        .header-right { display: flex; align-items: center; gap: 10px; }

        .back-home-btn {
            background: var(--text-secondary); /* Slate color */
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .back-home-btn:hover {
            background: var(--text-main);
        }

        /* Dark Mode Toggle Button */
        .theme-toggle-btn {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
        }
        .theme-toggle-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: rotate(15deg);
        }
        
        /* Home page specific toggle positioning */
        .home-theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }

        header h1 {
            font-size: 1.4rem;
            color: var(--primary);
            margin: 0;
            font-weight: 700;
            line-height: 1.2;
        }

        header .subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 2px 0 0 0;
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 5px;
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
            transition: .3s;
            position: relative;
            top: 1px;
        }

        .tab-btn:hover {
            color: var(--primary);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s; }

        /* å†…å®¹åŒºå— */
        .top-row { display: flex; gap: 20px; flex-wrap: wrap; }
        .top-row > section {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            flex: 1 1 280px;
            min-width: 280px;
        }

        h3 {
            font-size: 1rem;
            color: var(--primary);
            margin-bottom: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        h3::before {
            content: '';
            display: block;
            width: 4px;
            height: 16px;
            background: var(--primary);
            border-radius: 2px;
        }

        /* è¾“å…¥ç»„ */
        .basic-row, .macro-row { display: flex; gap: 12px; flex-wrap: wrap; }
        .input-group { flex: 1 1 120px; display: flex; flex-direction: column; }

        label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 6px;
        }

        input, select {
            padding: 10px 12px;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: var(--bg-input);
            color: var(--text-main);
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus, select:focus {
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);
        }
        
        .target-weight-input-group { flex: 0 1 auto !important; min-width: unset !important; }
        .target-weight-controls { display: flex; align-items: center; gap: 8px; justify-content: center; }
        .target-weight-controls input { width: 60px !important; text-align: center; }
        .target-weight-controls button {
            flex: 0 0 28px; height: 28px;
            border: 1px solid var(--primary);
            background: transparent; color: var(--primary);
            border-radius: 50%; font-size: 16px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .target-weight-controls button:hover {
            background: var(--primary);
            color: #fff;
        }

        /* å¡ç‰‡é€‰æ‹©ç»„ */
        .body-type-cards, .plan-cards, .bulk-level-cards, .orange-ratio-cards {
            display: flex; gap: 10px; flex-wrap: wrap;
        }

        .body-type-card, .plan-card, .bulk-level-card, .orange-ratio-card {
            flex: 1 1 90px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 12px 8px;
            font-size: 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: .2s;
            background: var(--bg-input);
        }

        .body-type-card:hover, .plan-card:hover, .bulk-level-card:hover, .orange-ratio-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .selected {
            border-color: var(--primary) !important;
            background: var(--primary-light) !important;
            color: var(--text-main);
            box-shadow: 0 0 0 1px var(--primary);
        }

        .body-type-card h4, .plan-card h4, .bulk-level-card h4, .orange-ratio-card h4 {
            font-size: 0.85rem; margin-bottom: 4px; color: var(--primary);
        }
        
        .body-type-card p, .plan-card p, .bulk-level-card p, .orange-ratio-card p {
            font-size: 0.65rem; margin: 0; line-height: 1.2; color: var(--text-secondary);
        }

        /* ç»“æœå±•ç¤ºå¡ç‰‡ */
        .summary-cards, .target-stats, .bulk-stats, .orange-stats, .water-stats {
            display: flex; gap: 10px; flex-wrap: wrap; margin-top: 16px;
        }

        .summary-card, .target-stat, .bulk-stat, .orange-stat, .water-stat {
            flex: 1 1 80px;
            background: var(--primary-light);
            border-radius: var(--radius-sm);
            padding: 12px 8px;
            text-align: center;
            border: 1px solid transparent;
        }
        
        [data-theme="dark"] .summary-card, 
        [data-theme="dark"] .target-stat,
        [data-theme="dark"] .bulk-stat,
        [data-theme="dark"] .orange-stat,
        [data-theme="dark"] .water-stat {
            border-color: var(--primary);
            background: rgba(56, 189, 248, 0.1);
        }

        .summary-card .val, .target-stat .value, .bulk-stat .value, .orange-stat .value, .water-stat .value {
            font-size: 1.2rem; font-weight: 800; color: var(--primary); display: block; margin-bottom: 2px;
        }

        .summary-card .lab, .target-stat .label, .bulk-stat .label, .orange-stat .label, .water-stat .label {
            font-size: 0.7rem; color: var(--text-secondary);
        }

        /* æŒ‰é’®ç»„ */
        .btn-row { display: flex; gap: 12px; flex-wrap: wrap; margin: 24px 0; }
        .btn-row button {
            flex: 1 1 120px; padding: 12px 0;
            border: none; border-radius: var(--radius-sm);
            font-size: 0.9rem; font-weight: 600;
            cursor: pointer; color: #fff; transition: .2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-calc { background: var(--primary); }
        .btn-down { background: var(--success); }
        .btn-reset { background: var(--warning); }
        .btn-back { background: var(--text-secondary); }
        .btn-row button:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.15); filter: brightness(1.1); }

        /* è¡¨æ ¼æ ·å¼ */
        .table-wrap { overflow-x: auto; margin-top: 20px; border-radius: var(--radius-sm); border: 1px solid var(--border-color); }
        /* ä»…éšè—æ¨ªå‘ 28 åˆ—è¡¨æ ¼ï¼Œå…¶ä½™ä¸€åˆ‡ä¿æŒåŸæ · */
        #planTable { display: none !important; min-width: 1400px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; background: var(--bg-card); }
        th, td { border: 1px solid var(--border-color); padding: 10px 8px; text-align: center; white-space: nowrap; }
        th { background: var(--primary-light); color: var(--primary); font-weight: 700; }
        
        /* Striped rows adaptable to dark mode */
        tbody tr:nth-child(odd) { background: var(--bg-card); }
        tbody tr:nth-child(even) { background: rgba(0,0,0,0.02); }
        [data-theme="dark"] tbody tr:nth-child(even) { background: rgba(255,255,255,0.03); }
        
        .editable { background: rgba(253, 224, 71, 0.15); }
        [data-theme="dark"] .editable { background: rgba(253, 224, 71, 0.1); }
        
        /* ç«–å‘è¡¨ specific */
        .week-tables { margin-top: 20px; font-size: 0.8rem; }
        .week-table {
            background: var(--bg-card); border-radius: var(--radius-md);
            padding: 16px; margin-bottom: 16px;
            box-shadow: var(--shadow-sm); border: 1px solid var(--border-color);
        }
        .week-table th { font-size: 0.75rem; }
        
        /* Tag Colors adaptable */
        .week-table .high, .tag.high { background: var(--tag-high-bg); color: var(--tag-high-text); }
        .week-table .med, .tag.med { background: var(--tag-med-bg); color: var(--tag-med-text); }
        .week-table .low, .tag.low { background: var(--tag-low-bg); color: var(--tag-low-text); }

        /* åº•éƒ¨è¯´æ˜ */
        .notes {
            background: var(--bg-card); border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm); border: 1px solid var(--border-color);
            padding: 20px 24px; margin-top: 24px;
            font-size: 0.85rem; line-height: 1.7; color: var(--text-secondary);
        }
        .notes h3 { margin-bottom: 12px; color: var(--primary); font-size: 1.1rem; }
        .notes ul { margin: 0; padding-left: 20px; }
        .notes li { margin-bottom: 8px; }
        .tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-weight: bold; margin-right: 4px; font-size: 0.7rem; }

        /* å¿ƒç‡åŒºé—´ç‰¹æ®Šæ ·å¼ */
        .hr-zone-bar { height: 10px; background: var(--border-color); border-radius: 5px; margin-top: 8px; overflow: hidden; }
        .hr-zone-fill { height: 100%; border-radius: 5px; }
        .zone-gray { background: #94a3b8; }
        .zone-blue { background: #3b82f6; }
        .zone-green { background: #10b981; }
        .zone-orange { background: #f59e0b; }
        .zone-red { background: #ef4444; }

        footer { text-align: center; color: var(--text-muted); font-size: 0.7rem; margin-top: 30px; margin-bottom: 20px; }

        #copyright-bar {
            position: fixed; left: 0; right: 0; bottom: 0;
            height: 32px; background: var(--primary); color: #fff;
            font-size: 13px; display: flex; align-items: center; justify-content: center;
            z-index: 10000; letter-spacing: .5px;
            backdrop-filter: blur(5px);
        }

        /* Helper Utilities */
        .hidden { display: none !important; }
        .custom-plan, #custom-ratio-inputs, #fast-custom-window, #bulk-custom-plan {
            display: none; gap: 8px; flex-wrap: wrap; margin-top: 12px;
        }
        .custom-plan input, #bulk-custom-plan input { flex: 1 1 60px; font-size: 0.75rem; padding: 6px 4px; text-align: center; border: 1px solid var(--border-color); border-radius: var(--radius-sm); }
        
        .weight-loss-slider { margin: 16px 0; }
        .weight-loss-slider label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; }
        .slider-container { display: flex; align-items: center; gap: 12px; }
        .slider-container input[type="range"] { flex: 1; cursor: pointer; }
        .slider-value { min-width: 48px; text-align: center; font-weight: 700; color: var(--primary); }
        
        .custom-ratio-inputs { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
        .custom-ratio-input { flex: 1; min-width: 90px; }
        .custom-ratio-input label { font-size: 0.75rem; font-weight: 600; display: block; margin-bottom: 6px; }
        .custom-ratio-input input { width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); text-align: center; }
        .ratio-sum { margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary); font-weight: 500; }
        .ratio-sum.error { color: var(--danger); font-weight: 700; }

        /* Mobile specific adjustments */
        @media (max-width: 600px) {
            .home-container { padding: 24px 20px; margin-top: 10px; }
            .home-container h1 { font-size: 1.8rem; }
            .tools-grid { grid-template-columns: 1fr; }
            .basic-row .input-group { flex: 1 1 100% !important; }
            .target-weight-input-group { flex: 1 1 100% !important; }
            .target-weight-controls { justify-content: flex-start; }
            .tab-btn { padding: 10px 14px; font-size: 0.9rem; flex: 1 1 auto; text-align: center; }
            header { flex-direction: column; align-items: flex-start; gap: 12px; padding: 16px; }
            .header-left { width: 100%; justify-content: space-between; }
            .header-right { position: absolute; top: 16px; right: 16px; }
            .back-home-btn { padding: 6px 12px; }
            .home-theme-toggle { top: 15px; right: 15px; }
        }

        /* Watermark optimization */
        #global-watermark {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            pointer-events: none; z-index: 9999;
            background-repeat: repeat;
            transition: filter 0.3s ease, opacity 0.3s ease;
            /* Light mode defaults */
            mix-blend-mode: multiply;
            filter: none;
            opacity: 0.8;
        }
        [data-theme="dark"] #global-watermark {
            /* Dark mode: Invert dark text to light, use screen blending */
            mix-blend-mode: screen;
            filter: invert(1);
            opacity: 0.4;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "@monaco-editor/loader": "https://esm.sh/@monaco-editor/loader@^1.7.0",
    "markdown-it": "https://esm.sh/markdown-it@^14.1.0",
    "safevalues": "https://cdn.jsdelivr.net/npm/safevalues@^1.2.0/dist/mjs/index.min.js",
    "safevalues/": "https://esm.sh/safevalues@^1.2.0/",
    "sortablejs": "https://esm.sh/sortablejs@^1.15.6"
  }
}
</script>
</head>
<body>
    <!-- é¦–é¡µ -->
    <div id="home-page" class="container home-container">
        <!-- é¦–é¡µåˆ‡æ¢æŒ‰é’® -->
        <button class="theme-toggle-btn home-theme-toggle" title="åˆ‡æ¢å¤œé—´æ¨¡å¼">ğŸŒ™</button>

        <h1>Cyyå¥èº«è¥å…»æ™ºèƒ½å·¥å…·</h1>
        <p class="home-subtitle">æŠ–éŸ³ï¼Œå¿«æ‰‹ï¼Œå¾®ä¿¡è§†é¢‘å·æœç´¢ã€Cyyå¥èº«ã€‘</p>
        
        <!-- ä½“è„‚ç‡å‚è€ƒåŒºåŸŸ -->
        <div style="text-align:center; margin:0 auto 5px;">
            <a href="javascript:void(0)" onclick="toggleBodyFatImage()" style="color:var(--danger); font-size:17px; text-decoration:underline;">
                ğŸ“Œ ç‚¹å‡»æŸ¥çœ‹ä½“è„‚ç‡å‚è€ƒå›¾
            </a>
            <div id="bodyfat-container" style="display:none;margin-top:12px;">
                <img src="https://s21.ax1x.com/2025/11/18/pZi0KXT.md.jpg" alt="ä½“è„‚ç‡å‚è€ƒ" style="max-width:100%;height:auto;border-radius:12px;box-shadow:var(--shadow-lg);">
                <p style="margin-top:8px;font-size:.85rem;color:var(--text-secondary)">å¸¸è§ä½“è„‚ç‡å¤–è§‚å¯¹ç…§ï¼Œä»…ä¾›å‚è€ƒ</p>
            </div>
        </div>

        <div class="tools-grid">
            <div class="tool-card" onclick="selectTool('kings-cycle')">
                <span class="badge">æ²¡æ‹›äº†å°±é€‰è¿™ä¸ª</span>
                <h2>å‡¯åœ£ç‹ç¢³å¾ªç¯</h2>
                <p>é€šè¿‡å‘¨æœŸæ€§è°ƒæ•´ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥é‡,<br>å®ç°é«˜æ•ˆå‡è„‚å¢è‚Œçš„ç›®æ ‡ã€‚</p>
                <ul class="tool-features">
                    <li>é€‚åˆå¥èº«çˆ±å¥½è€…</li>
                    <li>å¹³å°æœŸå¤§æ€å™¨</li>
                    <li>å‡è„‚é€Ÿåº¦å¿«</li>
                    <li>éœ€è¦è®°å½•é¥®é£Ÿ</li>
                </ul>
                <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
            </div>
            
            <div class="tool-card" onclick="selectTool('orange-carb')">
                <span class="badge">æ–°æ‰‹é€‰è¿™ä¸ª</span>
                <h2>æ©™å­ç¢³æ°´æ¸é™</h2>
                <p>é€šè¿‡é€æ­¥é™ä½ç¢³æ°´åŒ–åˆç‰©æ‘„å…¥é‡,<br>æ¸©å’Œå®ç°å‡è„‚ç›®æ ‡ã€‚</p>
                <ul class="tool-features">
                    <li>é€‚åˆè®­ç»ƒå°‘çš„æ–°æ‰‹</li>
                    <li>é€‚åˆå¤§åŸºæ•°é«˜ä½“è„‚</li>
                    <li>æ¸é™å¼è°ƒæ•´ç¢³æ°´</li>
                    <li>å‡è„‚é€Ÿåº¦å¹³ç¼“</li>
                </ul>
                <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" onclick="selectTool('sixteen-eight')">
                <span class="badge">æ˜“åšæŒ</span>
                <h2>16+8è½»æ–­é£Ÿ</h2>
                <p>16å°æ—¶ç¦é£Ÿ + 8å°æ—¶è¿›é£Ÿçª—å£<br>æ¸©å’Œå‡è„‚ï¼Œæ”¹å–„ä»£è°¢ã€‚</p>
                <ul class="tool-features">
                    <li>ä¸å¥èº«ä¹Ÿå¯ç”¨</li>
                    <li>æ— éœ€ä¸¥æ ¼è®¡ç®—çƒ­é‡</li>
                    <li>æ”¹å–„èƒ°å²›ç´ æ•æ„Ÿæ€§</li>
                    <li>æ˜“åšæŒä¸åå¼¹</li>
                </ul>
                <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" onclick="selectTool('bulk-plan')">
                <span class="badge">è‚Œè‚‰æ‹¼å›¾</span>
                <h2>å¢è‚Œè®¡åˆ’</h2>
                <p>å°çƒ­é‡ç›ˆä½™ + æ­£æ°®å¹³è¡¡ã€‚<br>å‚è€ƒæ¥æº:è¿åŠ¨è¥å…»å­¦ã€é—ªç”µå¢è‚Œã€å¥èº«è¥å…»ä¹¦ã€å‡¯åœ£ç‹ã€è‡ªç„¶ç‹ç­‰</p>
                <ul class="tool-features">
                    <li>è‡ªåŠ¨è®¡ç®— BMR / TDEE</li>
                    <li>ä¸‰æ¡£çƒ­é‡ç›ˆä½™å¯é€‰</li>
                    <li>è®­ç»ƒæ—¥ / ä¼‘æ¯æ—¥åŠ¨æ€ç¢³æ°´</li>
                    <li>æ”¯æŒå¯¼å‡º Excel</li>
                </ul>
                <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" onclick="selectTool('water-plan')">
                <span class="badge" style="background:#06b6d4">ç”Ÿå‘½ä¹‹æº</span>
                <h2>ç§‘å­¦é¥®æ°´å»ºè®®</h2>
                <p>æ ¹æ®ä½“é‡ä¸è¿åŠ¨æ¶ˆè€—ï¼Œè®¡ç®—ç²¾å‡†è¡¥æ°´æ–¹æ¡ˆã€‚<br>å‘Šåˆ«ç›²ç›®å–æ°´ã€‚</p>
                <ul class="tool-features">
                    <li>è¿åŠ¨æŸè€—è¡¥å¿</li>
                    <li>é»„é‡‘è¡¥æ°´æ—¶é—´è¡¨</li>
                    <li>æå‡ä»£è°¢æ•ˆç‡</li>
                    <li>é˜²æ­¢è¿åŠ¨è„±æ°´</li>
                </ul>
                <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" onclick="selectTool('heart-rate')">
                <span class="badge" style="background:#f43f5e">è¿åŠ¨æ ¸å¿ƒ</span>
                <h2>å¿ƒç‡åŒºé—´è®¡ç®—</h2>
                <p>åŸºäºå‚¨å¤‡å¿ƒç‡(Karvonen)å…¬å¼ï¼Œ<br>ç²¾å‡†åˆ’åˆ†ç‡ƒè„‚ã€è€åŠ›ä¸æé™åŒºé—´ã€‚</p>
                <ul class="tool-features">
                    <li>ç²¾å‡†å¡æ²ƒå—å…¬å¼</li>
                    <li>äº”å¤§å¿ƒç‡åŒºé—´</li>
                    <li>å®‰å…¨è¿åŠ¨ç›‘æ§</li>
                    <li>ç§‘å­¦å‡è„‚å¢è‚Œ</li>
                </ul>
                <button class="btn-enter">ç«‹å³ä½¿ç”¨</button>
            </div>
        </div>
    </div>

    <!-- å·¥å…·ä¸»ç•Œé¢ -->
    <div id="kings-cycle-tool" class="tool-page">
        <div class="container">
            <header>
                <div class="header-left">
                    <button class="back-home-btn" onclick="backToHome()">
                        <span style="font-size:1.2em;">â†</span> è¿”å›
                    </button>
                    <div>
                        <h1 style="margin:0;">Cyyå¥èº«è¥å…»æ™ºèƒ½å·¥å…·</h1>
                        <p class="subtitle" style="margin:0;">æŠ–éŸ³ï¼Œå¾®ä¿¡è§†é¢‘å·æœç´¢ã€Cyyå¥èº«ã€‘æ©±çª—æœ‰å„ç§å‡è„‚å¿…å¤‡å¥½ç‰©,æ„Ÿè°¢å„ä½æ§åœº</p>
                    </div>
                </div>
                <div class="header-right">
                    <!-- å†…é¡µåˆ‡æ¢æŒ‰é’® -->
                    <button class="theme-toggle-btn" title="åˆ‡æ¢å¤œé—´æ¨¡å¼">ğŸŒ™</button>
                </div>
            </header>

            <div class="tabs">
                <button class="tab-btn active" data-tab="kings-cycle">å‡¯åœ£ç‹ç¢³å¾ªç¯</button>
                <button class="tab-btn" data-tab="orange-carb">æ©™å­ç¢³æ°´æ¸é™</button>
                <button class="tab-btn" data-tab="sixteen-eight">16+8è½»æ–­é£Ÿ</button>
                <button class="tab-btn" data-tab="bulk-plan">å¢è‚Œè®¡åˆ’</button>
                <button class="tab-btn" data-tab="water-plan">é¥®æ°´å»ºè®®</button>
                <button class="tab-btn" data-tab="heart-rate">å¿ƒç‡è®¡ç®—</button>
            </div>

            <!-- 1. å‡¯åœ£ç‹ç¢³å¾ªç¯ -->
            <div id="kings-cycle" class="tab-content active">
                <div class="top-row">
                    <section>
                        <h3>ç¬¬ä¸€æ­¥ï¼šè¾“å…¥åŸºç¡€ä¿¡æ¯</h3>
                        <div class="basic-row">
                            <div class="input-group"><label>å½“å‰ä½“é‡(kg)</label><input type="number" id="weight" value="75" min="40" max="200"></div>
                            <div class="input-group target-weight-input-group">
                                <label>ç›®æ ‡ä½“é‡(Â±5kg)</label>
                                <div class="target-weight-controls">
                                    <button type="button" onclick="adjustTarget(-1)">âˆ’</button>
                                    <input type="tel" id="targetWeight" value="70" min="40" max="200" step="1" pattern="\d*" oninput="clipTargetWeight()">
                                    <button type="button" onclick="adjustTarget(1)">+</button>
                                </div>
                            </div>
                            <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="height" value="178" min="140" max="220"></div>
                            <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="age" value="30" min="18" max="80"></div>
                            <div class="input-group"><label>æ€§åˆ«</label>
                                <select id="gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3>ç¬¬äºŒæ­¥ï¼šé€‰æ‹©èƒšå‹</h3>
                        <div class="body-type-cards">
                            <div class="body-type-card selected" data-type="ectomorph"><h4>å¤–èƒšå‹</h4><p>æ˜“ç˜¦</p></div>
                            <div class="body-type-card" data-type="mesomorph"><h4>ä¸­èƒšå‹</h4><p>è‚Œè‚‰å‹</p></div>
                            <div class="body-type-card" data-type="endomorph"><h4>å†…èƒšå‹</h4><p>æ˜“èƒ–</p></div>
                        </div>
                        <div style="text-align:center;margin-top:10px;">
                          <a href="javascript:void(0)" onclick="toggleBodyTypeRef()" style="color:var(--danger);font-size:.85rem;text-decoration:underline;">
                            ğŸ“Œ ç‚¹å‡»æŸ¥çœ‹èƒšå‹å‚è€ƒå›¾
                          </a>
                          <div id="bodytype-ref" style="display:none;margin-top:12px;">
                            <img src="https://s21.ax1x.com/2025/11/18/pZiceVf.md.jpg" alt="èƒšå‹å‚è€ƒ" style="max-width:100%;height:auto;border-radius:8px;box-shadow:var(--shadow-md);">
                            <p style="margin-top:6px;font-size:.75rem;color:var(--text-secondary)">å¤–èƒš / ä¸­èƒš / å†…èƒš ä½“å‹å¯¹ç…§ï¼Œä»…ä¾›å‚è€ƒ</p>
                          </div>
                        </div>
                    </section>

                    <section>
                        <h3>ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©è®­ç»ƒè®¡åˆ’</h3>
                        <div class="plan-cards">
                            <div class="plan-card selected" data-plan="1"><h4>ç»ƒ1ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="2"><h4>ç»ƒ2ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="3"><h4>ç»ƒ3ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="4"><h4>ç»ƒ4ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="custom"><h4>è‡ªå®šä¹‰</h4><p>è‡ªç”±</p></div>
                        </div>
                        <div class="custom-plan" id="customPlan">
                            <input placeholder="å‘¨ä¸€" id="cus-mon"><input placeholder="å‘¨äºŒ" id="cus-tue"><input placeholder="å‘¨ä¸‰" id="cus-wed">
                            <input placeholder="å‘¨å››" id="cus-thu"><input placeholder="å‘¨äº”" id="cus-fri"><input placeholder="å‘¨å…­" id="cus-sat"><input placeholder="å‘¨æ—¥" id="cus-sun">
                        </div>
                    </section>

                    <section>
                        <h3>è¥å…»ç´ è®¾ç½®ï¼ˆå·²æ ¹æ®èƒšå‹è‡ªåŠ¨åŒ¹é…ï¼Œæ— éœ€è°ƒæ•´ï¼‰</h3>
                        <div class="macro-row">
                            <div class="input-group"><label>ç¢³æ°´(g/kg)</label><input type="number" id="carbsPerKg" value="3.0" step="0.1" min="1" max="10"></div>
                            <div class="input-group"><label>è›‹ç™½è´¨(g/kg)</label><input type="number" id="proteinPerKg" value="1.3" step="0.1" min="0.8" max="3"></div>
                            <div class="input-group"><label>è„‚è‚ª(g/kg)</label><input type="number" id="fatPerKg" value="1.1" step="0.1" min="0.5" max="2"></div>
                        </div>
                    </section>

                    <section>
                        <h3>æœ€åä¸€æ­¥ï¼šç‚¹å‡»ä¸‹æ–¹è®¡ç®—è®¡åˆ’</h3>
                        <div class="summary-cards">
                            <div class="summary-card"><span class="val" id="bmrValue">1852</span><div class="lab">åŸºç¡€ä»£è°¢</div></div>
                            <div class="summary-card"><span class="val" id="tdeeValue">2352</span><div class="lab">æ¯æ—¥æ€»æ¶ˆè€—</div></div>
                            <div class="summary-card"><span class="val" id="proteinValue">98</span><div class="lab">æ¯æ—¥è›‹ç™½(g)</div></div>
                            <div class="summary-card"><span class="val" id="carbsValue">1575</span><div class="lab">æ¯å‘¨ç¢³æ°´(g)</div></div>
                        </div>
                    </section>
                </div>

                <div class="btn-row">
                    <button class="btn-calc" id="calculateBtn">è®¡ç®—è®¡åˆ’</button>
                    <button class="btn-down" id="downloadBtn">ä¸‹è½½Excel(ç”µè„‘ç«¯)</button>
                    <button class="btn-reset" id="resetBtn">é‡ç½®</button>
                    <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
                </div>

                <div class="target-info">
                    <h3>ç›®æ ‡ä½“é‡åˆ†æ<br>æŠ–éŸ³ï¼Œå¿«æ‰‹ï¼Œå¾®ä¿¡è§†é¢‘å·æœç´¢ã€Cyyå¥èº«ã€‘</h3>
                    <div class="target-stats">
                        <div class="target-stat"><div class="value" id="weightDiffValue">-5</div><div class="label">ä½“é‡å·®(kg)</div></div>
                        <div class="target-stat"><div class="value" id="weeklyCalorieDiffValue">-1400</div><div class="label">å‘¨çƒ­é‡å·®(kcal)</div></div>
                        <div class="target-stat"><div class="value" id="daysNeededValue">42</div><div class="label">é¢„è®¡å¤©æ•°</div></div>
                        <div class="target-stat"><div class="value" id="targetDate">2023-12-24</div><div class="label">é¢„è®¡å®Œæˆæ—¥æœŸ</div></div>
                    </div>
                </div>

                <div id="weekTables" class="week-tables"></div>
                
                <div class="table-wrap">
                    <table id="planTable">
                        <thead>
                            <tr id="dayRow"><th rowspan="2">é¡¹ç›®</th></tr>
                            <tr id="carbLevelRow"></tr>
                        </thead>
                        <tbody>
                            <tr class="band"><td>è®­ç»ƒéƒ¨ä½<br>(å¯åŒå‡»è‡ªå®šä¹‰)</td><td class="editable">ä¼‘æ¯</td><td class="editable">èƒ¸+ä¸‰å¤´</td><td class="editable">ä¼‘æ¯</td><td class="editable">èƒŒ+äºŒå¤´</td><td class="editable">ä¼‘æ¯</td><td class="editable">è…¿+è‚©</td><td class="editable">ä¼‘æ¯</td></tr>
                            <tr class="band"><td>ç¢³æ°´(g)</td><td id="carb-mon">192</td><td id="carb-tue">412</td><td id="carb-wed">124</td><td id="carb-thu">192</td><td id="carb-fri">124</td><td id="carb-sat">412</td><td id="carb-sun">124</td></tr>
                            <tr class="band"><td>è›‹ç™½è´¨(g)</td><td id="protein-mon">118</td><td id="protein-tue">118</td><td id="protein-wed">118</td><td id="protein-thu">118</td><td id="protein-fri">118</td><td id="protein-sat">118</td><td id="protein-sun">118</td></tr>
                            <tr class="band"><td>è„‚è‚ª(g)</td><td id="fat-mon">64</td><td id="fat-tue">41</td><td id="fat-wed">137</td><td id="fat-thu">64</td><td id="fat-fri">137</td><td id="fat-sat">41</td><td id="fat-sun">137</td></tr>
                            <tr class="band"><td>çƒ­é‡(kcal)</td><td id="cal-mon">1817</td><td id="cal-tue">2490</td><td id="cal-wed">2202</td><td id="cal-thu">1817</td><td id="cal-fri">2202</td><td id="cal-sat">2490</td><td id="cal-sun">2202</td></tr>
                            <tr class="band"><td>ç¼ºå£/ç›ˆä½™</td><td id="diff-mon">-535</td><td id="diff-tue">138</td><td id="diff-wed">-150</td><td id="diff-thu">-535</td><td id="diff-fri">-150</td><td id="diff-sat">138</td><td id="diff-sun">-150</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="notes">
                    <h3>ğŸ“Œ ç¢³å¾ªç¯è®¡åˆ’è¯´æ˜</h3>
                    <ul>
                        <li>å¦‚æœä½ éª¨æ¶å°ã€è‚©çª„ã€åƒä¸èƒ–ã€å¢è‚Œæ…¢ï¼š<strong>â†’ åå¤–èƒšå‹</strong></li>
                        <li>å¦‚æœä½ è‚©å®½è…°çª„ã€è‚Œè‚‰å®¹æ˜“é•¿ï¼š<strong>â†’ åä¸­èƒšå‹</strong></li>
                        <li>å¦‚æœä½ éª¨æ¶å¤§ã€è…°è…¹æ˜“å›¤è‚‰ï¼š<strong>â†’ åå†…èƒšå‹</strong></li>
                        <li><span class="tag high">é«˜ç¢³æ—¥</span>ï¼šç¢³æ°´å å‘¨æ€»ç¢³æ°´çš„50%ï¼Œå»ºè®®æ‘„å…¥ç²¾åˆ¶ç¢³æ°´ï¼ˆå¦‚ç™½ç±³ã€ç™½é¢åŒ…ï¼‰</li>
                        <li><span class="tag med">ä¸­ç¢³æ—¥</span>ï¼šç¢³æ°´å å‘¨æ€»ç¢³æ°´çš„35%ï¼Œå»ºè®®æ··åˆç²¾ç¢³å’Œç²—ç¢³</li>
                        <li><span class="tag low">ä½ç¢³æ—¥</span>ï¼šç¢³æ°´å å‘¨æ€»ç¢³æ°´çš„15%ï¼Œå»ºè®®æ‘„å…¥ç²—ç¢³ï¼ˆå¦‚ç³™ç±³ã€ç‡•éº¦ï¼‰</li>
                        <li><strong>çƒ­é‡æ¢ç®—ï¼š</strong> ç¢³/è›‹ç™½ 4 kcal/gï¼Œè„‚è‚ª 9 kcal/gã€‚</li>
                        <li><strong>ä½“é‡å˜åŒ–ä¼°ç®—ï¼š</strong> æ¯å‡å°‘7700 kcalçƒ­é‡çº¦å‡å°‘1 kgä½“é‡ï¼Œæ¯å¢åŠ 7700 kcalçƒ­é‡çº¦å¢åŠ 1 kgä½“é‡ã€‚</li>
                    </ul>
                </div>
            </div>

            <!-- 2. æ©™å­ç¢³æ°´æ¸é™ -->
            <div id="orange-carb" class="tab-content">
                <div class="top-row">
                    <section>
                        <h3>ç¬¬ä¸€æ­¥ï¼šè¾“å…¥åŸºç¡€ä¿¡æ¯</h3>
                        <div class="basic-row">
                            <div class="input-group"><label>å½“å‰ä½“é‡(kg)</label><input type="number" id="orange-weight" value="80" min="40" max="200"></div>
                            <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="orange-height" value="175" min="140" max="220"></div>
                            <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="orange-age" value="32" min="18" max="80"></div>
                            <div class="input-group"><label>æ€§åˆ«</label>
                                <select id="orange-gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3>ç¬¬äºŒæ­¥ï¼šè®­ç»ƒä¿¡æ¯</h3>
                        <div class="orange-input-group">
                            <label>è®­ç»ƒæ—¶é•¿(åˆ†é’Ÿ)</label>
                            <input type="number" id="train-time" value="60" min="30" max="180">
                        </div>
                        <div class="orange-input-group">
                            <label>è®­ç»ƒå¼ºåº¦ç³»æ•°</label>
                            <select id="train-intensity">
                                <option value="5">æ–°æ‰‹/å¥³ç”Ÿ (5)</option>
                                <option value="8" selected>æ™®é€šå¥èº«çˆ±å¥½è€… (8)</option>
                                <option value="10">é«˜å¼ºåº¦è®­ç»ƒè€… (10)</option>
                            </select>
                        </div>
                    </section>

                    <section>
                        <h3>ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©è¥å…»ç´ æ¯”ä¾‹</h3>
                        <div class="orange-ratio-cards">
                            <div class="orange-ratio-card selected" data-ratio="532">
                                <h4>532æ¯”ä¾‹</h4>
                                <p>ç¢³æ°´50% è›‹ç™½30% è„‚è‚ª20%</p>
                            </div>
                            <div class="orange-ratio-card" data-ratio="442">
                                <h4>442æ¯”ä¾‹<br>(ç¢³æ°´å¸æ”¶è¾ƒå¥½)</h4>
                                <p>ç¢³æ°´40% è›‹ç™½40% è„‚è‚ª20%</p>
                            </div>
                            <div class="orange-ratio-card" data-ratio="custom">
                                <h4>è‡ªå®šä¹‰æ¯”ä¾‹</h4>
                                <p>è‡ªå®šä¹‰è¥å…»ç´ æ¯”ä¾‹</p>
                            </div>
                        </div>
                        
                        <div id="custom-ratio-inputs" style="display: none; margin-top: 10px;">
                            <div class="custom-ratio-inputs">
                                <div class="custom-ratio-input"><label>ç¢³æ°´(%)</label><input type="number" id="custom-carb" value="50" min="0" max="100"></div>
                                <div class="custom-ratio-input"><label>è›‹ç™½è´¨(%)</label><input type="number" id="custom-protein" value="30" min="0" max="100"></div>
                                <div class="custom-ratio-input"><label>è„‚è‚ª(%)</label><input type="number" id="custom-fat" value="20" min="0" max="100"></div>
                            </div>
                            <div class="ratio-sum" id="ratio-sum">æ€»å’Œ: 100%</div>
                        </div>
                    </section>
                    
                    <section>
                        <h3>ç¬¬å››æ­¥ï¼šè®¾ç½®å‡é‡ç›®æ ‡</h3>
                        <div class="weight-loss-slider">
                            <label>æ¯æœˆå‡é‡ç™¾åˆ†æ¯” (3-5%)</label>
                            <div class="slider-container">
                                <input type="range" id="weight-loss-percent" min="3" max="5" step="0.1" value="3.5">
                                <span class="slider-value" id="weight-loss-value">3.5%</span>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="btn-row">
                    <button class="btn-calc" id="orange-calculateBtn">è®¡ç®—è®¡åˆ’</button>
                    <button class="btn-down" id="orange-downloadBtn">ä¸‹è½½Excel(ç”µè„‘ç«¯)</button>
                    <button class="btn-reset" id="orange-resetBtn">é‡ç½®</button>
                    <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
                </div>

                <div class="orange-results">
                    <h3>æŠ–éŸ³ï¼Œå¿«æ‰‹ï¼Œå¾®ä¿¡è§†é¢‘å·æœç´¢ã€Cyyå¥èº«ã€‘</h3>
                    <div class="orange-stats">
                        <div class="orange-stat"><div class="value" id="orange-bmrValue">0</div><div class="label">åŸºç¡€ä»£è°¢(BMR)</div></div>
                        <div class="orange-stat"><div class="value" id="orange-trainCalories">0</div><div class="label">è®­ç»ƒæ¶ˆè€—çƒ­é‡</div></div>
                        <div class="orange-stat"><div class="value" id="orange-tdeeValue">0</div><div class="label">æ¯æ—¥æ€»æ¶ˆè€—(TDEE)</div></div>
                        <div class="orange-stat"><div class="value" id="orange-initialCarbs">0</div><div class="label">åˆå§‹ç¢³æ°´(g)</div></div>
                    </div>

                    <div class="orange-stats">
                        <div class="orange-stat"><div class="value" id="orange-protein">0</div><div class="label">è›‹ç™½è´¨(g)</div></div>
                        <div class="orange-stat"><div class="value" id="orange-fat">0</div><div class="label">è„‚è‚ª(g)</div></div>
                        <div class="orange-stat"><div class="value" id="orange-weeklyLoss">0</div><div class="label">å‘¨å‡é‡ç›®æ ‡(kg)</div></div>
                        <div class="orange-stat"><div class="value" id="orange-adjustment">15</div><div class="label">ç¢³æ°´è°ƒæ•´é‡(g)</div></div>
                    </div>

                    <div class="table-wrap">
                        <table class="orange-table" id="orange-planTable">
                            <thead>
                                <tr>
                                    <th>å‘¨æ•°</th>
                                    <th>æ¯æ—¥ç¢³æ°´(g)</th>
                                    <th>æ¯æ—¥è›‹ç™½è´¨(g)</th>
                                    <th>æ¯æ—¥è„‚è‚ª(g)</th>
                                    <th>é¢„æœŸä½“é‡(kg)</th>
                                    <th>å‘¨å‡é‡ç›®æ ‡(kg)</th>
                                    <th>è°ƒæ•´è¯´æ˜</th>
                                </tr>
                            </thead>
                            <tbody id="orange-planBody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="notes">
                    <h3>ğŸ“Œ ç¢³æ°´æ¸é™è®¡åˆ’è¯´æ˜</h3>
                    <ul>
                        <li><strong>è®¡ç®—åŸºç¡€ä»£è°¢(BMR)ï¼š</strong> ä½¿ç”¨ Mifflin-St Jeor å…¬å¼è®¡ç®—</li>
                        <li><strong>è®­ç»ƒæ¶ˆè€—çƒ­é‡ï¼š</strong> è®­ç»ƒæ—¶é•¿(åˆ†é’Ÿ) Ã— å¼ºåº¦ç³»æ•°</li>
                        <li><strong>æ¯æ—¥æ€»æ¶ˆè€—(TDEE)ï¼š</strong> BMR + è®­ç»ƒæ¶ˆè€—çƒ­é‡</li>
                        <li><strong>åˆå§‹ç¢³æ°´è®¡ç®—ï¼š</strong> TDEE Ã— ç¢³æ°´æ¯”ä¾‹ Ã· 4</li>
                        <li><strong>å‘¨å‡é‡ç›®æ ‡ï¼š</strong> æ¯æœˆå‡é‡3-5%ï¼Œå¹³å‡åˆ°æ¯å‘¨</li>
                        <li><strong>ç¢³æ°´è°ƒæ•´ï¼š</strong> æ¯å‘¨å¦‚æœªè¾¾åˆ°å‡é‡ç›®æ ‡ï¼Œå‡å°‘ç¢³æ°´15-30g</li>
                        <li><strong>åœæ­¢è°ƒæ•´ï¼š</strong> å½“ç¢³æ°´é™è‡³100gå·¦å³æˆ–è¾¾åˆ°ç†æƒ³ä½“è„‚ç‡æ—¶åœæ­¢</li>
                    </ul>
                </div>
            </div>

            <!-- 3. 16+8 è½»æ–­é£Ÿ -->
            <div id="sixteen-eight" class="tab-content">
                <div class="top-row">
                    <section>
                        <h3>ç¬¬ä¸€æ­¥ï¼šè¾“å…¥åŸºç¡€ä¿¡æ¯</h3>
                        <div class="basic-row">
                            <div class="input-group"><label>å½“å‰ä½“é‡(kg)</label><input type="number" id="fast-weight" value="70" min="40" max="200"></div>
                            <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="fast-height" value="175" min="140" max="220"></div>
                            <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="fast-age" value="30" min="18" max="80"></div>
                            <div class="input-group"><label>æ€§åˆ«</label>
                                <select id="fast-gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3>ç¬¬äºŒæ­¥ï¼šé€‰æ‹©è¿›é£Ÿçª—å£</h3>
                        <div class="plan-cards">
                            <div class="plan-card selected" data-window="12-20"><h4>12:00-20:00</h4><p>æ¨èçª—å£</p></div>
                            <div class="plan-card" data-window="10-18"><h4>10:00-18:00</h4><p>æ—©åˆé¤å‹</p></div>
                            <div class="plan-card" data-window="13-21"><h4>13:00-21:00</h4><p>æ™šèµ·å‹</p></div>
                            <div class="plan-card" data-window="custom"><h4>è‡ªå®šä¹‰</h4><p>è‡ªç”±è®¾ç½®</p></div>
                        </div>
                        <div class="custom-plan" id="fast-custom-window" style="display:none;">
                            <input type="time" id="fast-start" value="12:00">
                            <span style="align-self:center;">è‡³</span>
                            <input type="time" id="fast-end" value="20:00">
                        </div>
                    </section>

                    <section>
                        <h3>ç¬¬ä¸‰æ­¥ï¼šæ—¥å¸¸æ´»åŠ¨æ°´å¹³</h3>
                        <div class="bulk-level-cards">
                            <div class="bulk-level-card selected" data-activity="1.2"><h4>ä¹…å</h4><p>åŠå…¬å®¤/å‡ ä¹æ— è¿åŠ¨</p></div>
                            <div class="bulk-level-card" data-activity="1.375"><h4>è½»åº¦æ´»è·ƒ</h4><p>æ¯å‘¨è½»åº¦1-3å¤©</p></div>
                            <div class="bulk-level-card" data-activity="1.55"><h4>ä¸­åº¦æ´»è·ƒ</h4><p>æ¯å‘¨ä¸­åº¦3-5å¤©</p></div>
                        </div>
                    </section>

                    <section>
                        <h3>æ‚¨çš„16+8è®¡åˆ’</h3>
                        <div class="quick-stats">
                            <div class="bulk-stat"><div class="value" id="fast-bmr">0</div><div class="label">åŸºç¡€ä»£è°¢</div></div>
                            <div class="bulk-stat"><div class="value" id="fast-tdee">0</div><div class="label">æ¯æ—¥æ¶ˆè€—</div></div>
                            <div class="bulk-stat"><div class="value" id="fast-calories">0</div><div class="label">å»ºè®®çƒ­é‡</div></div>
                            <div class="bulk-stat"><div class="value" id="fast-protein">0</div><div class="label">è›‹ç™½è´¨(g)</div></div>
                        </div>
                    </section>
                    <section style="margin-top: 20px;">
                        <h3>ğŸ“Š è®¡ç®—é€»è¾‘è¯¦æƒ…</h3>
                        <div id="fast-logic-box" style="padding: 12px; background: var(--primary-light); border-radius: 8px; font-size: .75rem; color: var(--text-secondary); line-height: 1.6; border: 1px solid var(--border-color);">
                            ç‚¹å‡»"è®¡ç®—è®¡åˆ’"æŒ‰é’®åï¼Œæ­¤å¤„å°†æ˜¾ç¤ºè¯¦ç»†çš„è®¡ç®—é€»è¾‘
                        </div>
                    </section>
                </div>

                <div class="btn-row">
                    <button class="btn-calc" id="fast-calculateBtn">è®¡ç®—è®¡åˆ’</button>
                    <button class="btn-down" id="fast-downloadBtn">ä¸‹è½½è®¡åˆ’</button>
                    <button class="btn-reset" id="fast-resetBtn">é‡ç½®</button>
                    <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
                </div>

                <div class="target-info">
                    <h3>ä¸€å‘¨è½»æ–­é£Ÿè®¡åˆ’<br>æŠ–éŸ³ï¼Œå¿«æ‰‹ï¼Œå¾®ä¿¡è§†é¢‘å·æœç´¢ã€Cyyå¥èº«ã€‘</h3>
                    <div class="table-wrap">
                        <table id="fast-week-table">
                            <thead>
                                <tr>
                                    <th>æ˜ŸæœŸ</th>
                                    <th>è¿›é£Ÿçª—å£</th>
                                    <th>ç¢³æ°´(g)</th>
                                    <th>è›‹ç™½è´¨(g)</th>
                                    <th>è„‚è‚ª(g)</th>
                                    <th>æ€»çƒ­é‡(kcal)</th>
                                    <th>é¤æ¬¡å®‰æ’</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>å‘¨ä¸€</td><td id="fast-mon-window">12:00-20:00</td><td id="fast-mon-carb">0</td><td id="fast-mon-protein">0</td><td id="fast-mon-fat">0</td><td id="fast-mon-calories">0</td><td class="editable">åˆé¤+æ™šé¤</td></tr>
                                <tr><td>å‘¨äºŒ</td><td id="fast-tue-window">12:00-20:00</td><td id="fast-tue-carb">0</td><td id="fast-tue-protein">0</td><td id="fast-tue-fat">0</td><td id="fast-tue-calories">0</td><td class="editable">åˆé¤+æ™šé¤</td></tr>
                                <tr><td>å‘¨ä¸‰</td><td id="fast-wed-window">12:00-20:00</td><td id="fast-wed-carb">0</td><td id="fast-wed-protein">0</td><td id="fast-wed-fat">0</td><td id="fast-wed-calories">0</td><td class="editable">åˆé¤+æ™šé¤</td></tr>
                                <tr><td>å‘¨å››</td><td id="fast-thu-window">12:00-20:00</td><td id="fast-thu-carb">0</td><td id="fast-thu-protein">0</td><td id="fast-thu-fat">0</td><td id="fast-thu-calories">0</td><td class="editable">åˆé¤+æ™šé¤</td></tr>
                                <tr><td>å‘¨äº”</td><td id="fast-fri-window">12:00-20:00</td><td id="fast-fri-carb">0</td><td id="fast-fri-protein">0</td><td id="fast-fri-fat">0</td><td id="fast-fri-calories">0</td><td class="editable">åˆé¤+æ™šé¤</td></tr>
                                <tr><td>å‘¨å…­</td><td id="fast-sat-window">12:00-20:00</td><td id="fast-sat-carb">0</td><td id="fast-sat-protein">0</td><td id="fast-sat-fat">0</td><td id="fast-sat-calories">0</td><td class="editable">åˆé¤+æ™šé¤</td></tr>
                                <tr><td>å‘¨æ—¥</td><td id="fast-sun-window">12:00-20:00</td><td id="fast-sun-carb">0</td><td id="fast-sun-protein">0</td><td id="fast-sun-fat">0</td><td id="fast-sun-calories">0</td><td class="editable">åˆé¤+æ™šé¤</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="notes">
                    <h3>ğŸ“Œ 16+8è½»æ–­é£Ÿè¯´æ˜</h3>
                    <ul>
                        <li><strong>è¿›é£Ÿçª—å£ï¼š</strong> åœ¨8å°æ—¶å†…å®Œæˆæ‰€æœ‰è¿›é£Ÿï¼Œå…¶ä½™16å°æ—¶åªå–æ°´/æ— ç³–é¥®å“</li>
                        <li><strong>çƒ­é‡æ§åˆ¶ï¼š</strong> è¿›é£Ÿçª—å£å†…ä»éœ€æ§åˆ¶æ€»çƒ­é‡ï¼Œå»ºè®®åˆ¶é€ 300-500kcalçƒ­é‡ç¼ºå£</li>
                        <li><strong>è›‹ç™½è´¨ä¼˜å…ˆï¼š</strong> ç¡®ä¿æ‘„å…¥è¶³å¤Ÿè›‹ç™½è´¨ï¼Œé˜²æ­¢è‚Œè‚‰æµå¤±</li>
                        <li><strong>æ°´åˆ†è¡¥å……ï¼š</strong> ç¦é£ŸæœŸé—´å¤šå–æ°´ï¼Œæœ‰åŠ©äºæ§åˆ¶é¥¥é¥¿æ„Ÿ</li>
                        <li><strong>é€‚åº”æœŸï¼š</strong> å‰3-7å¤©ä¸ºé€‚åº”æœŸï¼Œå¯èƒ½å‡ºç°è½»å¾®ä¸é€‚ï¼Œå±æ­£å¸¸ç°è±¡</li>
                        <li><strong>ä¸é€‚åˆäººç¾¤ï¼š</strong> å­•å¦‡ã€å“ºä¹³æœŸã€æœ‰è¿›é£Ÿéšœç¢å²ã€ç³–å°¿ç—…æ‚£è€…æ…ç”¨</li>
                    </ul>
                </div>
            </div>

            <!-- 4. å¢è‚Œè®¡åˆ’ -->
            <div id="bulk-plan" class="tab-content">
                <div class="top-row">
                    <section>
                        <h3>ç¬¬ä¸€æ­¥ï¼šåŸºç¡€ä¿¡æ¯</h3>
                        <div class="basic-row">
                            <div class="input-group"><label>ä½“é‡(kg)</label><input type="number" id="bulk-weight" value="70" min="40" max="150"></div>
                            <div class="input-group"><label>èº«é«˜(cm)</label><input type="number" id="bulk-height" value="175" min="140" max="220"></div>
                            <div class="input-group"><label>å¹´é¾„(å²)</label><input type="number" id="bulk-age" value="25" min="18" max="60"></div>
                            <div class="input-group"><label>æ€§åˆ«</label>
                                <select id="bulk-gender"><option value="male">ç”·</option><option value="female">å¥³</option></select>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3>ç¬¬äºŒæ­¥ï¼šæ—¥å¸¸æ´»åŠ¨å¼ºåº¦</h3>
                        <div class="bulk-level-cards" id="pal-cards">
                            <div class="bulk-level-card selected" data-pal="1.2"><h4>ä¹…å</h4><p>åŠå…¬å®¤/å‡ ä¹æ— è¿åŠ¨</p></div>
                            <div class="bulk-level-card" data-pal="1.375"><h4>è½»åº¦æ´»è·ƒ</h4><p>æ¯å‘¨è½»åº¦1-3å¤©</p></div>
                            <div class="bulk-level-card" data-pal="1.55"><h4>ä¸­åº¦æ´»è·ƒ</h4><p>æ¯å‘¨ä¸­åº¦3-5å¤©</p></div>
                            <div class="bulk-level-card" data-pal="1.725"><h4>éå¸¸æ´»è·ƒ</h4><p>æ¯å‘¨é«˜å¼ºåº¦6-7å¤©</p></div>
                            <div class="bulk-level-card" data-pal="1.9"><h4>èŒä¸šè¿åŠ¨å‘˜</h4><p>æ¯å¤©é«˜å¼ºåº¦</p></div>
                        </div>
                    </section>

                    <section>
                        <h3>ç¬¬ä¸‰æ­¥ï¼šè®­ç»ƒç»éªŒ</h3>
                        <div class="bulk-level-cards" id="exp-cards">
                            <div class="bulk-level-card selected" data-exp="novice"><h4>æ–°æ‰‹</h4><p>ç³»ç»Ÿè®­ç»ƒ &lt;1 å¹´</p></div>
                            <div class="bulk-level-card" data-exp="intermediate"><h4>ä¸­çº§</h4><p>ç³»ç»Ÿè®­ç»ƒ 1-3 å¹´</p></div>
                            <div class="bulk-level-card" data-exp="advanced"><h4>é«˜çº§</h4><p>ç³»ç»Ÿè®­ç»ƒ &gt;3 å¹´</p></div>
                        </div>
                    </section>

                    <section>
                        <h3>ç¬¬å››æ­¥ï¼šçƒ­é‡ç›ˆä½™</h3>
                        <div class="bulk-level-cards" id="surplus-cards">
                            <div class="bulk-level-card selected" data-surplus="200"><h4>å¹²å‡€å¢è‚Œ(æ¨è)</h4><p>+200 kcal/æ—¥</p></div>
                            <div class="bulk-level-card" data-surplus="350"><h4>ä¸€èˆ¬å¢è‚Œ(ä¸¥æ ¼è®­ç»ƒ)</h4><p>+350 kcal/æ—¥</p></div>
                            <div class="bulk-level-card" data-surplus="550"><h4>ç˜¦å­è„å¢è‚Œ(æ’éª¨ç²¾é¦–é€‰)</h4><p>+550 kcal/æ—¥</p></div>
                        </div>
                    </section>

                    <section>
                        <h3>ç¬¬äº”æ­¥ï¼šé€‰æ‹©è®­ç»ƒè®¡åˆ’ æŠ–éŸ³ï¼Œå¿«æ‰‹ï¼Œå¾®ä¿¡è§†é¢‘å·æœç´¢ã€Cyyå¥èº«ã€‘</h3>
                        <div class="plan-cards" id="bulk-plan-cards">
                            <div class="plan-card selected" data-plan="1"><h4>ç»ƒ1ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="2"><h4>ç»ƒ2ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="3"><h4>ç»ƒ3ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="4"><h4>ç»ƒ4ä¼‘1</h4><p>å¾ªç¯</p></div>
                            <div class="plan-card" data-plan="custom"><h4>è‡ªå®šä¹‰</h4><p>è‡ªç”±</p></div>
                        </div>
                        <div class="custom-plan" id="bulk-custom-plan">
                            <input placeholder="å‘¨ä¸€" id="bulk-cus-mon"><input placeholder="å‘¨äºŒ" id="bulk-cus-tue"><input placeholder="å‘¨ä¸‰" id="bulk-cus-wed">
                            <input placeholder="å‘¨å››" id="bulk-cus-thu"><input placeholder="å‘¨äº”" id="bulk-cus-fri"><input placeholder="å‘¨å…­" id="bulk-cus-sat"><input placeholder="å‘¨æ—¥" id="bulk-cus-sun">
                        </div>
                    </section>

                    <section>
                        <h3>è®¡ç®—ç»“æœ </h3>
                        <div class="bulk-stats">
                            <div class="bulk-stat"><div class="value" id="bulk-bmr">0</div><div class="label">åŸºç¡€ä»£è°¢(BMR)</div></div>
                            <div class="bulk-stat"><div class="value" id="bulk-tdee">0</div><div class="label">æ¯æ—¥æ¶ˆè€—(TDEE)</div></div>
                            <div class="bulk-stat"><div class="value" id="bulk-target">0</div><div class="label">è®­ç»ƒæ—¥æ‘„å…¥çƒ­é‡</div></div>
                            <div class="bulk-stat"><div class="value" id="bulk-protein">0</div><div class="label">æ¯æ—¥æ‘„å…¥è›‹ç™½è´¨(g)</div></div>
                            <div class="bulk-stat"><div class="value" id="bulk-carb-display">0</div><div class="label">è®­ç»ƒæ—¥ç¢³æ°´(g)</div></div>
                            <div class="bulk-stat"><div class="value" id="bulk-rest-carb-display">0</div><div class="label">ä¼‘æ¯æ—¥ç¢³æ°´(g)</div></div>
                            <div class="bulk-stat"><div class="value" id="bulk-fat-display">0</div><div class="label">æ¯æ—¥è„‚è‚ª(g)</div></div>
                            <div class="bulk-stat"><div class="value" id="bulk-weekly-gain">â€”</div><div class="label">é¢„è®¡æ¯å‘¨å¢é‡(kg)</div></div>
                        </div>
                        <div id="bulk-logic-box"></div>
                    </section>
                </div>

                <div class="btn-row">
                    <button class="btn-calc" id="bulk-calc">è®¡ç®—è®¡åˆ’</button>
                    <button class="btn-down" id="bulk-dl">ä¸‹è½½Excel(ç”µè„‘ç«¯)</button>
                    <button class="btn-reset" id="bulk-reset">é‡ç½®</button>
                    <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
                </div>

                <div class="table-wrap">
                    <table id="bulk-week-table">
                        <thead><tr><th>é¡¹ç›®</th><th>ä¸€</th><th>äºŒ</th><th>ä¸‰</th><th>å››</th><th>äº”</th><th>å…­</th><th>æ—¥</th></tr></thead>
                        <tbody>
                            <tr class="band"><td>è®­ç»ƒéƒ¨ä½<br>(å¯åŒå‡»è‡ªå®šä¹‰)</td><td class="editable"></td><td class="editable"></td><td class="editable"></td><td class="editable"></td><td class="editable"></td><td class="editable"></td><td class="editable"></td></tr>
                            <tr class="band"><td>ç¢³æ°´(g)</td><td id="bulk-carb-0"></td><td id="bulk-carb-1"></td><td id="bulk-carb-2"></td><td id="bulk-carb-3"></td><td id="bulk-carb-4"></td><td id="bulk-carb-5"></td><td id="bulk-carb-6"></td></tr>
                            <tr class="band"><td>è›‹ç™½è´¨(g)</td><td id="bulk-pro-0"></td><td id="bulk-pro-1"></td><td id="bulk-pro-2"></td><td id="bulk-pro-3"></td><td id="bulk-pro-4"></td><td id="bulk-pro-5"></td><td id="bulk-pro-6"></td></tr>
                            <tr class="band"><td>è„‚è‚ª(g)</td><td id="bulk-fat-0"></td><td id="bulk-fat-1"></td><td id="bulk-fat-2"></td><td id="bulk-fat-3"></td><td id="bulk-fat-4"></td><td id="bulk-fat-5"></td><td id="bulk-fat-6"></td></tr>
                            <tr class="band"><td>çƒ­é‡(kcal)</td><td id="bulk-cal-0"></td><td id="bulk-cal-1"></td><td id="bulk-cal-2"></td><td id="bulk-cal-3"></td><td id="bulk-cal-4"></td><td id="bulk-cal-5"></td><td id="bulk-cal-6"></td></tr>
                            <tr class="band"><td>ç›ˆä½™/ç¼ºå£</td><td id="bulk-diff-0"></td><td id="bulk-diff-1"></td><td id="bulk-diff-2"></td><td id="bulk-diff-3"></td><td id="bulk-diff-4"></td><td id="bulk-diff-5"></td><td id="bulk-diff-6"></td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="notes">
                    <h3>ğŸ“Œ å¢è‚Œè®¡åˆ’è¯´æ˜</h3>
                    <ul>
                        <li>è›‹ç™½è´¨æŒ‰è®­ç»ƒç»éªŒåˆ†çº§ï¼šæ–°æ‰‹ 1.6 g/kgã€ä¸­çº§ 1.8 g/kgã€é«˜çº§ 2 g/kgã€‚</li>
                        <li>è„‚è‚ªæŒ‰è®­ç»ƒç»éªŒåˆ†çº§ï¼šæ–°æ‰‹ 0.9 g/kgã€ä¸­çº§ 1.0g/kgã€é«˜çº§ 1.2 g/kgã€‚</li>
                        <li>ç¢³æ°´æŒ‰è®­ç»ƒç»éªŒåˆ†çº§ï¼šæ–°æ‰‹ 3.5 g/kgã€ä¸­çº§ 4.5g/kgã€é«˜çº§ 5 g/kgã€‚</li>
                        <li>å‰©ä½™çƒ­é‡å…¨éƒ¨ç»™ç¢³æ°´ï¼Œä¼‘æ¯æ—¥ -15% ç¢³æ°´ã€‚</li>
                    </ul>
                </div>
            </div>

            <!-- 5. é¥®æ°´å»ºè®® (æ–°å¢) -->
            <div id="water-plan" class="tab-content">
                <div class="top-row">
                    <section>
                        <h3>1. è®¡ç®—å‚æ•°</h3>
                        <div class="basic-row">
                            <div class="input-group">
                                <label>ä½“é‡ (kg)</label>
                                <input type="number" id="water-weight" value="70">
                            </div>
                            <div class="input-group">
                                <label>å½“æ—¥è¿åŠ¨æ—¶é•¿ (åˆ†é’Ÿ)</label>
                                <input type="number" id="water-exercise" value="60">
                            </div>
                            <div class="input-group">
                                <label>å‡ºæ±—ç¨‹åº¦</label>
                                <select id="water-sweat">
                                    <option value="low">å°‘æ±—/ç©ºè°ƒæˆ¿</option>
                                    <option value="medium" selected>æ­£å¸¸/å¾®æ±—</option>
                                    <option value="high">å¤§é‡/æš´æ±—</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3>2. ç§‘å­¦è¡¥æ°´æ–¹æ¡ˆ</h3>
                        <div class="water-stats">
                            <div class="water-stat">
                                <div class="value" id="water-total">0</div>
                                <div class="label">ä»Šæ—¥æ€»ç›®æ ‡ (ml)</div>
                            </div>
                            <div class="water-stat">
                                <div class="value" id="water-base">0</div>
                                <div class="label">åŸºç¡€éœ€æ±‚ (ml)</div>
                            </div>
                            <div class="water-stat">
                                <div class="value" id="water-extra">0</div>
                                <div class="label">è¿åŠ¨è¡¥å¿ (ml)</div>
                            </div>
                        </div>

                        <h4 style="margin-top:20px; color:var(--primary); font-size:0.95rem;">é»„é‡‘è¡¥æ°´æ—¶åˆ»è¡¨</h4>
                        <div class="table-wrap">
                            <table id="water-schedule-table">
                                <thead>
                                    <tr><th>æ—¶é—´æ®µ</th><th>å»ºè®®é¥®æ°´é‡</th><th>ä½œç”¨</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>æ™¨èµ·ç©ºè…¹</td><td id="water-morning">300-500ml</td><td>æ¿€æ´»ä»£è°¢ï¼Œè¡¥å……ç¡çœ æµå¤±</td></tr>
                                    <tr><td>é¤å‰30åˆ†</td><td id="water-meal">300ml</td><td>å¢åŠ é¥±è…¹æ„Ÿï¼Œè¾…åŠ©æ¶ˆåŒ–</td></tr>
                                    <tr><td>ç»ƒå‰1å°æ—¶</td><td id="water-pre">400ml</td><td>é¢„å…ˆè¡¥æ°´ï¼Œæå‡è¿åŠ¨è¡¨ç°</td></tr>
                                    <tr><td>è®­ç»ƒä¸­</td><td id="water-during">æ¯15åˆ†é’Ÿ150ml</td><td>é˜²æ­¢è„±æ°´ï¼Œç»´æŒä½“æ¸©</td></tr>
                                    <tr><td>ç»ƒå</td><td id="water-post">500ml+</td><td>æ¢å¤ä½“æ¶²å¹³è¡¡ï¼Œä¿ƒè¿›åˆæˆ</td></tr>
                                    <tr><td>å…¨å¤©å…¶ä»–</td><td>å°‘é‡å¤šæ¬¡</td><td>ä¿æŒæŒç»­æ°´åˆçŠ¶æ€</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </section>
                </div>

                <div class="btn-row">
                    <button class="btn-calc" id="water-calculateBtn">è®¡ç®—ç›®æ ‡</button>
                    <button class="btn-reset" id="water-resetBtn">é‡ç½®</button>
                    <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
                </div>

                <div class="notes">
                    <h3>ğŸ“Œ é¥®æ°´å»ºè®®è¯´æ˜</h3>
                    <ul>
                        <li><strong>è®¡ç®—å…¬å¼ï¼š</strong> æ€»æ°´é‡ = (ä½“é‡kg Ã— 35ml) + (è¿åŠ¨åˆ†é’Ÿ Ã· 30 Ã— å‡ºæ±—ç³»æ•°)ã€‚</li>
                        <li><strong>å‡ºæ±—ç³»æ•°ï¼š</strong> å°‘æ±—=250mlï¼Œæ­£å¸¸=350mlï¼Œæš´æ±—=500ml (æ¯30åˆ†é’Ÿ)ã€‚</li>
                        <li><strong>ä¸è¦ç­‰å£æ¸´ï¼š</strong> å£æ¸´æ—¶èº«ä½“å·²è„±æ°´çº¦2%ï¼Œè¿åŠ¨è¡¨ç°ä¼šä¸‹é™10%ä»¥ä¸Šã€‚</li>
                        <li><strong>è§‚å¯Ÿå°¿æ¶²ï¼š</strong> å°¿æ¶²åº”å‘ˆæ·¡é»„è‰²ã€‚è‹¥æ·±é»„åˆ™ä¸¥é‡ç¼ºæ°´ï¼Œè‹¥é€æ˜åˆ™å¯èƒ½æ°´ä¸­æ¯’ï¼ˆç”µè§£è´¨å¤±è¡¡ï¼‰ã€‚</li>
                    </ul>
                </div>
            </div>

            <!-- 6. å¿ƒç‡è®¡ç®— (æ–°å¢) -->
            <div id="heart-rate" class="tab-content">
                <div class="top-row">
                    <section>
                        <h3>1. ä¸ªäººæ•°æ® (Karvonenå…¬å¼)</h3>
                        <div class="basic-row">
                            <div class="input-group">
                                <label>å¹´é¾„ (å²)</label>
                                <input type="number" id="hr-age" value="30">
                            </div>
                            <div class="input-group">
                                <label>é™æ¯å¿ƒç‡ (BPM)</label>
                                <input type="number" id="hr-rest" value="65" placeholder="æ™¨èµ·é™å§æµ‹é‡">
                            </div>
                        </div>
                        <p style="font-size:0.75rem; color:var(--text-muted); margin-top:8px;">*é™æ¯å¿ƒç‡è¶Šä½ï¼Œä»£è¡¨å¿ƒè‚ºåŠŸèƒ½è¶Šå¼ºã€‚è‹¥ä¸æ¸…æ¥šï¼Œå»ºè®®æ™¨èµ·æµ‹é‡æˆ–ä½¿ç”¨æ‰‹ç¯æ•°æ®ã€‚</p>
                    </section>

                    <section>
                        <h3>2. æ‚¨çš„å¿ƒç‡åŒºé—´</h3>
                        <div class="water-stats" style="margin-bottom:20px;">
                            <div class="water-stat">
                                <div class="value" id="hr-max">0</div>
                                <div class="label">æœ€å¤§å¿ƒç‡</div>
                            </div>
                            <div class="water-stat">
                                <div class="value" id="hr-reserve">0</div>
                                <div class="label">å‚¨å¤‡å¿ƒç‡</div>
                            </div>
                        </div>

                        <div id="hr-zones-container">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </section>
                </div>

                <div class="btn-row">
                    <button class="btn-calc" id="hr-calculateBtn">è®¡ç®—åŒºé—´</button>
                    <button class="btn-reset" id="hr-resetBtn">é‡ç½®</button>
                    <button class="btn-back" onclick="backToHome()">è¿”å›é¦–é¡µ</button>
                </div>

                <div class="notes">
                    <h3>ğŸ“Œ å¿ƒç‡åŒºé—´è¯´æ˜</h3>
                    <ul>
                        <li><strong>è®¡ç®—å…¬å¼ (Karvonen)ï¼š</strong> ç›®æ ‡å¿ƒç‡ = ((æœ€å¤§å¿ƒç‡ - é™æ¯å¿ƒç‡) Ã— å¼ºåº¦%) + é™æ¯å¿ƒç‡ã€‚</li>
                        <li><strong>æœ€å¤§å¿ƒç‡ï¼š</strong> 220 - å¹´é¾„ã€‚</li>
                        <li><strong>çƒ­èº«æ”¾æ¾ (50-60%)ï¼š</strong> é€‚åˆè¿åŠ¨å‰çƒ­èº«æˆ–æ¢å¤ã€‚</li>
                        <li><strong>ç‡ƒè„‚æ§é‡ (60-70%)ï¼š</strong> è„‚è‚ªä¾›èƒ½æ¯”ä¾‹æœ€é«˜ï¼Œé€‚åˆå‡è„‚äººç¾¤ã€‚</li>
                        <li><strong>æœ‰æ°§è€åŠ› (70-80%)ï¼š</strong> æå‡å¿ƒè‚ºåŠŸèƒ½ï¼Œå¿ƒè¡€ç®¡å¥åº·çš„æ ¸å¿ƒåŒºé—´ã€‚</li>
                        <li><strong>æ— æ°§è€åŠ› (80-90%)ï¼š</strong> æé«˜ä¹³é…¸é˜ˆå€¼ï¼Œé€‚åˆé«˜å¼ºåº¦é—´æ­‡è®­ç»ƒ (HIIT)ã€‚</li>
                        <li><strong>æé™å†²åˆº (90-100%)ï¼š</strong> æåº¦ç–²åŠ³ï¼Œä»…é€‚åˆä¸“ä¸šè¿åŠ¨å‘˜çŸ­æ—¶é—´å†²åˆºã€‚</li>
                    </ul>
                </div>
            </div>

            <footer>Cyyå¥èº«è¥å…»æ™ºèƒ½å·¥å…·Â© 2025 Â· Cyyå¥èº«</footer>
        </div>
    </div>

    <div id="copyright-bar">
      Â© 2025 Cyyå¥èº« | ä»…é™ä¸ªäººä½¿ç”¨ | ç¦æ­¢è½¬è½½ã€å•†ç”¨ | è¿è€…å¿…ç©¶
    </div>

    <script>
        const $ = id => document.getElementById(id);

        /* ================= Theme Toggle ================= */
        // Use class selector to handle buttons on both Home and Inner pages
        const themeToggles = document.querySelectorAll('.theme-toggle-btn');
        
        // Check local storage or system preference
        const savedTheme = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggles.forEach(btn => btn.innerHTML = 'â˜€ï¸');
            } else {
                document.documentElement.removeAttribute('data-theme');
                themeToggles.forEach(btn => btn.innerHTML = 'ğŸŒ™');
            }
        }

        // Initialize
        if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
            applyTheme('dark');
        } else {
            applyTheme('light');
        }

        themeToggles.forEach(btn => {
            btn.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                applyTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });
        });

        /* ================= å¯¼èˆªé€»è¾‘ ================= */
        function selectTool(tool) {
            $('home-page').style.display = 'none';
            $('kings-cycle-tool').style.display = 'block';
            
            // è§¦å‘å¯¹åº”çš„ tab ç‚¹å‡»
            const tabBtn = document.querySelector(`.tab-btn[data-tab="${tool}"]`);
            if(tabBtn) tabBtn.click();
            window.scrollTo(0,0);
        }

        function backToHome() {
            $('kings-cycle-tool').style.display = 'none';
            $('home-page').style.display = 'block';
            window.scrollTo(0,0);
        }

        // Tab åˆ‡æ¢
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                $(btn.dataset.tab).classList.add('active');

                // è‡ªåŠ¨è§¦å‘è®¡ç®—
                if(btn.dataset.tab === 'kings-cycle') calcKingsCycle();
                if(btn.dataset.tab === 'orange-carb') calcOrangeCarb();
                if(btn.dataset.tab === 'sixteen-eight') calculateFast();
                if(btn.dataset.tab === 'bulk-plan') calcBulk();
                if(btn.dataset.tab === 'water-plan') calcWater();
                if(btn.dataset.tab === 'heart-rate') calcHeartRate();
            });
        });

        /* ================= è¾…åŠ©åŠŸèƒ½ ================= */
        function toggleBodyFatImage() {
            const container = $('bodyfat-container');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        }

        function toggleBodyTypeRef() {
            const box = $('bodytype-ref');
            box.style.display = box.style.display === 'none' ? 'block' : 'none';
        }

        // åŒå‡»ç¼–è¾‘å•å…ƒæ ¼
        document.addEventListener('dblclick', function(e) {
            if(e.target.classList.contains('editable')) {
                const cell = e.target;
                const oldVal = cell.innerText;
                cell.innerHTML = `<input type="text" value="${oldVal}" style="width:100%; box-sizing:border-box; padding:4px;">`;
                const input = cell.querySelector('input');
                input.focus();
                input.onblur = input.onkeydown = (ev) => {
                    if(ev.type === 'blur' || ev.key === 'Enter') {
                        cell.innerText = input.value || oldVal;
                    }
                }
            }
        });

        /* ================= å‡¯åœ£ç‹ç¢³å¾ªç¯ ================= */
        // èƒšå‹é€‰æ‹©
        document.querySelectorAll('.body-type-card').forEach(c => {
            c.addEventListener('click', () => {
                const group = c.closest('.body-type-cards');
                group.querySelectorAll('.body-type-card').forEach(x => x.classList.remove('selected'));
                c.classList.add('selected');
                const type = c.dataset.type;
                const map = {ectomorph:{c:3,p:1.3,f:1.1}, mesomorph:{c:2.5,p:1.3,f:0.9}, endomorph:{c:2,p:1.3,f:0.8}};
                // Only update inputs if inputs exist on this page
                if($('carbsPerKg')) {
                    $('carbsPerKg').value = map[type].c;
                    $('proteinPerKg').value = map[type].p;
                    $('fatPerKg').value = map[type].f;
                    calcKingsCycle();
                }
            });
        });

        // è®­ç»ƒè®¡åˆ’é€‰æ‹©
        document.querySelectorAll('#kings-cycle .plan-card').forEach(c => {
            c.addEventListener('click', () => {
                document.querySelectorAll('#kings-cycle .plan-card').forEach(x => x.classList.remove('selected'));
                c.classList.add('selected');
                $('customPlan').style.display = c.dataset.plan === 'custom' ? 'flex' : 'none';
                calcKingsCycle();
            });
        });

        // ç›®æ ‡ä½“é‡å¾®è°ƒ
        function adjustTarget(delta) {
            const el = $('targetWeight');
            const currentW = +$('weight').value;
            let val = +el.value + delta;
            val = Math.max(currentW - 5, Math.min(currentW + 5, val));
            el.value = val;
            calcKingsCycle();
        }

        // ç¢³å¾ªç¯æ ¸å¿ƒé€»è¾‘
        function buildParts(plan) {
            switch(plan){
                case '1': return ['ä¼‘æ¯','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','ä¼‘æ¯'];
                case '2': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´'];
                case '3': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©'];
                case '4': return ['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','è…¿+è‚©'];
                case 'custom': return ['mon','tue','wed','thu','fri','sat','sun'].map(d=>$(`cus-${d}`).value.trim()||'ä¼‘æ¯');
                default: return [];
            }
        }

        window.carb28 = []; // å…¨å±€å­˜å‚¨ä»¥ä¾¿å¯¼å‡º

        function calcKingsCycle() {
            const w = +$('weight').value, h = +$('height').value, a = +$('age').value, g = $('gender').value;
            const targetW = +$('targetWeight').value;
            if(!w || !targetW) return;

            const cp = +$('carbsPerKg').value, pp = +$('proteinPerKg').value, fp = +$('fatPerKg').value;
            const plan = document.querySelector('#kings-cycle .plan-card.selected').dataset.plan;

            const bmr = g === 'male' ? 10*w + 6.25*h - 5*a + 5 : 10*w + 6.25*h - 5*a - 161;
            const tdee = Math.round(bmr + 500); // ä¼°ç®—TDEE
            
            const pro = Math.round(pp * targetW);
            const weekC = Math.round(cp * targetW * 7);
            const weekF = Math.round(fp * targetW * 7);

            // ç¢³æ°´åˆ†å¸ƒ
            const hc = Math.round(weekC * 0.5 / 2); // 2å¤©é«˜ç¢³
            const mc = Math.round(weekC * 0.35 / 3); // 3å¤©ä¸­ç¢³
            const lc = Math.round(weekC * 0.15 / 2); // 2å¤©ä½ç¢³

            // è„‚è‚ªåˆ†å¸ƒ (ä¸ç¢³æ°´ç›¸å)
            const hf = Math.round(weekF * 0.15 / 2);
            const mf = Math.round(weekF * 0.35 / 3);
            const lf = Math.round(weekF * 0.50 / 2);

            $('bmrValue').textContent = Math.round(bmr);
            $('tdeeValue').textContent = tdee;
            $('proteinValue').textContent = pro;
            $('carbsValue').textContent = weekC;

            // ç”Ÿæˆ28å¤©è®¡åˆ’
            const partsOneWeek = buildParts(plan);
            const parts28 = [];
            for(let i=0; i<28; i++) parts28.push(partsOneWeek[i%7]);
            
            // ç¢³æ°´å¾ªç¯æ¨¡å¼ç¡¬ç¼–ç 
            const carbPatternMap = {
                '1': ['é«˜','ä½','ä¸­','ä½','é«˜','ä¸­','ä¸­', 'ä½','ä¸­','ä¸­','é«˜','ä¸­','é«˜','ä½', 'ä¸­','ä½','é«˜','ä¸­','é«˜','ä½','ä¸­', 'ä½','é«˜','ä¸­','é«˜','ä½','ä¸­','ä¸­'],
                '2': ['é«˜','ä¸­','ä½','é«˜','ä¸­','ä½','ä¸­', 'é«˜','ä½','ä¸­','ä¸­','ä½','é«˜','ä¸­', 'ä½','ä¸­','é«˜','ä½','é«˜','ä¸­','ä¸­', 'é«˜','ä¸­','ä½','ä¸­','é«˜','ä½','ä¸­'],
                '3': ['ä¸­','ä½','é«˜','ä½','ä¸­','ä¸­','é«˜', 'ä½','é«˜','ä¸­','é«˜','ä½','ä¸­','ä¸­', 'é«˜','ä½','ä¸­','ä¸­','é«˜','ä½','ä¸­', 'ä¸­','é«˜','ä½','ä¸­','ä¸­','é«˜','ä½'],
                '4': ['ä¸­','ä½','é«˜','ä¸­','ä½','ä¸­','é«˜', 'ä¸­','ä¸­','ä½','é«˜','ä¸­','ä½','é«˜', 'ä½','é«˜','ä¸­','é«˜','ä¸­','ä½','ä¸­', 'é«˜','ä¸­','ä¸­','ä½','é«˜','ä¸­','ä½']
            };
            
            window.carb28 = plan === 'custom' 
                ? Array(4).fill(['ä¸­','é«˜','ä½','ä¸­','ä½','é«˜','ä¸­']).flat() // è‡ªå®šä¹‰é»˜è®¤
                : (carbPatternMap[plan] || carbPatternMap['1']);

            // å¡«å……éšè—çš„ planTable ç”¨äºæ•°æ®æŠ“å–å’Œè®¡ç®—
            const dayRow = $('dayRow');
            const carbLevelRow = $('carbLevelRow');
            dayRow.innerHTML = '<th rowspan="2">é¡¹ç›®</th>';
            carbLevelRow.innerHTML = '';
            
            const weekDays = ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'];
            for(let i=0; i<28; i++) {
                dayRow.insertAdjacentHTML('beforeend', `<th>${weekDays[i%7]}</th>`);
                carbLevelRow.insertAdjacentHTML('beforeend', `<th>${window.carb28[i]}</th>`);
            }

            // å¡«å……éšè—è¡¨æ ¼æ•°æ®
            const tbody = document.querySelector('#planTable tbody');
            tbody.innerHTML = ''; // Clear
            
            // æ„å»ºè¡Œæ•°æ®
            const rowParts = ['è®­ç»ƒéƒ¨ä½'];
            const rowCarbs = ['ç¢³æ°´(g)'];
            const rowPro = ['è›‹ç™½è´¨(g)'];
            const rowFat = ['è„‚è‚ª(g)'];
            const rowCal = ['çƒ­é‡(kcal)'];
            const rowDiff = ['ç¼ºå£/ç›ˆä½™'];

            let totalDiff = 0;

            for(let i=0; i<28; i++) {
                const lvl = window.carb28[i];
                const cVal = lvl==='é«˜'?hc:(lvl==='ä¸­'?mc:lc);
                const fVal = lvl==='é«˜'?hf:(lvl==='ä¸­'?mf:lf);
                const cal = cVal*4 + pro*4 + fVal*9;
                const diff = cal - tdee;
                totalDiff += diff;

                rowParts.push(parts28[i]);
                rowCarbs.push(cVal);
                rowPro.push(pro);
                rowFat.push(fVal);
                rowCal.push(cal);
                rowDiff.push(diff);
            }

            const buildTr = (arr) => `<tr><td>${arr[0]}</td>${arr.slice(1).map(v => `<td>${v}</td>`).join('')}</tr>`;
            tbody.innerHTML += buildTr(rowParts);
            tbody.innerHTML += buildTr(rowCarbs);
            tbody.innerHTML += buildTr(rowPro);
            tbody.innerHTML += buildTr(rowFat);
            tbody.innerHTML += buildTr(rowCal);
            
            // ç›ˆä½™è¡Œç‰¹æ®Šå¤„ç†é¢œè‰²
            let diffHtml = `<tr><td>ç¼ºå£/ç›ˆä½™</td>`;
            for(let i=1; i<rowDiff.length; i++) {
                const v = rowDiff[i];
                const color = v > 0 ? '#10b981' : '#f43f5e';
                diffHtml += `<td style="color:${color}">${v>0?'+':''}${v}</td>`;
            }
            diffHtml += `</tr>`;
            tbody.innerHTML += diffHtml;

            // æ›´æ–°ç›®æ ‡åˆ†æ
            const avgWeeklyDiff = Math.round(totalDiff / 4);
            const weightDiff = targetW - w;
            $('weightDiffValue').textContent = weightDiff > 0 ? `+${weightDiff}` : weightDiff;
            $('weeklyCalorieDiffValue').textContent = avgWeeklyDiff > 0 ? `+${avgWeeklyDiff}` : avgWeeklyDiff;
            
            let days = 0;
            if((weightDiff < 0 && avgWeeklyDiff < 0) || (weightDiff > 0 && avgWeeklyDiff > 0)) {
                days = Math.abs(Math.round((weightDiff * 7700) / (avgWeeklyDiff/7)));
                const d = new Date(); d.setDate(d.getDate() + days);
                $('targetDate').textContent = d.toLocaleDateString();
            } else {
                $('targetDate').textContent = "æ–¹å‘ä¸ç¬¦";
            }
            $('daysNeededValue').textContent = days || '-';

            renderWeekTables(); // æ¸²æŸ“å¯è§†åŒ–çš„ç«–å‘è¡¨
        }

        function renderWeekTables() {
            const container = $('weekTables');
            container.innerHTML = '';
            
            const weekDays = ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'];
            // ä»éšè—è¡¨æŠ“å–æ•°æ®
            const trs = document.querySelectorAll('#planTable tbody tr');
            
            // 4å‘¨å¾ªç¯
            for(let w=0; w<4; w++) {
                let html = `<div class="week-table"><table><thead><tr><th>ç¬¬ ${w+1} å‘¨</th>`;
                weekDays.forEach(d => html += `<th>${d}</th>`);
                html += `</tr><tr><th>ç¢³æ—¥</th>`;
                
                for(let d=0; d<7; d++) {
                    const idx = w*7 + d;
                    const lvl = window.carb28[idx];
                    const cls = lvl === 'é«˜' ? 'high' : (lvl === 'ä¸­' ? 'med' : 'low');
                    html += `<th class="${cls}">${lvl}</th>`;
                }
                html += `</tr></thead><tbody>`;

                trs.forEach(tr => {
                    const tds = Array.from(tr.querySelectorAll('td'));
                    const title = tds[0].innerText.split('\n')[0]; // remove extra text
                    html += `<tr><td>${title}</td>`;
                    for(let d=0; d<7; d++) {
                        html += `<td>${tds[w*7 + d + 1].innerHTML}</td>`;
                    }
                    html += `</tr>`;
                });
                
                html += `</tbody></table></div>`;
                container.innerHTML += html;
            }
        }

        function dlKingsCycle() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.table_to_sheet($('planTable'));
            XLSX.utils.book_append_sheet(wb, ws, "ç¢³å¾ªç¯è®¡åˆ’");
            XLSX.writeFile(wb, "å‡¯åœ£ç‹ç¢³å¾ªç¯è®¡åˆ’.xlsx");
        }

        $('calculateBtn').addEventListener('click', calcKingsCycle);
        $('downloadBtn').addEventListener('click', dlKingsCycle);
        $('resetBtn').addEventListener('click', () => { $('weight').value=75; calcKingsCycle(); });

        /* ================= æ©™å­ç¢³æ°´æ¸é™ ================= */
        const orangeRatioCards = document.querySelectorAll('.orange-ratio-card');
        orangeRatioCards.forEach(c => c.addEventListener('click', () => {
            orangeRatioCards.forEach(x => x.classList.remove('selected'));
            c.classList.add('selected');
            $('custom-ratio-inputs').style.display = c.dataset.ratio === 'custom' ? 'flex' : 'none';
            calcOrangeCarb();
        }));

        $('weight-loss-percent').addEventListener('input', (e) => {
            $('weight-loss-value').textContent = e.target.value + '%';
            calcOrangeCarb();
        });

        function calcOrangeCarb() {
            const w = +$('orange-weight').value;
            const h = +$('orange-height').value;
            const a = +$('orange-age').value;
            const g = $('orange-gender').value;
            const intensity = +$('train-intensity').value;
            const trainTime = +$('train-time').value;
            
            const bmr = g === 'male' ? 10*w + 6.25*h - 5*a + 5 : 10*w + 6.25*h - 5*a - 161;
            const trainCal = trainTime * intensity;
            const tdee = Math.round(bmr + trainCal);

            let cRatio = 0.5, pRatio = 0.3, fRatio = 0.2;
            const ratioType = document.querySelector('.orange-ratio-card.selected').dataset.ratio;
            
            if(ratioType === '442') { cRatio = 0.4; pRatio = 0.4; }
            if(ratioType === 'custom') {
                cRatio = +$('custom-carb').value / 100;
                pRatio = +$('custom-protein').value / 100;
                fRatio = +$('custom-fat').value / 100;
                $('ratio-sum').textContent = `æ€»å’Œ: ${Math.round((cRatio+pRatio+fRatio)*100)}%`;
                $('ratio-sum').style.color = Math.abs(cRatio+pRatio+fRatio - 1) < 0.01 ? 'var(--text-secondary)' : 'var(--danger)';
            }

            const initCarb = Math.round(tdee * cRatio / 4);
            const pro = Math.round(tdee * pRatio / 4);
            const fat = Math.round(tdee * fRatio / 9);

            $('orange-tdeeValue').textContent = tdee;
            $('orange-initialCarbs').textContent = initCarb;
            $('orange-protein').textContent = pro;
            $('orange-fat').textContent = fat;

            const lossPct = +$('weight-loss-percent').value / 100;
            const weeklyLoss = (w * lossPct / 4.33).toFixed(2);
            $('orange-weeklyLoss').textContent = weeklyLoss;

            // ç”Ÿæˆè¡¨æ ¼
            const tbody = $('orange-planBody');
            tbody.innerHTML = '';
            let currentC = initCarb;
            let currentW = w;
            
            // å‡å®šå±•ç¤º8å‘¨
            for(let i=1; i<=8; i++) {
                currentW = (currentW - weeklyLoss).toFixed(1);
                let note = i === 1 ? 'åˆå§‹ç¢³æ°´æ‘„å…¥' : (currentC > 100 ? 'å¦‚æœªè¾¾ç›®æ ‡,å‡å°‘15gç¢³æ°´' : 'ç¢³æ°´å·²ä½äº 100 gï¼Œå»ºè®®åœæ­¢å‡å°‘');
                tbody.innerHTML += `
                    <tr>
                        <td>${i}</td>
                        <td>${currentC}</td>
                        <td>${pro}</td>
                        <td>${fat}</td>
                        <td>${currentW}</td>
                        <td>${weeklyLoss}</td>
                        <td>${note}</td>
                    </tr>
                `;
                if(i > 1 && currentC > 100) currentC -= 15;
            }
        }

        $('orange-calculateBtn').addEventListener('click', calcOrangeCarb);
        $('orange-downloadBtn').addEventListener('click', () => {
             const wb = XLSX.utils.book_new();
             const ws = XLSX.utils.table_to_sheet(document.querySelector('.orange-table'));
             XLSX.utils.book_append_sheet(wb, ws, "æ¸é™è®¡åˆ’");
             XLSX.writeFile(wb, "æ©™å­ç¢³æ°´æ¸é™è®¡åˆ’.xlsx");
        });
        $('orange-resetBtn').addEventListener('click', () => { $('orange-weight').value=80; calcOrangeCarb(); });

        /* ================= 16+8 è½»æ–­é£Ÿ ================= */
        const windowCards = document.querySelectorAll('[data-window]');
        windowCards.forEach(c => c.addEventListener('click', () => {
            windowCards.forEach(x => x.classList.remove('selected'));
            c.classList.add('selected');
            $('fast-custom-window').style.display = c.dataset.window === 'custom' ? 'flex' : 'none';
            calculateFast();
        }));

        const activityCards = document.querySelectorAll('[data-activity]');
        activityCards.forEach(c => c.addEventListener('click', () => {
            activityCards.forEach(x => x.classList.remove('selected'));
            c.classList.add('selected');
            calculateFast();
        }));

        function calculateFast() {
            const w = +$('fast-weight').value;
            const h = +$('fast-height').value;
            const a = +$('fast-age').value;
            const g = $('fast-gender').value;
            const act = +document.querySelector('[data-activity].selected').dataset.activity;

            const bmr = g === 'male' ? 10*w + 6.25*h - 5*a + 5 : 10*w + 6.25*h - 5*a - 161;
            const tdee = Math.round(bmr * act);
            const target = Math.round(tdee * 0.8); // 20%ç¼ºå£

            const pro = Math.round(w * 1.6);
            const fat = Math.round(w * 0.7);
            const carb = Math.round((target - pro*4 - fat*9) / 4);

            $('fast-tdee').textContent = tdee;
            $('fast-calories').textContent = target;
            $('fast-protein').textContent = pro;

            // é€»è¾‘å±•ç¤º
            $('fast-logic-box').innerHTML = `
                <b style="color:var(--primary);">è¯¦ç»†è®¡ç®—æ­¥éª¤ï¼š</b><br>
                1) BMRï¼ˆåŸºç¡€ä»£è°¢ï¼‰= ${g === 'male' ? '10Ã—ä½“é‡ + 6.25Ã—èº«é«˜ - 5Ã—å¹´é¾„ + 5' : '10Ã—ä½“é‡ + 6.25Ã—èº«é«˜ - 5Ã—å¹´é¾„ - 161'} = <b>${Math.round(bmr)} kcal</b><br>
                2) TDEEï¼ˆæ¯æ—¥æ¶ˆè€—ï¼‰= BMR Ã— æ´»åŠ¨ç³»æ•°ï¼ˆ${act}ï¼‰= <b>${tdee} kcal</b><br>
                3) ç›®æ ‡çƒ­é‡ = TDEE Ã— 0.80ï¼ˆåˆ¶é€ 20%ç¼ºå£ï¼‰= <b>${target} kcal</b><br>
                4) å®é‡åˆ†é…ï¼š<br>
                   &nbsp;&nbsp;â€¢ è›‹ç™½è´¨ = ä½“é‡ Ã— 1.6g/kg = ${w} Ã— 1.6 = <b>${pro} g</b>ï¼ˆ${pro * 4} kcalï¼‰<br>
                   &nbsp;&nbsp;â€¢ è„‚è‚ª = ä½“é‡ Ã— 0.8g/kg = ${w} Ã— 0.7 = <b>${fat} g</b>ï¼ˆ${fat * 9} kcalï¼‰<br>
                   &nbsp;&nbsp;â€¢ å‰©ä½™çƒ­é‡ç»™ç¢³æ°´ = æ€»çƒ­é‡ - è›‹ç™½çƒ­é‡ - è„‚è‚ªçƒ­é‡ = ${target} - ${pro * 4} - ${fat * 9} = <b>${Math.max(0, target - pro*4 - fat*9)} kcal</b> Ã· 4 = <b>${carb} g</b><br>
            `;

            // æ›´æ–°è¡¨æ ¼
            const winType = document.querySelector('[data-window].selected').dataset.window;
            let winText = winType === 'custom' 
                ? `${$('fast-start').value}-${$('fast-end').value}`
                : (winType==='12-20'?'12:00-20:00':(winType==='10-18'?'10:00-18:00':'13:00-21:00'));

            const days = ['mon','tue','wed','thu','fri','sat','sun'];
            days.forEach((d, i) => {
                const isWeekend = i >= 5;
                const cal = isWeekend ? Math.round(target * 1.05) : target;
                const c = isWeekend ? Math.round(carb * 1.1) : carb;
                
                $(`fast-${d}-window`).textContent = winText;
                $(`fast-${d}-carb`).textContent = c;
                $(`fast-${d}-protein`).textContent = pro;
                $(`fast-${d}-fat`).textContent = fat;
                $(`fast-${d}-calories`).textContent = cal;
            });
        }

        $('fast-calculateBtn').addEventListener('click', calculateFast);
        $('fast-downloadBtn').addEventListener('click', () => {
             const wb = XLSX.utils.book_new();
             const ws = XLSX.utils.table_to_sheet($('fast-week-table'));
             XLSX.utils.book_append_sheet(wb, ws, "è½»æ–­é£Ÿè®¡åˆ’");
             XLSX.writeFile(wb, "16+8è½»æ–­é£Ÿè®¡åˆ’.xlsx");
        });
        $('fast-resetBtn').addEventListener('click', () => { $('fast-weight').value=70; calculateFast(); });

        /* ================= å¢è‚Œè®¡åˆ’ ================= */
        // ç»‘å®šé€‰æ‹©å¡ç‰‡äº‹ä»¶
        ['pal','exp','surplus'].forEach(type => {
            const cards = document.querySelectorAll(`#${type}-cards .bulk-level-card`);
            cards.forEach(c => c.addEventListener('click', () => {
                cards.forEach(x => x.classList.remove('selected'));
                c.classList.add('selected');
                calcBulk();
            }));
        });
        
        const bulkPlanCards = document.querySelectorAll('#bulk-plan-cards .plan-card');
        bulkPlanCards.forEach(c => c.addEventListener('click', () => {
            bulkPlanCards.forEach(x => x.classList.remove('selected'));
            c.classList.add('selected');
            $('bulk-custom-plan').style.display = c.dataset.plan === 'custom' ? 'flex' : 'none';
            calcBulk();
        }));

        function calcBulk() {
            const w = +$('bulk-weight').value;
            const h = +$('bulk-height').value;
            const a = +$('bulk-age').value;
            const g = $('bulk-gender').value;

            const pal = +document.querySelector('#pal-cards .selected').dataset.pal;
            const exp = document.querySelector('#exp-cards .selected').dataset.exp;
            const sur = +document.querySelector('#surplus-cards .selected').dataset.surplus;

            const bmr = g === 'male' ? 10*w + 6.25*h - 5*a + 5 : 10*w + 6.25*h - 5*a - 161;
            const tdee = Math.round(bmr * pal);
            const target = tdee + sur;

            // ç³»æ•°
            const map = {
                novice: {p:1.6, f:0.9, c:3.5},
                intermediate: {p:1.8, f:1.0, c:4.5},
                advanced: {p:2.0, f:1.0, c:5.0}
            };
            const coef = map[exp];

            const pro = Math.round(w * coef.p);
            const fat = Math.round(w * coef.f);
            
            // å‰©ä½™çƒ­é‡ç»™ç¢³æ°´
            let carb = Math.round((target - pro*4 - fat*9) / 4);
            // åŸºç¡€é‡
            const baseCarb = Math.round(w * coef.c);
            carb = Math.max(carb, baseCarb); // ç¡®ä¿ä¸ä½äºåŸºç¡€ç³»æ•°

            const trainCarb = carb;
            const restCarb = Math.round(carb * 0.85);

            $('bulk-target').textContent = target;
            $('bulk-protein').textContent = pro;
            $('bulk-carb-display').textContent = trainCarb;
            $('bulk-fat-display').textContent = fat;
            $('bulk-rest-carb-display').textContent = restCarb;
            
            const weeklySurplus = sur * 7; // ç®€å•ä¼°ç®—
            $('bulk-weekly-gain').textContent = (weeklySurplus / 7700).toFixed(2);

            // å¡«å……å‘¨è®¡åˆ’è¡¨
            const plan = document.querySelector('#bulk-plan-cards .selected').dataset.plan;
            let parts = [];
            if(plan === 'custom') {
                 parts = ['mon','tue','wed','thu','fri','sat','sun'].map(d=>$(`bulk-cus-${d}`).value||'ä¼‘æ¯');
            } else {
                 const pMap = {
                     '1':['ä¼‘æ¯','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','ä¼‘æ¯'],
                     '2':['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','ä¼‘æ¯','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´'],
                     '3':['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','ä¼‘æ¯','èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©'],
                     '4':['èƒ¸+ä¸‰å¤´','èƒŒ+äºŒå¤´','è…¿+è‚©','èƒ¸+ä¸‰å¤´','ä¼‘æ¯','èƒŒ+äºŒå¤´','è…¿+è‚©']
                 };
                 parts = pMap[plan];
            }

            for(let i=0; i<7; i++) {
                const isRest = parts[i] === 'ä¼‘æ¯';
                const c = isRest ? restCarb : trainCarb;
                const cal = c*4 + pro*4 + fat*9;
                const diff = cal - tdee;

                const trs = document.querySelectorAll('#bulk-week-table tbody tr');
                trs[0].children[i+1].textContent = parts[i];
                trs[1].children[i+1].textContent = c;
                trs[2].children[i+1].textContent = pro;
                trs[3].children[i+1].textContent = fat;
                trs[4].children[i+1].textContent = cal;
                trs[5].children[i+1].innerHTML = `<span style="color:${diff>0?'var(--success)':'var(--danger)'}">${diff>0?'+':''}${diff}</span>`;
            }
            
            // Logic Box
            const logicHtml = `
              <div class="bulk-logic" style="margin-top:12px;font-size:.75rem;color:var(--text-secondary);line-height:1.6;">
                <b>è®¡ç®—é€»è¾‘ï¼š</b><br>
                1) BMR = ${g==='male'?10*w+6.25*h-5*a+5:10*w+6.25*h-5*a-161} kcalï¼ˆMifflin-St Jeorï¼‰<br>
                2) TDEE = BMR Ã— ${pal} = ${tdee} kcalï¼ˆè¿åŠ¨ç³»æ•°ï¼‰<br>
                3) ç›®æ ‡çƒ­é‡ = TDEE + ${sur} = ${target} kcal<br>
                4) è›‹ç™½è´¨ = ä½“é‡ Ã— ${exp==='novice'?1.6:exp==='intermediate'?1.8:2.0} = ${pro} g<br>
                5) è„‚è‚ª = ä½“é‡ Ã—${coef.f} = ${fat} g<br>
                6) è®­ç»ƒæ—¥ç¢³æ°´ =ä½“é‡Ã—${coef.c} g/kg + ç›ˆä½™çƒ­é‡(è‹¥æœ‰)Ã·4 = ${trainCarb} g<br>
                7) ä¼‘æ¯æ—¥ç¢³æ°´ =ï¼ˆå‰©ä½™çƒ­é‡ Ã· 4ï¼‰*0.85  =  ${restCarb} g
              </div>
            `;
            $('bulk-logic-box').innerHTML = logicHtml;
        }

        $('bulk-calc').addEventListener('click', calcBulk);
        $('bulk-dl').addEventListener('click', () => {
             const wb = XLSX.utils.book_new();
             const ws = XLSX.utils.table_to_sheet($('bulk-week-table'));
             XLSX.utils.book_append_sheet(wb, ws, "å¢è‚Œè®¡åˆ’");
             XLSX.writeFile(wb, "å¢è‚Œè®¡åˆ’.xlsx");
        });
        $('bulk-reset').addEventListener('click', () => { $('bulk-weight').value=70; calcBulk(); });

        /* ================= é¥®æ°´å»ºè®®é€»è¾‘ ================= */
        function calcWater() {
            const w = +$('water-weight').value;
            const ex = +$('water-exercise').value;
            const sweat = $('water-sweat').value;

            // åŸºç¡€ï¼šæ¯å…¬æ–¤ä½“é‡35ml
            const base = Math.round(w * 35);
            
            // è¿åŠ¨è¡¥å¿ï¼šæ¯30åˆ†é’Ÿ
            // å°‘æ±— 250ml/30min, æ­£å¸¸ 350ml/30min, æš´æ±— 500ml/30min
            let exFactor = 350;
            if(sweat === 'low') exFactor = 250;
            if(sweat === 'high') exFactor = 500;
            
            const extra = Math.round((ex / 30) * exFactor);
            const total = base + extra;

            $('water-total').textContent = total;
            $('water-base').textContent = base;
            $('water-extra').textContent = extra;
        }
        $('water-calculateBtn').addEventListener('click', calcWater);
        $('water-resetBtn').addEventListener('click', () => { $('water-weight').value=70; $('water-exercise').value=60; calcWater(); });

        /* ================= å¿ƒç‡è®¡ç®—é€»è¾‘ ================= */
        function calcHeartRate() {
            const age = +$('hr-age').value;
            const rest = +$('hr-rest').value;

            const max = 220 - age;
            const reserve = max - rest; // å‚¨å¤‡å¿ƒç‡

            $('hr-max').textContent = max;
            $('hr-reserve').textContent = reserve;

            const zones = [
                { name: 'çƒ­èº«æ”¾æ¾', pct: [50, 60], color: 'zone-gray', desc: 'æä½å¼ºåº¦' },
                { name: 'ç‡ƒè„‚æ§é‡', pct: [60, 70], color: 'zone-green', desc: 'æœ€ä½³ç‡ƒè„‚' },
                { name: 'æœ‰æ°§è€åŠ›', pct: [70, 80], color: 'zone-blue', desc: 'å¿ƒè‚ºæå‡' },
                { name: 'æ— æ°§è€åŠ›', pct: [80, 90], color: 'zone-orange', desc: 'ä¹³é…¸å †ç§¯' },
                { name: 'æé™å†²åˆº', pct: [90, 100], color: 'zone-red', desc: 'åŠ›ç«­è¾¹ç¼˜' }
            ];

            const container = $('hr-zones-container');
            container.innerHTML = '';

            zones.forEach(z => {
                // Karvonenå…¬å¼: ç›®æ ‡å¿ƒç‡ = ((æœ€å¤§å¿ƒç‡ - é™æ¯) Ã— %) + é™æ¯
                const min = Math.round(reserve * (z.pct[0]/100) + rest);
                const maxHR = Math.round(reserve * (z.pct[1]/100) + rest);

                const html = `
                    <div style="background:var(--bg-input); padding:16px; border-radius:8px; margin-bottom:12px; border:1px solid var(--border-color); box-shadow:var(--shadow-sm);">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-weight:700; color:var(--text-main);">${z.name} <span style="font-size:0.75rem; color:var(--text-secondary); font-weight:400">(${z.pct[0]}-${z.pct[1]}%)</span></span>
                            <span style="font-weight:800; color:var(--primary);">${min} - ${maxHR} <span style="font-size:0.7rem;">BPM</span></span>
                        </div>
                        <div class="hr-zone-bar">
                            <div class="hr-zone-fill ${z.color}" style="width:${z.pct[1]}%"></div>
                        </div>
                        <div style="font-size:0.75rem; color:var(--text-secondary); margin-top:6px;">${z.desc}</div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }
        $('hr-calculateBtn').addEventListener('click', calcHeartRate);
        $('hr-resetBtn').addEventListener('click', () => { $('hr-age').value=30; $('hr-rest').value=65; calcHeartRate(); });

        // åˆå§‹åŒ–
        selectTool('kings-cycle'); // é¢„åŠ è½½ä¸€ä¸‹é€»è¾‘
        backToHome(); // å›åˆ°é¦–é¡µ

        /* ================= ä¿æŠ¤è„šæœ¬ ================= */
        // å…¨å±æ°´å°
        (function(){
            // Remove existing if any (prevent duplication)
            const existing = document.getElementById('global-watermark');
            if(existing) existing.remove();

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 300; canvas.height = 300;
            ctx.font = 'bold 20px sans-serif';
            // Use a solid dark gray base color.
            // Light mode will use 'multiply' to make it look faint.
            // Dark mode will use 'invert(1)' via CSS to turn it light gray and 'screen' to blend.
            ctx.fillStyle = 'rgba(80,80,80,0.15)'; 
            ctx.textAlign = 'center';
            ctx.translate(150,150);
            ctx.rotate(-Math.PI/6);
            ctx.fillText('Â© Cyyå¥èº«,ç¦æ­¢è½¬è½½/å•†ç”¨',0,0);
            
            const div = document.createElement('div');
            div.id = 'global-watermark'; // Important: Styles are now controlled by CSS #global-watermark
            div.style.backgroundImage = 'url(' + canvas.toDataURL() + ')';
            document.body.appendChild(div);
        })();

        // ç¦å³é”®/F12
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if(e.key === 'F12' || (e.ctrlKey && (e.key === 'u' || e.key === 'U'))) e.preventDefault();
        });
        
        // å¤åˆ¶ç‰ˆæƒ
        document.addEventListener('copy', e => {
            e.preventDefault();
            const text = window.getSelection().toString();
            e.clipboardData.setData('text/plain', text + '\n\nÂ© 2025 Cyyå¥èº« | æœªæˆæƒä»…é™ä¸ªäººä½¿ç”¨ | ç¦æ­¢è½¬è½½ã€å•†ç”¨ | è¿è€…å¿…ç©¶');
        });
    </script>
</body>
</html>
