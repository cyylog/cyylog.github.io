<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Mycat, 运维博客,kubernetes,Docker,shell,nginx,Tomcat,Centos7,Linux,zabbix,Gopher,Ansible,Promethues">
    <meta name="description" content="精通原创，擅长盗版">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Mycat | Cyylog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Cyylog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Cyylog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Cyylog</div>
        <div class="logo-desc">
            
            精通原创，擅长盗版
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/cyylog/Go_status" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/cyylog/Go_status" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/18.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Mycat</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Mysql/">
                                <span class="chip bg-color">Mysql</span>
                            </a>
                        
                            <a href="/tags/Mycat/">
                                <span class="chip bg-color">Mycat</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/SQL/" class="post-category">
                                SQL
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-09-28
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="MySQL-Replication"><a href="#MySQL-Replication" class="headerlink" title="MySQL-Replication"></a>MySQL-Replication</h2><h3 id="MySQL-Replication-1"><a href="#MySQL-Replication-1" class="headerlink" title="MySQL Replication"></a>MySQL Replication</h3><p>主从复制（也称 AB 复制）允许将来自一个MySQL数据库服务器（主服务器）的数据复制到一个或多个MySQL数据库服务器（从服务器）。</p>
<blockquote>
<p>复制是异步的 从站不需要永久连接以接收来自主站的更新。</p>
</blockquote>
<p>根据配置，您可以复制数据库中的所有数据库，所选数据库甚至选定的表。</p>
<p>MySQL中复制的优点包括：</p>
<ul>
<li>横向扩展解决方案 - 在多个从站之间分配负载以提高性能。在此环境中，所有写入和更新都必须在主服务器上进行。但是，读取可以在一个或多个从设备上进行。该模型可以提高写入性能（因为主设备专用于更新），同时显着提高了越来越多的从设备的读取速度。</li>
<li>数据安全性 - 因为数据被复制到从站，并且从站可以暂停复制过程，所以可以在从站上运行备份服务而不会破坏相应的主数据。</li>
<li>分析 - 可以在主服务器上创建实时数据，而信息分析可以在从服务器上进行，而不会影响主服务器的性能。</li>
<li>远程数据分发 - 您可以使用复制为远程站点创建数据的本地副本，而无需永久访问主服务器。</li>
</ul>
<h3 id="Replication的原理"><a href="#Replication的原理" class="headerlink" title="Replication的原理"></a>Replication的原理</h3><p><img src="https://i.loli.net/2019/08/13/b8YDSUo3ZM6wLtx.jpg" alt=""></p>
<p>前提是作为主服务器角色的数据库服务器必须开启二进制日志</p>
<pre><code>主服务器上面的任何修改都会通过自己的 I/O tread(I/O 线程)保存在二进制日志 Binary log 里面。
从服务器上面也启动一个 I/O thread，通过配置好的用户名和密码, 连接到主服务器上面请求读取二进制日志，然后把读取到的二进制日志写到本地的一个Realy log（中继日志）里面。
从服务器上面同时开启一个 SQL thread 定时检查 Realy log(这个文件也是二进制的)，如果发现有更新立即把更新的内容在本机的数据库上面执行一遍。

每个从服务器都会收到主服务器二进制日志的全部内容的副本。
从服务器设备负责决定应该执行二进制日志中的哪些语句。
除非另行指定，否则主从二进制日志中的所有事件都在从站上执行。
如果需要，您可以将从服务器配置为仅处理一些特定数据库或表的事件。
重要: 您无法将主服务器配置为仅记录特定事件。
每个从站(从服务器)都会记录二进制日志坐标：
     文件名
     文件中它已经从主站读取和处理的位置。


由于每个从服务器都分别记录了自己当前处理二进制日志中的位置，因此可以断开从服务器的连接，重新连接然后恢复继续处理。
</code></pre><h5 id="一主多从"><a href="#一主多从" class="headerlink" title="一主多从"></a>一主多从</h5><p>如果一主多从的话，这时主库既要负责写又要负责为几个从库提供二进制日志。此时可以稍做调整，将二进制日志只给某一从，这一从再开启二进制日志并将自己的二进制日志再发给其它从。或者是干脆这个从不记录只负责将二进制日志转发给其它从，这样架构起来性能可能要好得多，而且数据之间的延时应该也稍微要好一些。工作原理图如下：</p>
<p><img src="https://i.loli.net/2019/08/13/1e8xfpo5rMt3Blg.jpg" alt=""></p>
<p>练习题:</p>
<pre class=" language-reStructuredText"><code class="language-reStructuredText">使用三台机器搭建一主多从的mysql架构并能够实现数据同步, 部署形式不限<脚本、手动都可></code></pre>
<h4 id="关于二进制日志"><a href="#关于二进制日志" class="headerlink" title="关于二进制日志"></a>关于二进制日志</h4><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fmysqld.html" target="_blank" rel="noopener"><strong>mysqld</strong></a>将数字扩展名附加到二进制日志基本名称以生成二进制日志文件名。每次服务器创建新日志文件时，该数字都会增加，从而创建一系列有序的文件。每次启动或刷新日志时，服务器都会在系列中创建一个新文件。服务器还会在当前日志大小达到<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Freplication-options-binary-log.html%23sysvar_max_binlog_size" target="_blank" rel="noopener"><code>max_binlog_size</code></a>参数设置的大小后自动创建新的二进制日志文件 。二进制日志文件可能会比<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Freplication-options-binary-log.html%23sysvar_max_binlog_size" target="_blank" rel="noopener"><code>max_binlog_size</code></a>使用大型事务时更大， 因为事务是以一个部分写入文件，而不是在文件之间分割。</p>
<p>为了跟踪已使用的二进制日志文件， <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fmysqld.html" target="_blank" rel="noopener"><strong>mysqld</strong></a>还创建了一个二进制日志索引文件，其中包含所有使用的二进制日志文件的名称。默认情况下，它具有与二进制日志文件相同的基本名称，并带有扩展名<code>&#39;.index&#39;</code>。在<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fmysqld.html" target="_blank" rel="noopener"><strong>mysqld</strong></a>运行时，您不应手动编辑此文件。</p>
<p>术语<code>二进制日志文件</code>通常表示包含数据库事件的单个编号文件。</p>
<p>术语 <code>二进制日志</code>  表示含编号的二进制日志文件集加上索引文件。</p>
<p><code>SUPER</code> 权限的用户可以使用<code>SET sql_log_bin=0</code>语句禁用其当前环境下自己的语句的二进制日志记录</p>
<h3 id="配置Replication"><a href="#配置Replication" class="headerlink" title="配置Replication"></a>配置Replication</h3><h5 id="配置步骤："><a href="#配置步骤：" class="headerlink" title="配置步骤："></a>配置步骤：</h5><ol>
<li>在主服务器上，您必须启用二进制日志记录并配置唯一的服务器ID。需要重启服务器。</li>
</ol>
<p>编辑主服务器的配置文件 <code>my.cnf</code>，添加如下内容</p>
<pre><code>[mysqld]
log-bin=/var/log/mysql/mysql-bin
server-id=1</code></pre><p>创建日志目录并赋予权限</p>
<pre><code>[root@mysql ~]#  mkdir /var/log/mysql
[root@mysql ~]# chown mysql.mysql /var/log/mysql</code></pre><p>重启服务</p>
<pre><code>[root@mysql ~]# systemctl restart mysqld</code></pre><p><strong>注意：：</strong></p>
<pre><code>如果省略server-id（或将其显式设置为默认值0），则主服务器拒绝来自从服务器的任何连接。

为了在使用带事务的InnoDB进行复制设置时尽可能提高持久性和一致性，
您应该在master my.cnf文件中使用以下配置项：
innodb_flush_log_at_trx_commit = 1
sync_binlog = 1

确保未在复制主服务器上启用skip-networking选项。
如果已禁用网络，则从站无法与主站通信，并且复制失败。</code></pre><p>2.应该创建一个专门用于复制数据的用户</p>
<p>每个从服务器需要使用MySQL 主服务器上的用户名和密码连接到主站。</p>
<p>例如，计划使用用户 <code>repl</code> 可以从任何主机上连接到 <code>master</code> 上进行复制操作, 并且用户 <code>repl</code> 仅可以使用复制的权限。</p>
<p>在 <code>主服务器</code> 上执行如下操作</p>
<pre><code>mysql&gt; CREATE USER &#39;repl&#39;@&#39;%&#39; 
mysql&gt; GRANT REPLICATION SLAVE ON *.*  TO  &#39;repl&#39;@&#39;%&#39;  identified by 
 &#39;123&#39;;
mysql&gt; </code></pre><p>3.在<code>从服务器</code>上使用刚才的用户进行测试连接</p>
<pre><code>[root@mysql ~]# mysql -urepl -p&#39;123&#39; -hmysql-master1</code></pre><p>下面的操作根据如下情况继续</p>
<h5 id="主服务器中有数据"><a href="#主服务器中有数据" class="headerlink" title="主服务器中有数据"></a>主服务器中有数据</h5><ul>
<li>如果在启动复制之前有现有数据需要与从属设备同步，请保持客户端正常运行，以便锁定保持不变。这可以防止进行任何进一步的更改，以便复制到从站的数据与主站同步。</li>
</ul>
<ol>
<li>在主服务器中导出先有的数据</li>
</ol>
<p>如果主数据库包含现有数据，则必须将此数据复制到每个从站。有多种方法可以实现:</p>
<ul>
<li>使用<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fmysqldump.html" target="_blank" rel="noopener"><strong>mysqldump</strong></a>工具创建要复制的所有数据库的转储。这是推荐的方法，尤其是在使用时 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Finnodb-storage-engine.html" target="_blank" rel="noopener"><code>InnoDB</code></a>。</li>
</ul>
<pre><code>[root@mysql ~]# mysqldump  -u用户名  -p密码  --all-databases  --master-data=1 &gt; dbdump.db

这里的用户是主服务器的用户</code></pre><p>如果不使用 <code>--master-data</code> 参数，则需要手动锁定单独会话中的所有表。</p>
<ol start="2">
<li>从主服务器中使用 <code>scp</code> 或 <code>rsync</code> 等工具，把备份出来的数据传输到从服务器中。</li>
</ol>
<p>在主服务中执行如下命令</p>
<pre><code>[root@mysql ~]# scp  dbdump.db root@mysql-slave1:/root/

这里的 mysql-slave1 需要能被主服务器解析出 IP 地址，或者说可以在主服务器中 ping 通。</code></pre><ol start="3">
<li>配置从服务器，并重启<br>在<code>从服务器</code> 上编辑其配置文件 <code>my.cnf</code> 并添加如下内容</li>
</ol>
<pre><code>// my.cnf 文件
[mysqld]
server-id=2</code></pre><ol start="4">
<li>导入数据到从服务器，并配置连接到主服务器的相关信息</li>
</ol>
<p>登录到从服务器上，执行如下操作</p>
<pre><code>/*导入数据*/
mysql&gt; source   /root/fulldb.dump</code></pre><p>在从服务器配置连接到主服务器的相关信息</p>
<pre><code>mysql&gt; CHANGE MASTER TO
MASTER_HOST=&#39;mysql-master1&#39;,  -- 主服务器的主机名(也可以是 IP) 
MASTER_USER=&#39;repl&#39;,           -- 连接到主服务器的用户
MASTER_PASSWORD=&#39;123&#39;;        -- 到主服务器的密码</code></pre><ol start="5">
<li><p>启动从服务器的复制线程</p>
<pre><code>mysql&gt; start slave;
Query OK, 0 rows affected (0.09 sec)</code></pre></li>
</ol>
<p>检查是否成功</p>
<p>在从服务上执行如下操作，加长从服务器端 IO线程和 SQL 线程是否是 <code>OK</code></p>
<pre><code>mysql&gt; show slave status\G</code></pre><p>输出结果中应该看到 I/O 线程和 SQL 线程都是 <code>YES</code>, 就表示成功。</p>
<p>执行此过程后，在主服务上操作的修改数据的操作都会在从服务器中执行一遍，这样就保证了数据的一致性。</p>
<h5 id="主服务器中无数据"><a href="#主服务器中无数据" class="headerlink" title="主服务器中无数据"></a>主服务器中无数据</h5><p><strong>主服务器中设置</strong></p>
<ol>
<li><code>my.cnf</code>配置文件</li>
</ol>
<pre><code>[mysqld]
log-bin=/var/log/mysql/mysql-bin
server-id=1</code></pre><p>创建日志目录并赋予权限</p>
<pre><code>[root@mysql ~]#  mkdir /var/log/mysql
[root@mysql ~]#  chown mysql.mysql /var/log/mysql</code></pre><p>重启服务</p>
<p><strong>从服务器设置</strong></p>
<ol>
<li><code>my.cnf</code>配置文件</li>
</ol>
<pre><code>[mysqld]
server-id=3</code></pre><p>重启服务</p>
<ol start="2">
<li>查看主服务器的二进制日志的名称</li>
</ol>
<p>通过使用命令行客户端连接到主服务器来启动主服务器上的会话，并通过执行以下 <code>FLUSH TABLES WITH READ LOCK</code>  语句来刷新所有表和阻止写语句：</p>
<pre><code>mysql&gt; FLUSH TABLES WITH READ LOCK;

mysql&gt; show master status \G
****************** 1. row ****************
             File: mysql-bin.000001
         Position: 0
     Binlog_Do_DB:
 Binlog_Ignore_DB:
Executed_Gtid_Set:
1 row in set (0.00 sec)</code></pre><ol start="3">
<li>在从服务器的 mysql 中执行如下语句</li>
</ol>
<pre><code>mysql&gt; CHANGE MASTER TO
MASTER_HOST=&#39;mysql-master1&#39;,
MASTER_USER=&#39;repl&#39;,
MASTER_PASSWORD=&#39;123&#39;,
MASTER_LOG_FILE=&#39;mysql-bin.000001&#39;,
MASTER_LOG_POS=0;

mysql&gt; start slave;
</code></pre><p><strong>查看</strong></p>
<p>在master上执行show binlog events命令，可以看到第一个binlog文件的内容。</p>
<pre><code>mysql&gt; show binlog events\G
*************************** 1. row ***************************
   Log_name: mysql-bin.000001
        Pos: 4
 Event_type: Format_desc
  Server_id: 1
End_log_pos: 107
       Info: Server ver: 5.5.28-0ubuntu0.12.10.2-log, Binlog ver: 4
*************************** 2. row ***************************
   Log_name: mysql-bin.000001
        Pos: 107
 Event_type: Query
  Server_id: 1
End_log_pos: 181
       Info: create user rep
*************************** 3. row ***************************
   Log_name: mysql-bin.000001
        Pos: 181
 Event_type: Query
  Server_id: 1
End_log_pos: 316
       Info: grant replication slave on *.* to rep identified by &#39;123456&#39;
3 rows in set (0.00 sec)


Log_name 是二进制日志文件的名称，一个事件不能横跨两个文件
Pos 这是该事件在文件中的开始位置
Event_type 事件的类型，事件类型是给slave传递信息的基本方法，每个新的binlog都以Format_desc类型开始，以Rotate类型结束
Server_id 创建该事件的服务器id
End_log_pos 该事件的结束位置，也是下一个事件的开始位置，因此事件范围为Pos~End_log_pos  -  1
Info 事件信息的可读文本，不同的事件有不同的信息
</code></pre><h4 id="在从站上暂停复制"><a href="#在从站上暂停复制" class="headerlink" title="在从站上暂停复制"></a>在从站上暂停复制</h4><p>您可以使用<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fstop-slave.html" target="_blank" rel="noopener"><code>STOP SLAVE</code></a>和 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fstart-slave.html" target="_blank" rel="noopener"><code>START SLAVE</code></a>语句停止并启动从站上的复制 。</p>
<p>要停止从主服务器处理二进制日志，请使用 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fstop-slave.html" target="_blank" rel="noopener"><code>STOP SLAVE</code></a>：</p>
<pre><code>mysql&gt; STOP SLAVE;</code></pre><p>当复制停止时，从I / O线程停止从主二进制日志读取事件并将它们写入中继日志，并且SQL线程停止从中继日志读取事件并执行它们。您可以通过指定线程类型单独暂停I / O或SQL线程：</p>
<pre><code>mysql&gt; STOP SLAVE IO_THREAD;
mysql&gt; STOP SLAVE SQL_THREAD;</code></pre><p>要再次开始执行，请使用以下<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fstart-slave.html" target="_blank" rel="noopener"><code>START SLAVE</code></a>语句：</p>
<pre><code>mysql&gt; START SLAVE;</code></pre><p>要启动特定线程，请指定线程类型：</p>
<pre><code>mysql&gt; START SLAVE IO_THREAD;
mysql&gt; START SLAVE SQL_THREAD;</code></pre><pre><code>复制原理实现细节（了解）
MySQL复制功能使用三个线程实现，一个在主服务器上，两个在从服务器上：


Binlog转储线程 主设备创建一个线程，以便在从设备连接时将二进制日志内容发送到从设备。可以SHOW PROCESSLIST在主服务器的输出中将此线程标识为Binlog Dump线程。
二进制日志转储线程获取主机二进制日志上的锁，用于读取要发送到从机的每个事件。一旦读取了事件，即使在事件发送到从站之前，锁也会被释放。


从属 I/O线程 在从属服务器上发出 START SLAVE 语句时，从属服务器会创建一个 I/O 线程，该线程连接到主服务器并要求主服务器发送其在二进制日志中的更新记录。
从属 I/O线程读取主Binlog Dump线程发送的更新 （请参阅上一项）并将它们复制到包含从属中继日志的本地文件。
此线程的状态显示为 Slave_IO_running输出 SHOW SLAVE STATUS或 Slave_running输出中的状态SHOW STATUS。

从属SQL线程 从属设备创建一个SQL线程来读取由从属 I/O 线程写入的中继日志，并执行其中包含的事件。
当从属服务器从放的事件，追干上主服务器的事件后，从属服务器的 I/O 线程将会处于休眠状态，直到主服务器的事件有更新时，被主服务器发送的信号唤醒。

在前面的描述中，每个主/从连接有三个线程。具有多个从站的主站为每个当前连接的从站创建一个二进制日志转储线程，每个从站都有自己的I / O和SQL线程。
从站使用两个线程将读取更新与主站分开并将它们执行到独立任务中。因此，如果语句执行缓慢，则不会减慢读取语句的任务。例如，如果从服务器尚未运行一段时间，则当从服务器启动时，其I / O线程可以快速从主服务器获取所有二进制日志内容，即使SQL线程远远落后。如果从服务器在SQL线程执行了所有获取的语句之前停止，则I / O线程至少已获取所有内容，以便语句的安全副本本地存储在从属的中继日志中，准备在下次执行时执行奴隶开始。
</code></pre><h3 id="配置Replication-gtid方式"><a href="#配置Replication-gtid方式" class="headerlink" title="配置Replication(gtid方式)"></a>配置Replication(gtid方式)</h3><p>基于事务的Replication，就是利用GTID来实现的复制</p>
<p>GTID（全局事务标示符）最初由google实现，在MySQL 5.6中引入.GTID在事务提交时生成，由UUID和事务ID组成.uuid会在第一次启动MySQL时生成，保存在数据目录下的auto .cnf文件里，事务ID则从1开始自增使用GTID的好处主要有两点：</p>
<ol>
<li>不再需要指定传统复制中的master_log_files和master_log_pos，使主从复制更简单可靠</li>
<li>可以实现基于库的多线程复制，减小主从复制的延迟</li>
</ol>
<p><strong>实验环境要求： 5.7.6 以上版本</strong></p>
<h5 id="主库配置"><a href="#主库配置" class="headerlink" title="主库配置"></a>主库配置</h5><pre><code>[mysqld]
log-bin=/var/log/mysql/mysql-bin
server-id=1
gtid_mode=ON
enforce_gtid_consistency=1   # 强制执行GTID一致性。</code></pre><p>重启服务</p>
<p>其他和之前的一样</p>
<ul>
<li>创建专属用户并授权</li>
<li>假如有数据导出数据</li>
</ul>
<pre><code>mysql&gt; CREATE USER &#39;repl&#39;@&#39;%&#39; IDENTIFIED BY &#39;123&#39;;
mysql&gt; GRANT REPLICATION SLAVE ON *.* TO &#39;repl&#39;@&#39;%&#39;;
mysql&gt; </code></pre><h5 id="从库配置"><a href="#从库配置" class="headerlink" title="从库配置"></a>从库配置</h5><p>测试用户有效性</p>
<pre><code>mysql -urepl -p&#39;123&#39; -hmysql-master1</code></pre><pre><code>[mysqld]
server-id=2
gtid_mode=ON
enforce_gtid_consistency=1

# 可选项, 把连接到 master 的信息存到数据库中的表中
master-info-repository=TABLE
relay-log-info-repository=TABLE</code></pre><p>重启服务</p>
<p>假如有数据，先导入数据</p>
<pre><code>mysql&gt; source dump.db</code></pre><p>Mysql 终端执行连接信息</p>
<pre><code>mysql&gt; CHANGE MASTER TO
MASTER_HOST=&#39;172.16.153.10&#39;,
MASTER_USER=&#39;repl&#39;,
MASTER_PASSWORD=&#39;123&#39;,
MASTER_AUTO_POSITION=1;

&gt; start slave;</code></pre><h3 id="Replication故障排除"><a href="#Replication故障排除" class="headerlink" title="Replication故障排除"></a>Replication故障排除</h3><h4 id="开启-GTID-后的导出导入数据的注意点"><a href="#开启-GTID-后的导出导入数据的注意点" class="headerlink" title="开启 GTID 后的导出导入数据的注意点"></a>开启 GTID 后的导出导入数据的注意点</h4><blockquote>
<p>Warning: A partial dump from a server that has GTIDs will by default include the GTIDs of all transactions, even those that changed suppressed parts of the database. If you don’t want to restore GTIDs, pass –set-gtid-purged=OFF. To make a complete dump, pass –all-databases –triggers –routines –events</p>
</blockquote>
<p>意思是： 当前数据库实例中开启了 GTID 功能, 在开启有 GTID 功能的数据库实例中, 导出其中任何一个库, 如果没有显示地指定–set-gtid-purged参数, 都会提示这一行信息. 意思是默认情况下, 导出的库中含有 GTID 信息, 如果不想导出包含有 GTID 信息的数据库, 需要显示地添加–set-gtid-purged=OFF参数.</p>
<pre><code>mysqldump -uroot  -p  --set-gtid-purged=OFF   --all-databases &gt; alldb.db</code></pre><p>导入数据是就可以相往常一样导入了。</p>
<h4 id="UUID一致，导致主从复制I-O线程不是yes"><a href="#UUID一致，导致主从复制I-O线程不是yes" class="headerlink" title="UUID一致，导致主从复制I/O线程不是yes"></a>UUID一致，导致主从复制I/O线程不是yes</h4><blockquote>
<p>Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work</p>
</blockquote>
<p>致命错误：由于master和slave具有相同的mysql服务器uuid，从I/O线程将停止；这些uuid必须不同才能使复制工作。</p>
<p>问题提示主从使用了相同的server UUID，一个个的检查：</p>
<p>检查主从server_id</p>
<p>主库：</p>
<p>mysql&gt;  show variables like ‘server_id’;<br>+—————+——-+<br>| Variable_name | Value |<br>+—————+——-+<br>| server_id     | 1     |<br>+—————+——-+<br>1 row in set (0.01 sec)</p>
<p>从库：</p>
<p>mysql&gt;  show variables like ‘server_id’;<br>+—————+——-+<br>| Variable_name | Value |<br>+—————+——-+<br>| server_id     | 2     |<br>+—————+——-+<br>1 row in set (0.01 sec)</p>
<p>server_id不一样，排除。</p>
<p>检查主从状态：</p>
<p>主库：</p>
<p>mysql&gt; show master status;<br>+——————+———-+————–+——————+——————-+<br>| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |<br>+——————+———-+————–+——————+——————-+<br>| mysql-bin.000001 |      154 |              |                  |                   |<br>+——————+———-+————–+——————+——————-+<br>1 row in set (0.00 sec)<br>从库：</p>
<p>mysql&gt; show master status;<br>+——————+———-+————–+——————+——————-+<br>| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |<br>+——————+———-+————–+——————+——————-+<br>| mysql-bin.000001 |      306 |              |                  |                   |<br>+——————+———-+————–+——————+——————-+<br>1 row in set (0.00 sec)</p>
<p>File一样，排除。</p>
<p>最后检查发现他们的auto.cnf中的server-uuid是一样的。。。</p>
<p>[root@localhost ~]# vim /var/lib/mysql/auto.cnf</p>
<p>[auto]</p>
<p>server-uuid=4f37a731-9b79-11e8-8013-000c29f0700f</p>
<p>修改uuid并重启服务</p>
<h3 id="数据库中间MyCAT读写分离实现-重要！！！"><a href="#数据库中间MyCAT读写分离实现-重要！！！" class="headerlink" title="数据库中间MyCAT读写分离实现 (重要！！！)"></a>数据库中间MyCAT读写分离实现 (重要！！！)</h3><p>Mycat 是一个开源的分布式数据库系统，但是由于真正的数据库需要存储引擎，而 Mycat 并没有存 储引擎，所以并不是完全意义的分布式数据库系统。 那么 Mycat 是什么？Mycat 是数据库中间件，就是介于数据库与应用之间，进行数据处理与交互的中间服 务。</p>
<p><img src="https://i.loli.net/2019/08/12/ZXJxhqTER2UFak5.jpg" alt=""></p>
<p>MyCAT 是使用 JAVA 语言进行编写开发，使用前需要先安装 JAVA 运行环境(JRE),由于 MyCAT 中使用了 JDK7 中的一些特性，所以要求必须在 JDK7 以上的版本上运行。</p>
<h4 id="部署环境"><a href="#部署环境" class="headerlink" title="部署环境"></a>部署环境</h4><p>1下载JDK</p>
<pre><code>[root@mycat ~]# wget --no-cookies \
--no-check-certificate \
--header \
&quot;Cookie: oraclelicense=accept-securebackup-cookie&quot; \
http://download.oracle.com/otn-pub/java/jdk/8u181-\
b13/96a7b8442fe848ef90c96a2fad6ed6d1/jdk-8u181-linux-\
x64.tar.gz

// --no-check-certificate 表示不校验SSL证书，因为中间的两个302会访问https，会涉及到证书的问题，不校验能快一点，影响不大.</code></pre><p>2.解压文件</p>
<pre><code>[root@mycat ~]# tar -xf jdk-8u181-linux-x64.tar.gz   -C  /usr/local/
[root@mycat ~]# ln -s /usr/local/jdk1.8.0_181/ /usr/local/java</code></pre><p>3.配置环境变量</p>
<pre><code>[root@mycat ~]# vim /etc/profile.d/java.sh
export JAVA_HOME=/usr/local/java
export PATH=$JAVA_HOME/bin:$PATH
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar

使环境变量生效
[root@mycat ~]# source /etc/profile.d/java.sh</code></pre><h4 id="部署Mycat"><a href="#部署Mycat" class="headerlink" title="部署Mycat"></a>部署Mycat</h4><p><img src="https://i.loli.net/2019/08/12/zlZOf4dv95xPkS1.jpg" alt=""></p>
<pre><code>下载
[root@mycat ~]# wget http://dl.mycat.io/1.6.5/Mycat-server-1.6.5-release-20180122220033-linux.tar.gz
解压
[root@mycat ~]# tar xf Mycat-server-1.6.5-release-20180122220033-linux.tar.gz -C /usr/local/
</code></pre><h5 id="配置Mycat"><a href="#配置Mycat" class="headerlink" title="配置Mycat"></a>配置Mycat</h5><p>认识配置文件</p>
<p>MyCAT 目前主要通过配置文件的方式来定义逻辑库和相关配置:</p>
<p>/usr/local/mycat/conf/server.xml             定义用户以及系统相关变量，如端口等。其中用户信息是前端应用程序连接 mycat 的用户信息。</p>
<p>/usr/local/mycat/conf/schema.xml       定义逻辑库，表、分片节点等内容。</p>
<h5 id="配置-server-xml"><a href="#配置-server-xml" class="headerlink" title="配置 server.xml"></a>配置 server.xml</h5><p>以下为代码片段</p>
<p>下面的用户和密码是应用程序连接到 MyCat 使用的，可以自定义配置</p>
<p>而其中的schemas 配置项所对应的值是逻辑数据库的名字，也可以自定义，但是这个名字需要和后面 schema.xml 文件中配置的一致。</p>
<pre><code>vim server.xml
&lt;!--下面的用户和密码是应用程序连接到 MyCat 使用的.schemas 配置项所对应的值是逻辑数据库的名字,这个名字需要和后面 schema.xml 文件中配置的一致。--&gt;

       &lt;user name=&quot;mycatdb&quot; defaultAccount=&quot;true&quot;&gt;
                &lt;property name=&quot;password&quot;&gt;1&lt;/property&gt;
                &lt;property name=&quot;schemas&quot;&gt;mycat_db&lt;/property&gt;

                &lt;!-- 表级 DML 权限设置 --&gt;
                &lt;!--            
                &lt;privileges check=&quot;false&quot;&gt;
                        &lt;schema name=&quot;TESTDB&quot; dml=&quot;0110&quot; &gt;
                                &lt;table name=&quot;tb01&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;
                                &lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;
                        &lt;/schema&gt;
                &lt;/privileges&gt;           
                 --&gt;
        &lt;/user&gt;
&lt;!--下面是另一个用户，并且设置的访问 TESTED 逻辑数据库的权限是 只读
        &lt;user name=&quot;mycatuser&quot;&gt;
                &lt;property name=&quot;password&quot;&gt;123&lt;/property&gt;
                &lt;property name=&quot;schemas&quot;&gt;mycat_db&lt;/property&gt;
                &lt;property name=&quot;readOnly&quot;&gt;true&lt;/property&gt;
        &lt;/user&gt;
--&gt;
&lt;/mycat:server&gt;
</code></pre><p>== 上面的配置中，假如配置了用户访问的逻辑库，那么必须在 <code>schema.xml</code> 文件中也配置这个逻辑库，否则报错，启动 mycat 失败 ==</p>
<h5 id="配置schema-xml"><a href="#配置schema-xml" class="headerlink" title="配置schema.xml"></a>配置schema.xml</h5><p>以下是配置文件中的每个部分的配置块儿</p>
<p><strong>逻辑库和分表设置</strong></p>
<pre><code>&lt;schema name=&quot;mycat_db&quot;           // 逻辑库名称,与server.xml的一致
        checkSQLschema=&quot;false&quot;    // 不检查
        sqlMaxLimit=&quot;100&quot;         // 最大连接数
        dataNode=&quot;tiger1&quot;&gt;        //  数据节点名称
&lt;!--这里定义的是分表的信息--&gt;        
&lt;/schema&gt;
</code></pre><p><strong>数据节点</strong></p>
<pre><code>&lt;dataNode name=&quot;tiger1&quot;             // 此数据节点的名称
          dataHost=&quot;localhost1&quot;     // 主机组
          database=&quot;mycat_test&quot; /&gt;  // 真实的数据库名称</code></pre><p><strong>主机组</strong></p>
<pre><code>&lt;dataHost name=&quot;localhost1&quot;                       // 主机组
          maxCon=&quot;1000&quot; minCon=&quot;10&quot;               // 连接
          balance=&quot;0&quot;                             // 负载均衡
          writeType=&quot;0&quot;                           // 写模式配置
          dbType=&quot;mysql&quot; dbDriver=&quot;native&quot;        // 数据库配置
          switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;
&lt;!--这里可以配置关于这个主机组的成员信息，和针对这些主机的健康检查语句--&gt;
&lt;/dataHost&gt;</code></pre><pre><code>balance 属性
负载均衡类型,目前的取值有 3 种:
1. balance=&quot;0&quot;, 不开启读写分离机制,所有读操作都发送到当前可用的 writeHost 上。
2. balance=&quot;1&quot;, 全部的 readHost 与 stand by writeHost 参与 select 语句的负载均衡,简单的说,当双主双从模式(M1-&gt;S1,M2-&gt;S2,并且 M1 与 M2 
    互为主备),正常情况下,M2,S1,S2 都参与 select 语句的负载均衡。
4. balance=&quot;2&quot;, 所有读操作都随机的在 writeHost、readhost 上分发。
5. balance=&quot;3&quot;, 所有读请求随机的分发到 wiriterHost 对应的 readhost 执行,writerHost 不负担读压力,注意 balance=3 只在 1.4 及其以后版本有,1.3 没有。

writeType 属性
负载均衡类型,目前的取值有 3 种:
1. writeType=&quot;0&quot;, 所有写操作发送到配置的第一个 writeHost,第一个挂了切到还生存的第二个writeHost,重新启动后已切换后的为准.
2. writeType=&quot;1&quot;,所有写操作都随机的发送到配置的 writeHost,1.5 以后废弃不推荐。</code></pre><p><strong>健康检查</strong></p>
<pre><code>&lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</code></pre><p><strong>读写配置</strong></p>
<pre><code>&lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.19.176:3306&quot; user=&quot;root&quot; password=&quot;1&quot;&gt;
                        &lt;!-- can have multi read hosts --&gt;
       &lt;readHost host=&quot;hostS2&quot; url=&quot;192.168.19.177:3306&quot; user=&quot;root&quot; password=&quot;1&quot; /&gt;
&lt;/writeHost&gt;</code></pre><p>以下是组合为完整的配置文件，适用于一主一从的架构</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;
&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;

  &lt;schema name=&quot;mycat_db&quot; 
        checkSQLschema=&quot;false&quot; 
        sqlMaxLimit=&quot;100&quot; 
        dataNode=&quot;tiger1&quot;&gt; 
   &lt;!--这里定义的是分库分表的信息--&gt;     
   &lt;/schema&gt;


  &lt;dataNode name=&quot;tiger1&quot; 
          dataHost=&quot;localhost1&quot; database=&quot;mycat_test&quot; /&gt;


  &lt;dataHost name=&quot;localhost1&quot; 
            maxCon=&quot;1000&quot; minCon=&quot;10&quot; 
            balance=&quot;0&quot;
            writeType=&quot;0&quot; 
            dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; 
            switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;


   &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;
       &lt;!-- can have multi write hosts --&gt;
   &lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.19.176:3306&quot; 
              user=&quot;root&quot;  password=&quot;1&quot;&gt;
      &lt;!-- can have multi read hosts --&gt;
      &lt;readHost host=&quot;hostS2&quot; url=&quot;192.168.19.177:3306&quot; 
                user=&quot;root&quot; password=&quot;1&quot; /&gt;
     &lt;/writeHost&gt;
   &lt;/dataHost&gt;
&lt;/mycat:schema&gt;</code></pre><h4 id="启动-mycat"><a href="#启动-mycat" class="headerlink" title="启动 mycat"></a>启动 mycat</h4><pre><code>[root@mycat ~]# /usr/local/mycat/bin/mycat  start

支持一下参数
start | restart |stop | status</code></pre><h4 id="在真实的-master-数据库上给用户授权"><a href="#在真实的-master-数据库上给用户授权" class="headerlink" title="在真实的 master 数据库上给用户授权"></a>在真实的 master 数据库上给用户授权</h4><pre><code>mysql&gt; grant all on mycat_test.* to root@&#39;%&#39; identified by &#39;1&#39;;
mysql&gt; flush privileges;</code></pre><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>在 mycat 的机器上测试用户权限有效性</p>
<p>测试是否能正常登录上 主服务器</p>
<pre><code>mysql -uroot -p&#39;123&#39; -h192.168.19.176</code></pre><p>继续测试是否能登录上从服务器</p>
<pre><code>mysql -uroot -p&#39;123&#39; -h192.168.19.177</code></pre><p>通过客户端进行测试是否能登录到 mycat 上</p>
<p>192.168.19.178 是 mycat 的主机地址</p>
<p>注意端口号是 <code>8066</code></p>
<pre><code>[root@mysqlclient ~]# mysql -umycatdb -p1 -h192.168.19.178 -P8066

MySQL [(none)]&gt; show databases;
+----------+
| DATABASE |
+----------+
| mycat_db |
+----------+
1 row in set (0.00 sec)</code></pre><p>继续测试读写分离策略</p>
<p>使用  <code>mysql</code> 客户端工具使用  <code>mycat</code> 的账户和密码登录 <code>mycat</code> ,<br> 之后执行 <code>select</code> 语句。</p>
<p>之后查询 <code>mycat</code> 主机上 <code>mycat</code> 安装目录下的 <code>logs/mycat.log</code> 日志。</p>
<p>在日志重搜索查询的语句或者查询 从库的 ip 地址，应该能搜索到</p>

            </div>
            <hr/>

            



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Mysql/">
                                    <span class="chip bg-color">Mysql</span>
                                </a>
                            
                                <a href="/tags/Mycat/">
                                    <span class="chip bg-color">Mycat</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter, facebook, google, qq, qzone, wechat, weibo, douban, linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5f6c14e435568e1f"></script>
    <div class="addthis_inline_share_toolbox"></div>
    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/10/01/linux/shell/shell-jiao-ben-jia-mi-jing-yan-fen-xiang/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="Shell脚本加密经验分享">
                        
                        <span class="card-title">Shell脚本加密经验分享</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            为啥要加密shell脚本以我个人的需求为例，我要做一个自动远程登录的脚本，每次手动输密码太慢，而且输的多了密码也容易泄露；直接把密码写在脚本里，快确实是快，但是安全性让人无法忍受，写脚本的时候都有可能被过路的不小心看到密码，这就太蛋疼了。

                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-10-01
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Linux/" class="post-category">
                                    Linux
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                    <a href="/tags/shell/">
                        <span class="chip bg-color">shell</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/07/16/sql/mysql-you-biao/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="Mysql-游标">
                        
                        <span class="card-title">Mysql-游标</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            [mysql游标的用法及作用]例子：
当前有三张表A、B、C其中A和B是一对多关系，B和C是一对多关系，现在需要将B中A表的主键存到C中；常规思路就是将B中查询出来然后通过一个update语句来更新C表就可以了，但是B表中有2000多条数据
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-07-16
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/SQL/" class="post-category">
                                    SQL
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/MySQL/">
                        <span class="chip bg-color">MySQL</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4, h5, h6'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5, h6').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2018</span>
            <a href="/about" target="_blank">Cyylog</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/cyylog" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:504246035@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=504246035" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 504246035" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
